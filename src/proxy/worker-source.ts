export default 'var t,e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};\n/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the "License"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */!function(t){!function(i){var s="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=r(t);function r(t,e){return function(i,s){"function"!=typeof t[i]&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:s}),e&&e(i,s)}}void 0===s.Reflect?s.Reflect=t:n=r(s.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,s=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Object.create,o={__proto__:[]}instanceof Array,a=!r&&!o,c={create:r?function(){return st(Object.create(null))}:o?function(){return st({__proto__:null})}:function(){return st({})},has:a?function(t,i){return e.call(t,i)}:function(t,e){return e in t},get:a?function(t,i){return e.call(t,i)?t[i]:void 0}:function(t,e){return t[e]}},h=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?tt():Map,u=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?et():Set,f=new(l||"function"!=typeof WeakMap?it():WeakMap);function p(t,e,i,s){if(N(i)){if(!Y(t))throw new TypeError;if(!U(e))throw new TypeError;return I(t,e)}if(!Y(t))throw new TypeError;if(!J(e))throw new TypeError;if(!J(s)&&!N(s)&&!k(s))throw new TypeError;return k(s)&&(s=void 0),B(t,e,i=L(i),s)}function y(t,e){function i(i,s){if(!J(i))throw new TypeError;if(!N(s)&&!W(s))throw new TypeError;M(t,e,i,s)}return i}function v(t,e,i,s){if(!J(i))throw new TypeError;return N(s)||(s=L(s)),M(t,e,i,s)}function m(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),P(t,e,i)}function b(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),F(t,e,i)}function g(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),T(t,e,i)}function w(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),j(t,e,i)}function A(t,e){if(!J(t))throw new TypeError;return N(e)||(e=L(e)),C(t,e)}function _(t,e){if(!J(t))throw new TypeError;return N(e)||(e=L(e)),E(t,e)}function x(t,e,i){if(!J(e))throw new TypeError;N(i)||(i=L(i));var s=S(e,i,!1);if(N(s))return!1;if(!s.delete(t))return!1;if(s.size>0)return!0;var n=f.get(e);return n.delete(i),n.size>0||f.delete(e),!0}function I(t,e){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e);if(!N(s)&&!k(s)){if(!U(s))throw new TypeError;e=s}}return e}function B(t,e,i,s){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e,i,s);if(!N(r)&&!k(r)){if(!J(r))throw new TypeError;s=r}}return s}function S(t,e,i){var s=f.get(t);if(N(s)){if(!i)return;s=new d,f.set(t,s)}var n=s.get(e);if(N(n)){if(!i)return;n=new d,s.set(e,n)}return n}function P(t,e,i){if(F(t,e,i))return!0;var s=Q(e);return!k(s)&&P(t,s,i)}function F(t,e,i){var s=S(e,i,!1);return!N(s)&&D(s.has(t))}function T(t,e,i){if(F(t,e,i))return j(t,e,i);var s=Q(e);return k(s)?void 0:T(t,s,i)}function j(t,e,i){var s=S(e,i,!1);if(!N(s))return s.get(t)}function M(t,e,i,s){S(i,s,!0).set(t,e)}function C(t,e){var i=E(t,e),s=Q(t);if(null===s)return i;var n=C(s,e);if(n.length<=0)return i;if(i.length<=0)return n;for(var r=new u,o=[],a=0,c=i;a<c.length;a++){var h=c[a];r.has(h)||(r.add(h),o.push(h))}for(var l=0,d=n;l<d.length;l++){h=d[l];r.has(h)||(r.add(h),o.push(h))}return o}function E(t,e){var i=[],s=S(t,e,!1);if(N(s))return i;for(var n=H(s.keys()),r=0;;){var o=$(n);if(!o)return i.length=r,i;var a=X(o);try{i[r]=a}catch(t){try{Z(n)}finally{throw t}}r++}}function O(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function N(t){return void 0===t}function k(t){return null===t}function R(t){return"symbol"==typeof t}function J(t){return"object"==typeof t?null!==t:"function"==typeof t}function V(t,e){switch(O(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var i=3===e?"string":5===e?"number":"default",n=K(t,s);if(void 0!==n){var r=n.call(t,i);if(J(r))throw new TypeError;return r}return z(t,"default"===i?"number":i)}function z(t,e){if("string"===e){var i=t.toString;if(G(i))if(!J(n=i.call(t)))return n;if(G(s=t.valueOf))if(!J(n=s.call(t)))return n}else{var s;if(G(s=t.valueOf))if(!J(n=s.call(t)))return n;var n,r=t.toString;if(G(r))if(!J(n=r.call(t)))return n}throw new TypeError}function D(t){return!!t}function q(t){return""+t}function L(t){var e=V(t,3);return R(e)?e:q(e)}function Y(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function G(t){return"function"==typeof t}function U(t){return"function"==typeof t}function W(t){switch(O(t)){case 3:case 4:return!0;default:return!1}}function K(t,e){var i=t[e];if(null!=i){if(!G(i))throw new TypeError;return i}}function H(t){var e=K(t,n);if(!G(e))throw new TypeError;var i=e.call(t);if(!J(i))throw new TypeError;return i}function X(t){return t.value}function $(t){var e=t.next();return!e.done&&e}function Z(t){var e=t.return;e&&e.call(t)}function Q(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===h)return e;if(e!==h)return e;var i=t.prototype,s=i&&Object.getPrototypeOf(i);if(null==s||s===Object.prototype)return e;var n=s.constructor;return"function"!=typeof n||n===t?e:n}function tt(){var t={},e=[],i=function(){function t(t,e,i){this._index=0,this._keys=t,this._values=e,this._selector=i}return t.prototype["@@iterator"]=function(){return this},t.prototype[n]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var i=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var i=this._find(t,!0);return this._values[i]=e,this},e.prototype.delete=function(e){var i=this._find(e,!1);if(i>=0){for(var s=this._keys.length,n=i+1;n<s;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new i(this._keys,this._values,s)},e.prototype.values=function(){return new i(this._keys,this._values,r)},e.prototype.entries=function(){return new i(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[n]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function s(t,e){return t}function r(t,e){return e}function o(t,e){return[t,e]}}function et(){return function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[n]=function(){return this.keys()},t}()}function it(){var t=16,i=c.create(),s=n();return function(){function t(){this._key=n()}return t.prototype.has=function(t){var e=r(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=r(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return r(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=r(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=n()},t}();function n(){var t;do{t="@@WeakMap@@"+h()}while(c.has(i,t));return i[t]=!0,t}function r(t,i){if(!e.call(t,s)){if(!i)return;Object.defineProperty(t,s,{value:c.create()})}return t[s]}function o(t,e){for(var i=0;i<e;++i)t[i]=255*Math.random()|0;return t}function a(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t)}function h(){var e=a(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var i="",s=0;s<t;++s){var n=e[s];4!==s&&6!==s&&8!==s||(i+="-"),n<16&&(i+="0"),i+=n.toString(16).toLowerCase()}return i}}function st(t){return t.__=void 0,delete t.__,t}t("decorate",p),t("metadata",y),t("defineMetadata",v),t("hasMetadata",m),t("hasOwnMetadata",b),t("getMetadata",g),t("getOwnMetadata",w),t("getMetadataKeys",A),t("getOwnMetadataKeys",_),t("deleteMetadata",x)}(n)}()}(t||(t={}));\n/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the "License"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar i;!function(t){!function(i){var s="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=r(t);function r(t,e){return function(i,s){"function"!=typeof t[i]&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:s}),e&&e(i,s)}}void 0===s.Reflect?s.Reflect=t:n=r(s.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,s=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Object.create,o={__proto__:[]}instanceof Array,a=!r&&!o,c={create:r?function(){return st(Object.create(null))}:o?function(){return st({__proto__:null})}:function(){return st({})},has:a?function(t,i){return e.call(t,i)}:function(t,e){return e in t},get:a?function(t,i){return e.call(t,i)?t[i]:void 0}:function(t,e){return t[e]}},h=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?tt():Map,u=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?et():Set,f=new(l||"function"!=typeof WeakMap?it():WeakMap);function p(t,e,i,s){if(N(i)){if(!Y(t))throw new TypeError;if(!U(e))throw new TypeError;return I(t,e)}if(!Y(t))throw new TypeError;if(!J(e))throw new TypeError;if(!J(s)&&!N(s)&&!k(s))throw new TypeError;return k(s)&&(s=void 0),B(t,e,i=L(i),s)}function y(t,e){function i(i,s){if(!J(i))throw new TypeError;if(!N(s)&&!W(s))throw new TypeError;M(t,e,i,s)}return i}function v(t,e,i,s){if(!J(i))throw new TypeError;return N(s)||(s=L(s)),M(t,e,i,s)}function m(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),P(t,e,i)}function b(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),F(t,e,i)}function g(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),T(t,e,i)}function w(t,e,i){if(!J(e))throw new TypeError;return N(i)||(i=L(i)),j(t,e,i)}function A(t,e){if(!J(t))throw new TypeError;return N(e)||(e=L(e)),C(t,e)}function _(t,e){if(!J(t))throw new TypeError;return N(e)||(e=L(e)),E(t,e)}function x(t,e,i){if(!J(e))throw new TypeError;N(i)||(i=L(i));var s=S(e,i,!1);if(N(s))return!1;if(!s.delete(t))return!1;if(s.size>0)return!0;var n=f.get(e);return n.delete(i),n.size>0||f.delete(e),!0}function I(t,e){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e);if(!N(s)&&!k(s)){if(!U(s))throw new TypeError;e=s}}return e}function B(t,e,i,s){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e,i,s);if(!N(r)&&!k(r)){if(!J(r))throw new TypeError;s=r}}return s}function S(t,e,i){var s=f.get(t);if(N(s)){if(!i)return;s=new d,f.set(t,s)}var n=s.get(e);if(N(n)){if(!i)return;n=new d,s.set(e,n)}return n}function P(t,e,i){if(F(t,e,i))return!0;var s=Q(e);return!k(s)&&P(t,s,i)}function F(t,e,i){var s=S(e,i,!1);return!N(s)&&D(s.has(t))}function T(t,e,i){if(F(t,e,i))return j(t,e,i);var s=Q(e);return k(s)?void 0:T(t,s,i)}function j(t,e,i){var s=S(e,i,!1);if(!N(s))return s.get(t)}function M(t,e,i,s){S(i,s,!0).set(t,e)}function C(t,e){var i=E(t,e),s=Q(t);if(null===s)return i;var n=C(s,e);if(n.length<=0)return i;if(i.length<=0)return n;for(var r=new u,o=[],a=0,c=i;a<c.length;a++){var h=c[a];r.has(h)||(r.add(h),o.push(h))}for(var l=0,d=n;l<d.length;l++){h=d[l];r.has(h)||(r.add(h),o.push(h))}return o}function E(t,e){var i=[],s=S(t,e,!1);if(N(s))return i;for(var n=H(s.keys()),r=0;;){var o=$(n);if(!o)return i.length=r,i;var a=X(o);try{i[r]=a}catch(t){try{Z(n)}finally{throw t}}r++}}function O(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function N(t){return void 0===t}function k(t){return null===t}function R(t){return"symbol"==typeof t}function J(t){return"object"==typeof t?null!==t:"function"==typeof t}function V(t,e){switch(O(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var i=3===e?"string":5===e?"number":"default",n=K(t,s);if(void 0!==n){var r=n.call(t,i);if(J(r))throw new TypeError;return r}return z(t,"default"===i?"number":i)}function z(t,e){if("string"===e){var i=t.toString;if(G(i))if(!J(n=i.call(t)))return n;if(G(s=t.valueOf))if(!J(n=s.call(t)))return n}else{var s;if(G(s=t.valueOf))if(!J(n=s.call(t)))return n;var n,r=t.toString;if(G(r))if(!J(n=r.call(t)))return n}throw new TypeError}function D(t){return!!t}function q(t){return""+t}function L(t){var e=V(t,3);return R(e)?e:q(e)}function Y(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function G(t){return"function"==typeof t}function U(t){return"function"==typeof t}function W(t){switch(O(t)){case 3:case 4:return!0;default:return!1}}function K(t,e){var i=t[e];if(null!=i){if(!G(i))throw new TypeError;return i}}function H(t){var e=K(t,n);if(!G(e))throw new TypeError;var i=e.call(t);if(!J(i))throw new TypeError;return i}function X(t){return t.value}function $(t){var e=t.next();return!e.done&&e}function Z(t){var e=t.return;e&&e.call(t)}function Q(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===h)return e;if(e!==h)return e;var i=t.prototype,s=i&&Object.getPrototypeOf(i);if(null==s||s===Object.prototype)return e;var n=s.constructor;return"function"!=typeof n||n===t?e:n}function tt(){var t={},e=[],i=function(){function t(t,e,i){this._index=0,this._keys=t,this._values=e,this._selector=i}return t.prototype["@@iterator"]=function(){return this},t.prototype[n]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var i=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var i=this._find(t,!0);return this._values[i]=e,this},e.prototype.delete=function(e){var i=this._find(e,!1);if(i>=0){for(var s=this._keys.length,n=i+1;n<s;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new i(this._keys,this._values,s)},e.prototype.values=function(){return new i(this._keys,this._values,r)},e.prototype.entries=function(){return new i(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[n]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function s(t,e){return t}function r(t,e){return e}function o(t,e){return[t,e]}}function et(){return function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[n]=function(){return this.keys()},t}()}function it(){var t=16,i=c.create(),s=n();return function(){function t(){this._key=n()}return t.prototype.has=function(t){var e=r(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=r(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return r(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=r(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=n()},t}();function n(){var t;do{t="@@WeakMap@@"+h()}while(c.has(i,t));return i[t]=!0,t}function r(t,i){if(!e.call(t,s)){if(!i)return;Object.defineProperty(t,s,{value:c.create()})}return t[s]}function o(t,e){for(var i=0;i<e;++i)t[i]=255*Math.random()|0;return t}function a(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t)}function h(){var e=a(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var i="",s=0;s<t;++s){var n=e[s];4!==s&&6!==s&&8!==s||(i+="-"),n<16&&(i+="0"),i+=n.toString(16).toLowerCase()}return i}}function st(t){return t.__=void 0,delete t.__,t}t("decorate",p),t("metadata",y),t("defineMetadata",v),t("hasMetadata",m),t("hasOwnMetadata",b),t("getMetadata",g),t("getOwnMetadata",w),t("getMetadataKeys",A),t("getOwnMetadataKeys",_),t("deleteMetadata",x)}(n)}()}(i||(i={}));var s,n=function(t){this.name=t},r=self&&self.__extends||(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=function(t){function e(e){var i,s,r=t.call(this)||this;return r.name="ServiceNotFoundError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof e?r.normalizedIdentifier=e:e instanceof n?r.normalizedIdentifier="Token<"+(e.name||"UNSET_NAME")+">":e&&(e.name||(null===(i=e.prototype)||void 0===i?void 0:i.name))&&(r.normalizedIdentifier="MaybeConstructable<"+e.name+">"||"MaybeConstructable<"+(null===(s=e.prototype)||void 0===s?void 0:s.name)+">"),r}return r(e,t),Object.defineProperty(e.prototype,"message",{get:function(){return\'Service with "\'+this.normalizedIdentifier+\'" identifier was not found in the container. Register it before usage via explicitly calling the "Container.set" function or using the "@Service()" decorator.\'},enumerable:!1,configurable:!0}),e}(Error),a=self&&self.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),c=function(t){function e(e){var i,s,r=t.call(this)||this;return r.name="CannotInstantiateValueError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof e?r.normalizedIdentifier=e:e instanceof n?r.normalizedIdentifier="Token<"+(e.name||"UNSET_NAME")+">":e&&(e.name||(null===(i=e.prototype)||void 0===i?void 0:i.name))&&(r.normalizedIdentifier="MaybeConstructable<"+e.name+">"||"MaybeConstructable<"+(null===(s=e.prototype)||void 0===s?void 0:s.name)+">"),r}return a(e,t),Object.defineProperty(e.prototype,"message",{get:function(){return\'Cannot instantiate the requested value for the "\'+this.normalizedIdentifier+"\\" identifier. The related metadata doesn\'t contain a factory or a type to instantiate."},enumerable:!1,configurable:!0}),e}(Error),h=Symbol("EMPTY_VALUE"),l=self&&self.__assign||function(){return l=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},l.apply(this,arguments)},d=self&&self.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var s=Array(t),n=0;for(e=0;e<i;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,n++)s[n]=r[o];return s},u=function(){function t(t){this.services=[],this.id=t}return t.prototype.has=function(t){return!!this.findService(t)},t.prototype.get=function(t){var e=f.of(void 0),i=e.findService(t),s=this.findService(t);if(i&&!0===i.global)return this.getServiceValue(i);if(s)return this.getServiceValue(s);if(i&&this!==e){var n=l({},i);n.value=h,this.set(n);var r=this.getServiceValue(n);return this.set(l(l({},n),{value:r})),r}if(i)return this.getServiceValue(i);throw new o(t)},t.prototype.getMany=function(t){var e=this;return this.findAllServices(t).map((function(t){return e.getServiceValue(t)}))},t.prototype.set=function(t,e){var i=this;if(t instanceof Array)return t.forEach((function(t){return i.set(t)})),this;if("string"==typeof t||t instanceof n)return this.set({id:t,type:null,value:e,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});if("function"==typeof t)return this.set({id:t,type:t,value:e,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});var s=l({id:new n("UNREACHABLE"),type:null,factory:void 0,value:h,global:!1,multiple:!1,eager:!1,transient:!1},t),r=this.findService(s.id);return r&&!0!==r.multiple?Object.assign(r,s):this.services.push(s),s.eager&&this.get(s.id),this},t.prototype.remove=function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){return e.remove(t)})):this.services=this.services.filter((function(i){return i.id!==t||(e.destroyServiceInstance(i),!1)})),this},t.prototype.reset=function(t){var e=this;switch(void 0===t&&(t={strategy:"resetValue"}),t.strategy){case"resetValue":this.services.forEach((function(t){return e.destroyServiceInstance(t)}));break;case"resetServices":this.services.forEach((function(t){return e.destroyServiceInstance(t)})),this.services=[];break;default:throw new Error("Received invalid reset strategy.")}return this},t.prototype.findAllServices=function(t){return this.services.filter((function(e){return e.id===t}))},t.prototype.findService=function(t){return this.services.find((function(e){return e.id===t}))},t.prototype.getServiceValue=function(t){var e,i=h;if(t.value!==h)return t.value;if(!t.factory&&!t.type)throw new c(t.id);if(t.factory)if(t.factory instanceof Array){var s=void 0;try{s=this.get(t.factory[0])}catch(e){if(!(e instanceof o))throw e;s=new t.factory[0]}i=s[t.factory[1]](this,t.id)}else i=t.factory(this,t.id);if(!t.factory&&t.type){var n=t.type,r=(null===(e=Reflect)||void 0===e?void 0:e.getMetadata("design:paramtypes",n))||[],a=this.initializeParams(n,r);a.push(this),i=new(n.bind.apply(n,d([void 0],a)))}if(t.transient||i===h||(t.value=i),i===h)throw new c(t.id);return t.type&&this.applyPropertyHandlers(t.type,i),i},t.prototype.initializeParams=function(t,e){var i=this;return e.map((function(e,s){var n=f.handlers.find((function(e){return(e.object===t||e.object===Object.getPrototypeOf(t))&&e.index===s}));return n?n.value(i):e&&e.name&&!i.isPrimitiveParamType(e.name)?i.get(e):void 0}))},t.prototype.isPrimitiveParamType=function(t){return["string","boolean","number","object"].includes(t.toLowerCase())},t.prototype.applyPropertyHandlers=function(t,e){var i=this;f.handlers.forEach((function(s){"number"!=typeof s.index&&(s.object.constructor===t||t.prototype instanceof s.object.constructor)&&s.propertyName&&(e[s.propertyName]=s.value(i))}))},t.prototype.destroyServiceInstance=function(t,e){if(void 0===e&&(e=!1),e||!!t.type||!!t.factory){if("function"==typeof(null==t?void 0:t.value).destroy)try{t.value.destroy()}catch(t){}t.value=h}},t}(),f=function(){function t(){}return t.of=function(t){if(void 0===t&&(t="default"),"default"===t)return this.globalInstance;var e=this.instances.find((function(e){return e.id===t}));return e||(e=new u(t),this.instances.push(e)),e},t.has=function(t){return this.globalInstance.has(t)},t.get=function(t){return this.globalInstance.get(t)},t.getMany=function(t){return this.globalInstance.getMany(t)},t.set=function(t,e){return this.globalInstance.set(t,e),this},t.remove=function(t){return this.globalInstance.remove(t),this},t.reset=function(t){if(void 0===t&&(t="default"),"default"==t)this.globalInstance.reset(),this.instances.forEach((function(t){return t.reset()}));else{var e=this.instances.find((function(e){return e.id===t}));e&&(e.reset(),this.instances.splice(this.instances.indexOf(e),1))}return this},t.registerHandler=function(t){return this.handlers.push(t),this},t.import=function(t){return this},t.handlers=[],t.globalInstance=new u("default"),t.instances=[],t}(),p=self&&self.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),y=function(t){function e(e,i){var s=t.call(this)||this;return s.target=e,s.propertyName=i,s.name="CannotInjectValueError",s}return p(e,t),Object.defineProperty(e.prototype,"message",{get:function(){return\'Cannot inject value into "\'+this.target.constructor.name+"."+this.propertyName+"\\". Please make sure you setup reflect-metadata properly and you don\'t use interfaces without service tokens as injection value."},enumerable:!1,configurable:!0}),e}(Error);function v(t){return function(e,i,s){var r=function(t,e,i,s){var r;if((t&&"string"==typeof t||t instanceof n)&&(r={eagerType:t,lazyType:function(){return t}}),t&&"function"==typeof t&&(r={eagerType:null,lazyType:function(){return t()}}),!t&&i){var o=Reflect.getMetadata("design:type",e,i);r={eagerType:o,lazyType:function(){return o}}}if(!t&&"number"==typeof s&&Number.isInteger(s)){var a=Reflect.getMetadata("design:paramtypes",e,i),c=null==a?void 0:a[s];r={eagerType:c,lazyType:function(){return c}}}return r}(t,e,i,s);if(void 0===r||void 0===r.eagerType||r.eagerType===Object)throw new y(e,i);f.registerHandler({object:e,propertyName:i,index:s,value:function(t){var s=r.lazyType();if(void 0===s||s===Object)throw new y(e,i);return t.get(s)}})}}function m(t){return function(e){var i={id:e,type:e,factory:void 0,multiple:!1,global:!1,eager:!1,transient:!1,value:h};t instanceof n||"string"==typeof t?i.id=t:t&&(i.id=t.id||e,i.factory=t.factory||void 0,i.multiple=t.multiple||!1,i.global=t.global||!1,i.eager=t.eager||!1,i.transient=t.transient||!1),f.set(i)}}class b{constructor(t=null,e=null){this.collider=t,this.shape=e}}var g="undefined"!=typeof Float32Array?Float32Array:Array;function w(){var t=new g(9);return g!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function A(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function _(t,e,i){var s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],d=e[8],u=i[0],f=i[1],p=i[2],y=i[3],v=i[4],m=i[5],b=i[6],g=i[7],w=i[8];return t[0]=u*s+f*o+p*h,t[1]=u*n+f*a+p*l,t[2]=u*r+f*c+p*d,t[3]=y*s+v*o+m*h,t[4]=y*n+v*a+m*l,t[5]=y*r+v*c+m*d,t[6]=b*s+g*o+w*h,t[7]=b*n+g*a+w*l,t[8]=b*r+g*c+w*d,t}function x(t,e,i){var s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],d=e[8],u=Math.sin(i),f=Math.cos(i);return t[0]=f*s+u*o,t[1]=f*n+u*a,t[2]=f*r+u*c,t[3]=f*o-u*s,t[4]=f*a-u*n,t[5]=f*c-u*r,t[6]=h,t[7]=l,t[8]=d,t}function I(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function B(){var t=new g(3);return g!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function S(t,e,i){var s=new g(3);return s[0]=t,s[1]=e,s[2]=i,s}function P(t,e,i,s){return t[0]=e,t[1]=i,t[2]=s,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function F(){var t=new g(4);return g!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}B(),function(){var t,e=(t=new g(4),g!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function T(){var t=new g(2);return g!=Float32Array&&(t[0]=0,t[1]=0),t}function j(t){var e=new g(2);return e[0]=t[0],e[1]=t[1],e}function M(t,e){var i=new g(2);return i[0]=t,i[1]=e,i}function C(t,e){return t[0]=e[0],t[1]=e[1],t}function E(t,e,i){return t[0]=e,t[1]=i,t}function O(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function N(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function k(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function R(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t}function J(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.hypot(i,s)}function V(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s}function z(t){var e=t[0],i=t[1];return Math.hypot(e,i)}function D(t){var e=t[0],i=t[1];return e*e+i*i}function q(t,e){return t[0]=-e[0],t[1]=-e[1],t}function L(t,e){var i=e[0],s=e[1],n=i*i+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function Y(t,e){return t[0]*e[0]+t[1]*e[1]}function G(t,e,i){var s=e[0],n=e[1];return t[0]=i[0]*s+i[3]*n+i[6],t[1]=i[1]*s+i[4]*n+i[7],t}function U(t){return t[0]=0,t[1]=0,t}B(),S(1,0,0),S(0,1,0),F(),F(),w();var W=N,K=V,H=D;!function(){var t=T()}();const X=(t,e,i)=>{t.fill(0);for(let s=0;s<e.m;s++)for(let n=e.rows[s],r=e.rows[s+1];n<r;n++)t[e.columns[n]]+=i[s]*e.values[n];return t},$=(t,e,i)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e[s]*i[s]},Z=(t,e,i,s)=>{for(let n=0,r=t.length;n<r;n++)t[n]=e[n]+i[n]*s},Q=(t,e,i)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e[s]+i[s]},tt=(t,e,i,s,n)=>{for(let r=0,o=t.length;r<o;r++)t[r]=e[r]*i+s[r]*n},et=T(),it=T(),st=T(),nt=T(),rt=T(),ot=T(),at=T(),ct=T(),ht=T(),lt=T(),dt=T(),ut=T(),ft=T(),pt=T(),yt=T(),vt=(t,e)=>t[0]*e[1]-t[1]*e[0],mt=(t,e)=>function(t,e,i,s,n,r,o,a,c,h){return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=o,t[6]=a,t[7]=c,t[8]=h,t}(t,e[0],e[3],0,e[1],e[4],0,-e[0]*e[6]-e[1]*e[7],-e[3]*e[6]-e[4]*e[7],1),bt=(t,e,i,s)=>{W(et,i,e),W(nt,s,e);let n=Y(nt,et)/Y(et,et);return n<0&&(n=0),n>1&&(n=1),E(t,1-n,n)},gt=(t,e,i)=>{W(et,e,t),W(nt,i,t);let s=Y(nt,et)/Y(et,et);return s<0&&(s=0),s>1&&(s=1),R(at,t,et,s),K(i,at)},wt=(t,e,i,s,n)=>{N(et,i,e),N(it,s,e),N(rt,s,i),N(nt,n,e),N(ot,n,i),N(pt,n,s);const r=Y(nt,et),o=-Y(ot,et),a=Y(nt,it),c=-Y(pt,it);if(r<=0&&a<=0)return P(t,1,0,0);const h=Y(ot,rt),l=-Y(pt,rt);if(o<=0&&h<=0)return P(t,0,1,0);if(c<=0&&l<=0)return P(t,0,0,1);const d=vt(et,it),u=d*vt(nt,ot);if(u<=0&&r>=0&&o>=0){const e=r/(r+o);return P(t,1-e,e,0)}const f=d*vt(ot,pt);if(f<=0&&h>=0&&l>=0){const e=h/(h+l);return P(t,0,1-e,e)}const p=d*vt(pt,nt);if(p<=0&&a>=0&&c>=0){const e=a/(a+c);return P(t,1-e,0,e)}const y=f/(f+p+u),v=p/(f+p+u);return P(t,y,v,1-y-v)},At=(t,e,...i)=>{E(t,0,0);for(let s=0,n=e.length;s<n;s++)R(t,t,i[s],e[s]);return t},_t=(t,e,i)=>E(t,i[0]*e[0]+i[3]*e[1],i[1]*e[0]+i[4]*e[1]),xt=t=>{let e=0;for(let i=0,s=t.length;i<s;i++){const s=t[i],n=t[(i+1)%t.length];e+=s[0]*n[1]-n[0]*s[1]}return.5*e},It=(t,e,i,s)=>{W(at,s,t),W(ct,e,t);let n=Y(at,i)/Y(ct,i);return n=Math.max(0,Math.min(1,n)),R(t,t,ct,n)};class Bt{constructor(t){this.mapping=t}toFirstPoint(t,e){return this.mapping.toSecondPoint(t,e)}fromFirstPoint(t,e){return this.mapping.fromSecondPoint(t,e)}toFirstVector(t,e){return this.mapping.toSecondVector(t,e)}fromFirstVector(t,e){return this.mapping.fromSecondVector(t,e)}toSecondPoint(t,e){return this.mapping.toFirstPoint(t,e)}fromSecondPoint(t,e){return this.mapping.fromFirstPoint(t,e)}toSecondVector(t,e){return this.mapping.toFirstVector(t,e)}fromSecondVector(t,e){return this.mapping.fromFirstVector(t,e)}fromFirstToSecondPoint(t,e){return this.mapping.fromSecondToFirstPoint(t,e)}fromFirstToSecondVector(t,e){return this.mapping.fromSecondToFirstVector(t,e)}fromSecondToFirstPoint(t,e){return this.mapping.fromFirstToSecondPoint(t,e)}fromSecondToFirstVector(t,e){return this.mapping.fromFirstToSecondVector(t,e)}inverted(){return this.mapping}}class St{constructor(t,e){this.inverse=new Bt(this),this.first=w(),this.second=w(),this.invFirst=w(),this.invSecond=w(),this.invFirstSecond=w(),this.invSecondFirst=w(),this.update(t,e)}toFirstPoint(t,e){return G(t,e,this.invFirst)}fromFirstPoint(t,e){return G(t,e,this.first)}toFirstVector(t,e){return _t(t,e,this.invFirst)}fromFirstVector(t,e){return _t(t,e,this.first)}toSecondPoint(t,e){return G(t,e,this.invSecond)}fromSecondPoint(t,e){return G(t,e,this.second)}toSecondVector(t,e){return _t(t,e,this.invSecond)}fromSecondVector(t,e){return _t(t,e,this.second)}fromFirstToSecondPoint(t,e){return G(t,e,this.invSecondFirst)}fromFirstToSecondVector(t,e){return _t(t,e,this.invSecondFirst)}fromSecondToFirstPoint(t,e){return G(t,e,this.invFirstSecond)}fromSecondToFirstVector(t,e){return _t(t,e,this.invFirstSecond)}inverted(){return this.inverse}update(t,e){A(this.first,t),A(this.second,e),mt(this.invFirst,t),mt(this.invSecond,e),_(this.invFirstSecond,this.invFirst,e),_(this.invSecondFirst,this.invSecond,t)}}const Pt=(t,e)=>new St(t,e);var Ft=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Tt=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},jt=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Mt=class{constructor(t){this.settings=t}solve(t,e,i,s,n){((t,e,i,s,n,r)=>{const o=i.length;for(;r-- >0;)for(let r=0;r<o;r++){t[r]=i[r];let o=1;for(let i=e.rows[r],s=e.rows[r+1];i<s;i++){const s=e.columns[i],n=e.values[i];s!==r?t[r]-=n*t[s]:o=n}t[r]/=o,t[r]=Math.min(t[r],n[r]),t[r]=Math.max(t[r],s[r])}})(t,e,i,s,n,this.settings.solverIterations)}};Mt=Ft([m(),jt(0,v("SETTINGS")),Tt("design:paramtypes",[Object])],Mt);const Ct=T();class Et{constructor(t){this.point=t,this.prev=null,this.next=null,this.edge0=null,this.edge1=null}}let Ot=class{constructor(t,e){this.v0=t,this.v1=e,this.normal=T(),this.prev=null,this.next=null,W(this.normal,this.v1.point,this.v0.point),L(this.normal,this.normal),E(this.normal,this.normal[1],-this.normal[0])}};class Nt{constructor(t,e=!0){this.points=t,this.transformOrigin=e,this.radius=0,this.loop=null,this.edgeLoop=null,this.cachedSupportVertex=null,e&&(t=this.transformOriginToCentroid(t)),this.loop=this.cachedSupportVertex=this.createVertexLoop(t),this.edgeLoop=this.createEdgeLoop(this.loop),this.radius=this.getRadius()}support(t,e,i=0){let s=this.cachedSupportVertex;const n=Y(s.point,e);if(Y(s.next.point,e)>n)for(s=s.next;Y(s.next.point,e)>Y(s.point,e);)s=s.next;else if(Y(s.prev.point,e)>n)for(s=s.prev;Y(s.prev.point,e)>Y(s.point,e);)s=s.prev;return this.cachedSupportVertex=s,C(t,s.point),R(t,t,s.normal,i)}aabb(t,e){let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const t of this.vertices())G(Ct,t.point,e),Ct[0]<i&&(i=Ct[0]),Ct[1]<s&&(s=Ct[1]),Ct[0]>n&&(n=Ct[0]),Ct[1]>r&&(r=Ct[1]);return E(t.min,i,s),E(t.max,n,r),t}testPoint(t){const e=T(),i=T();for(const s of this.vertices()){const n=s.point,r=s.next.point;if(W(e,r,n),W(i,t,n),vt(e,i)<0)return!1}return!0}inetria(t){let e=0,i=0,s=0;for(const t of this.vertices()){const n=t.point,r=t.next.point,o=n[0]*r[1]-r[0]*n[1];i+=o*(n[1]*n[1]+n[1]*r[1]+r[1]*r[1]),s+=o*(n[0]*n[0]+n[0]*r[0]+r[0]*r[0]),e+=o}return t/6/e*(i+s)}*vertices(){let t=this.loop;do{yield t,t=t.next}while(t!==this.loop)}*edges(){let t=this.edgeLoop;do{yield t,t=t.next}while(t!==this.edgeLoop)}transformOriginToCentroid(t){const e=((t,e)=>{let i=0,s=0;for(let e=0,n=t.length;e<n;e++){const n=t[e],r=t[(e+1)%t.length],o=n[0]*r[1]-r[0]*n[1];i+=(n[0]+r[0])*o,s+=(n[1]+r[1])*o}return M((e=1/6/e)*i,e*s)})(t,xt(t));return t.map((t=>N(T(),t,e)))}getRadius(){return Array.from(this.vertices()).map((t=>z(t.point))).reduce(((t,e)=>e>t?e:t),0)}createVertexLoop(t){let e=null,i=null;for(const s of t){const t=new Et(s);i?(i.next=t,t.prev=i):e=t,i=t}return i.next=e,e.prev=i,e}createEdgeLoop(t){let e=null,i=null,s=t;do{const t=new Ot(s,s.next);i?(i.next=t,t.prev=i):e=t,s.edge0=i,s.edge1=t,i=t,s=s.next}while(s!==t);i.next=e,e.prev=i,s.edge0=i;let n=e;do{const t=T();O(t,n.normal,n.prev.normal),k(t,t,1/(1+Y(n.normal,n.prev.normal))),n.v0.normal=t,n=n.next}while(n!==e);return e}}class kt extends Nt{constructor(t,e){super([M(.5*-t,.5*e),M(.5*-t,.5*-e),M(.5*t,.5*-e),M(.5*t,.5*e)]),this.width=t,this.height=e}}class Rt{constructor(t){this.radius=t}support(t,e,i=0){return L(t,e),k(t,t,this.radius+i)}aabb(t,e){const i=e[6],s=e[7];return E(t.min,i-this.radius,s-this.radius),E(t.max,i+this.radius,s+this.radius),t}testPoint(t){return Y(t,t)<this.radius*this.radius}inetria(t){return.5*t*this.radius*this.radius}}var Jt=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Vt=class{constructor(){this.counter=0,this.freeList=[]}getUniqueId(){return 0===this.freeList.length?++this.counter:this.freeList.shift()}releaseId(t){this.freeList.push(t)}reset(){this.counter=0,this.freeList.length=0}};Vt=Jt([m()],Vt);const zt=(t,e)=>t>e?t<<15|e:e<<15|t;var Dt=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let qt=class{constructor(){this._time=0,this._lastTime=0,this._frame=0}get time(){return this._time}get lastTime(){return this._lastTime}get frame(){return this._frame}tick(t){this._lastTime=this._time,this._time+=t,this._frame++}};qt=Dt([m()],qt);let Lt=class{constructor(t,e){this.p0=t,this.p1=e}};var Yt=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Gt=class{constructor(){this.lisneters=new Map}addEventListener(t,e){this.lisneters.has(t)||this.lisneters.set(t,new Set),this.lisneters.get(t).add(e)}removeEventListener(t,e){this.lisneters.has(t)&&(this.lisneters.get(t).delete(e),0===this.lisneters.get(t).size&&this.lisneters.delete(t))}dispatch(t,...e){if(this.lisneters.has(t))for(const i of this.lisneters.get(t))i(...e)}hasEventListeners(t){return this.lisneters.has(t)}reset(){this.lisneters.clear()}};Gt=Yt([m()],Gt);var Ut,Wt=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Kt=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ht=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};class Xt{constructor(t,e,i){this.array=t,this.start=e,this.size=i,this.prev=null,this.next=null,this.end=this.start+this.size}}let $t=Ut=class{constructor(t){this.reserved=new WeakMap,this.buffer=new Uint8Array(this.size=t.totalReservedMemory),this.freeList=new Xt(this.buffer,0,this.size)}reserve(t){if(t<Ut.MIN_BLOCK_SIZE)throw new Error(`Memory.reserve: failed to reserve block with size ${t} - minimal allowed size is ${Ut.MIN_BLOCK_SIZE}`);const e=this.bestFit(t);if(!e)throw new Error(`Memory.reserve: failed to reserve block with size ${t} - no such block can be found`);if(e.size!==t){const i=new Xt(this.buffer.subarray(e.start,e.start+t),e.start,t),s=new Xt(this.buffer.subarray(e.start+t,e.end),e.start+t,e.size-t);return s.prev=e.prev,s.next=e.next,e.prev?e.prev.next=s:this.freeList=s,e.next&&(e.next.prev=s),e.next=e.prev=null,this.reserved.set(i.array,i),i.array}return e.next&&(e.next.prev=e.prev),e.prev?e.prev.next=e.next:this.freeList=e.next,e.next=e.prev=null,this.reserved.set(e.array,e),e.array}free(t){const e=this.reserved.get(t);if(!e)throw new Error("Memory.free: failed to release block - it seems that buffer was created somewhere outside");const[i,s]=this.closests(e);let n;i&&i.end===e.start&&s&&s.start===e.end?(n=this.mergeInBetween(i,e,s),this.reserved.delete(i.array),this.reserved.delete(e.array),this.reserved.delete(s.array)):i&&i.end===e.start?(n=this.mergeRight(i,e),this.reserved.delete(i.array),this.reserved.delete(e.array)):s&&s.start===e.end?(n=this.mergeLeft(e,s),this.reserved.delete(e.array),this.reserved.delete(s.array)):(e.prev=i,e.next=s,i&&(i.next=e),s&&(s.prev=e),n=e,this.reserved.delete(e.array)),n.prev||(this.freeList=n)}clear(){let t=this.freeList;for(;null!==t;){const e=t.next;t.prev=null,t.next=null,this.reserved.delete(t.array),t=e}this.buffer.fill(0),this.freeList=new Xt(this.buffer,0,this.size)}dump(){const t=[];let e=this.freeList;for(;null!==e;)t.push(e),e=e.next;return t}mergeLeft(t,e){const i=new Xt(this.buffer.subarray(t.start,e.end),t.start,t.size+e.size);return i.prev=e.prev,i.next=e.next,e.prev&&(e.prev.next=i),e.next&&(e.next.prev=i),t.prev=t.next=null,e.prev=e.next=null,i}mergeInBetween(t,e,i){const s=new Xt(this.buffer.subarray(t.start,i.end),t.start,t.size+e.size+i.size);return s.prev=t.prev,s.next=i.next,t.prev&&(t.prev.next=s),i.next&&(i.next.prev=s),t.prev=t.next=null,e.prev=e.next=null,i.prev=i.next=null,s}mergeRight(t,e){const i=new Xt(this.buffer.subarray(t.start,e.end),t.start,t.size+e.size);return i.prev=t.prev,i.next=t.next,t.prev&&(t.prev.next=i),t.next&&(t.next.prev=i),t.prev=t.next=null,e.prev=e.next=null,i}bestFit(t){let e=this.freeList,i=null;for(;null!==e;)e.size>=t&&(null===i||i.size>e.size)&&(i=e),e=e.next;return i}closests(t){let e=this.freeList;for(;null!==e&&e.end<=t.start;)e=e.next;return e?[e.prev,e]:[null,null]}};$t.MIN_BLOCK_SIZE=32,$t=Ut=Wt([m(),Ht(0,v("SETTINGS")),Kt("design:paramtypes",[Object])],$t);class Zt{constructor(t,e,i){this.block=t,this.offset=e,this.size=i}}class Qt{constructor(t){this.buffer=t,this.size=0,this.stack=[],this.end=0,this.offset=0,this.size=t.length,this.offset=t.byteOffset,this.end=t.byteOffset+t.length}pushInt8(t){return this.pushTypedArray(Int8Array,t)}pushUint8(t){return this.pushTypedArray(Uint8Array,t)}pushInt16(t){return this.pushTypedArray(Int16Array,t)}pushUint16(t){return this.pushTypedArray(Uint16Array,t)}pushInt32(t){return this.pushTypedArray(Int32Array,t)}pushUint32(t){return this.pushTypedArray(Uint32Array,t)}pushFloat32(t){return this.pushTypedArray(Float32Array,t)}pushFloat64(t){return this.pushTypedArray(Float64Array,t)}pop(t=1){for(;t>0&&this.stack.length>0;){const e=this.stack.pop();this.offset-=e.size,t--}}clear(){this.stack.length=0,this.offset=this.buffer.byteOffset,this.buffer.fill(0)}dump(){return this.stack}pushTypedArray(t,e){const i=e*t.BYTES_PER_ELEMENT;if(i+this.offset>this.end){const t=this.end-this.offset;throw new Error(`Stack.push: Not enough memory to allocate, requested: ${i}, free: ${t} bytes`)}const s=new Zt(new t(this.buffer.buffer,this.offset,e),this.offset,i);return this.offset+=i,this.stack.push(s),s.block}}class te{constructor(t){this.predicate=t,this.lookup=new WeakMap,this.begin=null,this.end=null,this._size=0}get size(){return this._size}enqueue(t){let e;if(null===this.end)this.begin=this.end=e={value:t,prev:null,next:null};else{let i=this.end;for(;i&&this.predicate(i.value,t)>0;)i=i.prev;i?i.next?(e={value:t,prev:i,next:i.next},i.next.prev=e,i.next=e):(e={value:t,prev:i,next:null},this.end.next=e,this.end=e):(e={value:t,prev:null,next:this.begin},this.begin.prev=e,this.begin=e)}this.lookup.set(t,e),this._size++}resort(){if(this._size<2)return;let t=this.begin.next;for(;null!==t;){let e=t.prev;const i=t.next;for(;e&&this.predicate(e.value,t.value)>0;)e=e.prev;e!==t.prev&&(t.prev&&(t.prev.next=t.next),t.next?t.next.prev=t.prev:(this.end=t.prev,this.end.next=null),e?(e.next.prev=t,t.next=e.next,e.next=t,t.prev=e):(t.next=this.begin,t.prev=null,this.begin.prev=t,this.begin=t)),t=i}}dequeue(){if(0===this._size)return null;const t=this.begin.value;return this.begin.next&&(this.begin.next.prev=null),this.begin=this.begin.next,this._size--,this.lookup.delete(t),t}remove(t){if(!this.lookup.has(t))return;const e=this.lookup.get(t);e.prev&&e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.next?(e.next.prev=null,this.begin=e.next):e.prev?(e.prev.next=null,this.end=e.prev):this.end=this.begin=null,this.lookup.delete(t),this._size--}*[Symbol.iterator](){for(let t=this.begin;null!=t;t=t.next)yield t.value}}class ee{constructor(t,e){this.extent=t,this.transform=e,this.invTransform=w(),mt(this.invTransform,e)}}!function(t){const e=[T(),T(),T(),T()];t.testAABB=(t,i,s,n)=>{E(e[0],-i.extent[0],-i.extent[1]),E(e[1],i.extent[0],-i.extent[1]),E(e[2],i.extent[0],i.extent[1]),E(e[3],-i.extent[0],i.extent[1]);for(const t of e)G(t,t,s);if(e.every((e=>e[0]<t.min[0]))||e.every((e=>e[0]>t.max[0]))||e.every((e=>e[1]<t.min[1]))||e.every((e=>e[1]>t.max[1])))return!1;E(e[0],t.min[0],t.min[1]),E(e[1],t.max[0],t.min[1]),E(e[2],t.max[0],t.max[1]),E(e[3],t.min[0],t.max[1]);for(const t of e)G(t,t,n);return!(e.every((t=>t[0]<-i.extent[0]))||e.every((t=>t[0]>i.extent[0]))||e.every((t=>t[1]<-i.extent[1]))||e.every((t=>t[1]>i.extent[1])))},t.testOBB=(t,i,s,n)=>{E(e[0],-i.extent[0],-i.extent[1]),E(e[1],i.extent[0],-i.extent[1]),E(e[2],i.extent[0],i.extent[1]),E(e[3],-i.extent[0],i.extent[1]);for(const t of e)G(t,t,n);if(e.every((e=>e[0]<-t.extent[0]))||e.every((e=>e[0]>t.extent[0]))||e.every((e=>e[1]<-t.extent[1]))||e.every((e=>e[1]>t.extent[1])))return!1;E(e[0],-t.extent[0],-t.extent[1]),E(e[1],t.extent[0],-t.extent[1]),E(e[2],t.extent[0],t.extent[1]),E(e[3],-t.extent[0],t.extent[1]);for(const t of e)G(t,t,s);return!(e.every((t=>t[0]<-i.extent[0]))||e.every((t=>t[0]>i.extent[0]))||e.every((t=>t[1]<-i.extent[1]))||e.every((t=>t[1]>i.extent[1])))}}(ee||(ee={}));class ie{constructor(t){this.obb=t,this.children=[],this.leaf=!1}}!function(t){const e=w(),i=w(),s=w(),n=w(),r=w(),o=w();t.area=t=>t.extent[0]*t.extent[1]*4,t.testAABB=(t,s,n,r)=>{const o=[n];for(t.clear();o.length;){const n=o.shift();if(_(e,r,n.obb.transform),mt(i,e),ee.testAABB(s,n.obb,e,i))if(n.payload)t.add(n);else for(const t of n.children)o.push(t)}return 0!==t.size},t.testOBBNode=(e,i,a,c,h)=>{mt(r,h),_(r,r,a),mt(o,r);const l=[[i,c]];for(e.clear();l.length;){const[i,o]=l.shift();if(_(s,r,i.obb.transform),_(s,o.obb.invTransform,s),mt(n,s),ee.testOBB(i.obb,o.obb,s,n))if(i.leaf||o.leaf)if(!i.leaf&&o.leaf)for(const t of i.children)l.push([t,o]);else if(i.leaf&&!o.leaf)for(const t of o.children)l.push([i,t]);else e.add([i,o]);else if(t.area(i.obb)>t.area(o.obb))for(const t of i.children)l.push([t,o]);else for(const t of o.children)l.push([i,t])}return 0!==e.size}}(ie||(ie={}));const se=t=>Array.from(t.reduce(((t,e)=>(t.add(e.p0),t.add(e.p1),t.add(e.p2),t)),new Set)),ne=t=>{const e=se(t),i=(t=>{const e=se(t),i=T();for(const t of e)O(i,i,t);return k(i,i,1/e.length)})(t);let s=0,n=0,r=0;for(const t of e)s+=(t[0]-i[0])*(t[0]-i[0]),n+=(t[0]-i[0])*(t[1]-i[1]),r+=(t[1]-i[1])*(t[1]-i[1]);const o=1/e.length;return a=s*o,c=n*o,h=n*o,l=r*o,(d=new g(4))[0]=a,d[1]=c,d[2]=h,d[3]=l,d;var a,c,h,l,d},re=t=>{const e=se(t),i=ne(t),[s,n]=(t=>{const e=t[0],i=t[1],s=t[2],n=t[3];if(Math.abs(i)<1e-6)return[M(1,0),M(0,1)];const r=(e+n)*(e+n)-4*(e*n-s*i);if(r<0)throw Error("getEigenVectors: something went wrong");const o=.5*(e+n-Math.sqrt(r)),a=.5*(e+n+Math.sqrt(r)),c=T();E(c,-s/(e-o),1);const h=T();return E(h,-s/(e-a),1),[c,h]})(i);L(s,s),L(n,n),vt(s,n)<0&&q(s,s);let r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(const t of e){let e=Y(t,s);e<r&&(r=e),e>o&&(o=e),e=Y(t,n),e<a&&(a=e),e>c&&(c=e)}const h=.5*Math.abs(o-r),l=.5*Math.abs(c-a),d=.5*(r+o),u=.5*(a+c),f=T();R(f,f,s,d),R(f,f,n,u);const p=(y=s[0],v=s[1],m=0,b=n[0],A=n[1],_=0,x=f[0],I=f[1],B=1,(S=new g(9))[0]=y,S[1]=v,S[2]=m,S[3]=b,S[4]=A,S[5]=_,S[6]=x,S[7]=I,S[8]=B,S);var y,v,m,b,A,_,x,I,B,S;const P=w();return mt(P,p),{transform:p,invTransform:P,extent:M(h,l)}},oe=t=>M((t.p0[0]+t.p1[0]+t.p2[0])/3,(t.p0[1]+t.p1[1]+t.p2[1])/3);class ae{constructor(t,e=!0){this.mesh=t,this.transformOrigin=e,this.radius=0,this.triangles=[],this.hull=[],e&&(this.mesh=this.transformOriginToCentroid(this.mesh)),this.obbTree=(t=>{const e=new ie(re(t)),i=[{node:e,soup:t}];for(;i.length;){const{soup:t,node:e}=i.shift();if(t.length>1){const s=T(),n=T();e.obb.extent[0]>e.obb.extent[1]?(E(s,e.obb.transform[0],e.obb.transform[1]),E(n,e.obb.transform[3],e.obb.transform[4])):(E(s,e.obb.transform[3],e.obb.transform[4]),E(n,e.obb.transform[0],e.obb.transform[1]));let r=0,o=!1;for(;!o&&r<2;){const a=T();if(0===r)E(a,e.obb.transform[6],e.obb.transform[7]);else{for(const e of t)O(a,a,oe(e));k(a,a,1/t.length)}for(const r of[s,n]){const s=[],n=[],c=Y(a,r);for(const e of t)Y(r,oe(e))>c?s.push(e):n.push(e);if(0===s.length||0===n.length)continue;const h=new ie(re(n));e.children.push(h),i.push({node:h,soup:n});const l=new ie(re(s));e.children.push(l),i.push({node:l,soup:s}),o=!0;break}r++}if(!o)for(const s of t){const t=new ie(re([s]));e.children.push(t),i.push({node:t,soup:[s]})}}else e.payload={triangle:t[0],triangleShape:new Nt([t[0].p0,t[0].p1,t[0].p2],!1)},e.leaf=!0}return e})(this.mesh),((t,e)=>{const i=[e];for(;i.length;){const{payload:e,children:s}=i.pop();e&&t.push(e.triangleShape);for(const t of s)i.push(t)}})(this.triangles,this.obbTree),this.getConvexHull(),this.radius=this.getRadius()}testPoint(t){return this.triangles.some((e=>e.testPoint(t)))}support(t,e){const i=this.indexOfFarhestPoint(e);return C(t,this.hull[i])}aabb(t,e){const i=T();let s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const t of this.hull)G(i,t,e),i[0]<s&&(s=i[0]),i[1]<n&&(n=i[1]),i[0]>r&&(r=i[0]),i[1]>o&&(o=i[1]);return E(t.min,s,n),E(t.max,r,o),t}inetria(t){return((t,e)=>{let i=0,s=0;for(const e of t){const t=oe(e),n=Math.abs(xt([e.p0,e.p1,e.p2]));s+=Y(t,t)*n,i+=n}return e/i*s})(this.mesh,t)}getConvexHull(){const t=new Set;for(const e of this.mesh)t.add(e.p0),t.add(e.p1),t.add(e.p2);const e=new Set;((t,e)=>{const i=new Map;for(const s of e){const e=s.toString();i.has(e)||(t.add(s),i.set(e,s))}})(e,t),((t,e)=>{let i=M(Number.POSITIVE_INFINITY,0),s=M(0,Number.NEGATIVE_INFINITY),n=M(Number.NEGATIVE_INFINITY,0),r=M(0,Number.POSITIVE_INFINITY);const o=new Set;for(const t of e)t[0]<i[0]&&(i=t),t[1]>s[1]&&(s=t),t[0]>n[0]&&(n=t),t[1]<r[1]&&(r=t),o.add(t);const a=[],c=[i,r,n,s];for(let t=0;t<c.length;t++){const e=c[t],i=c[(t+1)%c.length];e!==i&&a.push(new Lt(e,i))}const h=T(),l=T(),d=[];for(const t of a){const e=new Set;for(const i of o)W(h,i,t.p0),W(l,t.p1,t.p0),vt(h,l)>0&&e.add(i);d.push({points:e,edge:t})}for(;d.length;){const{edge:e,points:i}=d.pop();if(0===i.size)t.push(e.p0);else{let t=null,s=0;for(const n of i){W(h,n,e.p0),W(l,e.p1,e.p0),k(l,l,Y(h,l)/Y(l,l)),W(h,h,l);const i=D(h);i>s&&(s=i,t=n)}if(null!==t){const s=new Lt(t,e.p1),n=new Lt(e.p0,t);for(const t of[n,s]){const e=new Set;for(const s of i)W(h,s,t.p0),W(l,t.p1,t.p0),vt(h,l)>0&&e.add(s);d.push({points:e,edge:t})}}}}})(this.hull,e)}transformOriginToCentroid(t){const e=(t=>{const e=new Set;let i=0;for(const s of t){const t=oe(s),n=Math.abs(xt([s.p0,s.p1,s.p2]));e.add(k(t,t,n)),i+=n}let s=0,n=0;for(const t of e)s+=t[0]/i,n+=t[1]/i;return M(s,n)})(t);return t.map((t=>({p0:N(T(),t.p0,e),p1:N(T(),t.p1,e),p2:N(T(),t.p2,e)})))}indexOfFarhestPoint(t){let e=Number.NEGATIVE_INFINITY,i=-1;for(let s=0;s<this.hull.length;s++){const n=Y(this.hull[s],t);n>e&&(e=n,i=s)}return i}getRadius(){return this.hull.map((t=>z(t))).reduce(((t,e)=>e>t?e:t),0)}}class ce{constructor(t=T(),e=T()){this.min=t,this.max=e}}!function(t){const e=T(),i=T(),s=T(),n=T(),r=new t;t.EPSILON=.001,t.testAABB=(t,e)=>e.min[0]<t.max[0]&&e.max[0]>t.min[0]&&e.min[1]<t.max[1]&&e.max[1]>t.min[1],t.testLineSegment=(i,s,n,r,o)=>{let a=0,c=1;W(e,o,r);for(let i=0;i<2;i++)if(Math.abs(e[i])<t.EPSILON){if(r[i]<n.min[i]||o[i]>n.max[i])return!1}else{const t=1/e[i];let s=(n.min[i]-r[i])*t,o=(n.max[i]-r[i])*t;if(s>o){const t=s;s=o,o=t}if(s>a&&(a=s),o<c&&(c=o),c<a)return!1}return R(i,r,e,a),R(s,r,e,c),!0},t.testCapsule=(e,n,o,a)=>{if(E(r.min,e.min[0]-a,e.min[1]-a),E(r.max,e.max[0]+a,e.max[1]+a),!t.testLineSegment(i,s,r,n,o))return!1;const c=a*a;if(i[0]<e.min[0]){if(i[1]<e.min[1])return gt(i,s,e.min)<c;if(i[1]>e.max[1])return gt(i,s,M(e.min[0],e.max[1]))<c}else if(i[0]>e.max[0]){if(i[1]>e.max[1])return gt(i,s,e.max)<c;if(i[1]<e.min[1])return gt(i,s,M(e.max[0],e.min[1]))<c}return!0},t.fromConvex=(t,e,i)=>(E(n,i[1],i[4]),e.support(n,n),G(n,n,i),t.max[1]=n[1],E(n,i[0],i[3]),e.support(n,n),G(n,n,i),t.max[0]=n[0],E(n,-i[1],-i[4]),e.support(n,n),G(n,n,i),t.min[1]=n[1],E(n,-i[0],-i[3]),e.support(n,n),G(n,n,i),t.min[0]=n[0],t)}(ce||(ce={}));class he extends Nt{constructor(t,e,i=16){super(((t,e,i)=>{const s=[],n=[];let r=0;const o=Math.PI/i;for(let a=0;a<=i;a++,r+=o){const i=Math.cos(r),o=Math.sin(r);s.push(M(t*i,t*o+.5*e)),n.push(M(-t*i,-t*o-.5*e))}return s.concat(n)})(t,e,i)),this.r=t,this.height=e,this.subdivisions=i,this.convex=((t,e)=>({support:(i,s)=>(L(i,s),E(i,i[0]*t,i[1]*t+Math.sign(i[1])*e))}))(t,.5*e)}testPoint(t){const e=T(),i=T(),s=M(0,.5*-this.height),n=M(0,.5*this.height);return bt(e,s,n,t),At(i,e,s,n),J(i,t)<this.r}aabb(t,e){return ce.fromConvex(t,this.convex,e)}}class le extends Nt{constructor(t,e,i=32){var s,n;super(((t,e,i)=>{const s=[];let n=0;const r=2*Math.PI/i;for(let o=0;o<i;o++,n+=r){const i=Math.cos(n),r=Math.sin(n);s.push(M(t*i,e*r))}return s})(t,e,i)),this.a=t,this.b=e,this.subdivisions=i,this.convex=(s=t,n=e,{support(t,e){const i=s*s,r=n*n,o=Math.sqrt(e[0]*e[0]*i+e[1]*e[1]*r);return E(t,e[0]*i/o,e[1]*r/o)}})}testPoint(t){return t[0]*t[0]/this.a/this.a+t[1]*t[1]/this.b/this.b<1}aabb(t,e){return ce.fromConvex(t,this.convex,e)}}const de=T(),ue=T(),fe=T(),pe=(t,e,i,s,n,r)=>(s.toFirstVector(fe,n),e.support(de,fe,r),s.fromFirstPoint(de,de),q(fe,n),s.toSecondVector(fe,fe),i.support(ue,fe,r),s.fromSecondPoint(ue,ue),N(t,de,ue)),ye=T(),ve=B(),me=T(),be=(t,e,i,s,n,r=0,o=.01,a=25)=>{const c=1e4*Number.EPSILON,h=1e-4;C(me,n);let l=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY,u=null;for(;3!=t.size&&d>0*c&&a--;){q(me,me);const n=T();pe(n,e,i,s,me,r),d=Y(me,me),l=-Y(me,n);if(u&&u[0]===n[0]&&u[1]===n[1]||d-l<=o*d)return Math.sqrt(d);if(u=n,t.add(n),1===t.size){const e=Array.from(t.values());C(me,e[0])}else if(2===t.size){const e=Array.from(t.values());bt(ye,e[0],e[1],yt),At(me,ye,e[0],e[1]);for(let i=0;i<2;i++)ye[i]<h&&t.delete(e[i])}else if(3===t.size){const e=Array.from(t.values());wt(ve,e[0],e[1],e[2],yt),At(me,ve,e[0],e[1],e[2]);for(let i=0;i<3;i++)ve[i]<h&&t.delete(e[i])}else console.warn("gjk.distance: for some reason simplex has more than 3 vertices");for(const e of t)Y(e,e)}return 0},ge=(t,e)=>{if(1===e.size){C(t,Array.from(e.values())[0])}else if(2==e.size){const i=Array.from(e.values());bt(ye,i[0],i[1],yt),At(t,ye,i[0],i[1])}else if(3===e.size){const i=Array.from(e.values());wt(ve,i[0],i[1],i[2],yt),At(t,ve,i[0],i[1],i[2])}else U(t)};class we{constructor(t,e){this.p0=t,this.p1=e,this.closest=T(),this.closestBarycentric=T(),this.distance=0}}const Ae=(t,e,i,s,n,r=0,o=1e-4,a=25)=>{let c=null;if(3===e.size){const[t,i,s]=Array.from(e);c=((t,e,i)=>{const s=new we(t,e),n=new we(e,i),r=new we(i,t),o=new te(((t,e)=>t.distance-e.distance));for(const t of[s,n,r])bt(t.closestBarycentric,t.p0,t.p1,yt),At(t.closest,t.closestBarycentric,t.p0,t.p1),t.distance=Y(t.closest,t.closest),o.enqueue(t);return o})(t,i,s)}else{if(2!==e.size)return void U(t);{const[t,o]=Array.from(e);c=((t,e,i,s,n,r=0)=>{const o=T();N(o,e,t),E(o,-o[1],o[0]);const a=T();pe(a,i,s,n,o,r),q(o,o);const c=T();pe(c,i,s,n,o,r);const h=new we(a,t),l=new we(t,c),d=new we(c,e),u=new we(e,a),f=new te(((t,e)=>t.distance-e.distance));for(const t of[h,l,d,u])bt(t.closestBarycentric,t.p0,t.p1,yt),At(t.closest,t.closestBarycentric,t.p0,t.p1),t.distance=Y(t.closest,t.closest),f.enqueue(t);return f})(t,o,i,s,n,r)}}let h=null,l=0,d=0;for(;a--&&c.size;){const t=c.dequeue();if(t.closestBarycentric[0]<1e-6||t.closestBarycentric[1]<1e-6)continue;h=t;const e=T();if(pe(e,i,s,n,h.closest,r),l=Y(h.closest,h.closest),d=Y(h.closest,e),d-l<o)break;const a=new we(h.p0,e),u=new we(e,h.p1);for(const t of[a,u])bt(t.closestBarycentric,t.p0,t.p1,yt),At(t.closest,t.closestBarycentric,t.p0,t.p1),t.distance=Y(t.closest,t.closest),c.enqueue(t)}h?At(t,h.closestBarycentric,h.p0,h.p1):U(t)};class _e{constructor(){this.transform=w(),this.position=T(),this.velocity=T(),this.angle=0,this.omega=0}advance(t){R(this.position,this.position,this.velocity,t),this.angle+=this.omega*t,this.updateTransform()}wrap(t){this.shape=t.collider.shape,C(this.position,t.position),this.angle=t.angle,C(this.velocity,t.velocity),this.omega=t.omega,this.updateTransform()}updateTransform(){I(this.transform,this.position),x(this.transform,this.transform,this.angle)}}const xe=T(),Ie=new Set,Be=Pt(w(),w()),Se=new _e,Pe=new _e,Fe=(t,e,i,s)=>{N(xe,i.position,e.position),Be.update(e.transform,i.transform),Ie.clear();const n=be(Ie,e.shape,i.shape,Be,xe,-s);return 0===n?0:(ge(t,Ie),L(t,t),n)},Te=T(),je=T(),Me=(t,e,i,s,n,r,o,a)=>{Se.wrap(t),Pe.wrap(i);let c=0,h=Number.POSITIVE_INFINITY;N(je,Pe.velocity,Se.velocity);const l=Math.abs(Se.omega)*e+Math.abs(Pe.omega)*s;do{h=Fe(Te,Se,Pe,a);const t=Y(je,Te)+l;if(t<=0)return 1;const e=h/t;Number.isFinite(e)||console.warn("getToi: something went wrong with time of impact estimation"),Se.advance(e),Pe.advance(e),c+=e}while(h>=r&&c<n&&c>=0&&--o);return c=Math.min(n,Math.max(0,c)),c/n};var Ce=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Ee=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Oe=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Ne=class{constructor(t,e,i,s){this.settings=t,this.broadPhase=e,this.midPhase=i,this.narrowPhase=s,this.continuous=new Array,this.p0=T(),this.p1=T(),this.q0=T(),this.q1=T(),this.c0=T(),this.c1=T()}getTimeOfFirstImpact(t){let e=1;const i=new Set,s=this.continuous.length;for(let e=0;e<s;e++){const n=this.continuous[e];C(this.p0,n.body.position),R(this.p1,this.p0,n.body.velocity,t);for(let r=e+1;r<s;r++){const e=this.continuous[r];0!=(n.mask&e.mask)&&(C(this.q0,e.body.position),R(this.q1,this.q0,e.body.velocity,t),this.testCapsuleCapsule(this.p0,this.p1,n.shape.radius,this.q0,this.q1,e.shape.radius)&&i.add([n,e]))}const r=this.broadPhase.queryCapsule(this.p0,this.p1,n.shape.radius);for(const t of r)t===n||t.body.continuous||0==(n.mask&t.mask)||i.add([n,t])}for(const[s,n]of i){let i=0;n.shape instanceof ae||(i=Me(s.body,s.shape.radius,n.body,n.shape.radius,t,this.settings.toiEpsilon,this.settings.toiMaxIterations,this.settings.toiPenetrationDepth),i<e&&(e=i))}return e}registerCollider(t){this.broadPhase.registerCollider(t),t.body.continuous&&this.continuous.push(t)}unregisterCollider(t){this.broadPhase.unregisterCollider(t),t.body.continuous&&this.continuous.splice(this.continuous.indexOf(t),1)}*detectCollisions(){const t=this.broadPhase.detectCandidates(),e=this.midPhase.detectCandidates(t);yield*this.narrowPhase.detectContacts(e)}testCapsuleCapsule(t,e,i,s,n,r){((t,e,i,s,n,r)=>{W(et,s,i);const o=Y(et,et);W(it,n,i),W(st,r,i),W(ft,r,n);const a=Y(ft,ft);W(dt,i,n),W(ut,s,n);const c=Math.max(0,Math.min(1,Y(et,it)/o)),h=Math.max(0,Math.min(1,Y(et,st)/o)),l=Math.max(0,Math.min(1,Y(ft,dt)/a)),d=Math.max(0,Math.min(1,Y(ft,ut)/a));R(at,i,et,c),R(ct,i,et,h),R(ht,n,ft,l),R(lt,n,ft,d);let u=Number.POSITIVE_INFINITY;for(const[o,a]of[[at,n],[ct,r],[i,ht],[s,lt]]){const i=K(o,a);i<u&&(C(t,o),C(e,a),u=i)}})(this.c0,this.c1,t,e,s,n);const o=i+r;return V(this.c0,this.c1)<o*o}};Ne=Ce([m(),Oe(0,v("SETTINGS")),Oe(1,v("BROAD_PHASE")),Oe(2,v("MID_PHASE")),Oe(3,v("NARROW_PHASE")),Ee("design:paramtypes",[Object,Object,Object,Object])],Ne);var ke=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Re=class{constructor(){this.colliders=[],this.capsuleAABB=new ce,this.candidatePair=[new b,new b]}registerCollider(t){this.colliders.push(t)}unregisterCollider(t){this.colliders.splice(this.colliders.indexOf(t),1)}*queryCapsule(t,e,i){E(this.capsuleAABB.min,Math.min(t[0],e[0])-i,Math.min(t[1],e[1])-i),E(this.capsuleAABB.max,Math.max(t[0],e[0])+i,Math.max(t[1],e[1])+i),this.updateAABBs();for(const s of this.colliders)ce.testAABB(this.capsuleAABB,s.aabb)&&ce.testCapsule(s.aabb,t,e,i)&&(yield s)}*detectCandidates(){this.updateAABBs();const t=this.colliders.length-1,e=this.colliders.length;for(let i=0;i<t;i++){const t=this.colliders[i];for(let s=i+1;s<e;s++){const e=this.colliders[s];t.mask&e.mask&&(t.body.isStatic&&e.body.isStatic||ce.testAABB(t.aabb,e.aabb)&&(this.candidatePair[0].collider=t,this.candidatePair[0].shape=t.shape,this.candidatePair[1].collider=e,this.candidatePair[1].shape=e.shape,yield this.candidatePair))}}}updateAABBs(){for(const t of this.colliders)t.updateAABB()}};var Je,Ve;Re=ke([m()],Re),function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(Je||(Je={})),function(t){t[t.Start=0]="Start",t[t.End=1]="End"}(Ve||(Ve={}));class ze{constructor(t,e){this.type=t,this.interval=e}get value(){return this.interval.aabb[this.type][this.interval.type]}}class De{constructor(t,e,i,s){this.id=t,this.aabb=e,this.collider=i,this.type=s,this.start=new ze(Ve.Start,this),this.end=new ze(Ve.End,this)}}const qe=(t,e)=>t.value-e.value;class Le{constructor(t){this.type=t,this.intersected=new Map,this.aabbInterval=new Map,this.queue=new te(qe),this.active=new Set}registerAABB(t){const e=new De(this.aabbInterval.size+1,t.aabb,t,this.type);this.aabbInterval.set(t.aabb,e),this.queue.enqueue(e.start),this.queue.enqueue(e.end)}unregisterAABB(t){const e=this.aabbInterval.get(t.aabb);this.queue.remove(e.start),this.queue.remove(e.end),this.aabbInterval.delete(t.aabb)}update(){this.active.clear(),this.intersected.clear(),this.queue.resort();for(const t of this.queue)if(t.type===Ve.Start){for(const e of this.active)this.intersected.set(zt(e.id,t.interval.id),[e,t.interval]);this.active.add(t.interval)}else this.active.delete(t.interval)}}var Ye=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Ge=class{constructor(){this.colliders=new Set,this.capsuleAABB=new ce,this.candidatePair=[new b,new b],this.xIntervalKeeper=new Le(Je.X),this.yIntervalKeeper=new Le(Je.Y)}registerCollider(t){this.colliders.add(t),this.xIntervalKeeper.registerAABB(t),this.yIntervalKeeper.registerAABB(t)}unregisterCollider(t){this.colliders.delete(t),this.xIntervalKeeper.unregisterAABB(t),this.yIntervalKeeper.unregisterAABB(t)}*queryCapsule(t,e,i){E(this.capsuleAABB.min,Math.min(t[0],e[0])-i,Math.min(t[1],e[1])-i),E(this.capsuleAABB.max,Math.max(t[0],e[0])+i,Math.max(t[1],e[1])+i),this.updateAABBs();for(const s of this.colliders)ce.testAABB(this.capsuleAABB,s.aabb)&&ce.testCapsule(s.aabb,t,e,i)&&(yield s)}*detectCandidates(){this.updateAABBs(),this.xIntervalKeeper.update(),this.yIntervalKeeper.update();for(const[t,e]of this.xIntervalKeeper.intersected)if(this.yIntervalKeeper.intersected.has(t)){const t=e[0].collider,i=e[1].collider;if(!(t.mask&i.mask))continue;t.id<i.id?(this.candidatePair[0].collider=t,this.candidatePair[0].shape=t.shape,this.candidatePair[1].collider=i,this.candidatePair[1].shape=i.shape):(this.candidatePair[1].collider=t,this.candidatePair[1].shape=t.shape,this.candidatePair[0].collider=i,this.candidatePair[0].shape=i.shape),yield this.candidatePair}}updateAABBs(){for(const t of this.colliders)t.updateAABB()}};Ge=Ye([m()],Ge);var Ue=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let We=class{*detectCandidates(t){for(const e of t){const[t,i]=e;if(t.shape instanceof ae&&i.shape instanceof ae){const s=new Set;if(ie.testOBBNode(s,t.shape.obbTree,t.collider.transform,i.shape.obbTree,i.collider.transform))for(const[t,i]of s)e[0].shape=t.payload.triangleShape,e[1].shape=i.payload.triangleShape,yield e}else if(t.shape instanceof ae){const s=new Set;if(ie.testAABB(s,i.collider.aabb,t.shape.obbTree,t.collider.transform))for(const t of s)e[0].shape=t.payload.triangleShape,yield e}else if(i.shape instanceof ae){const s=new Set;if(ie.testAABB(s,t.collider.aabb,i.shape.obbTree,i.collider.transform))for(const t of s)e[1].shape=t.payload.triangleShape,yield e}else yield e}}};We=Ue([m()],We);class Ke{constructor(){this.edge=null,this.vertex=null,this.depth=Number.NEGATIVE_INFINITY}}const He=T(),Xe=T(),$e=T(),Ze=T(),Qe=T(),ti=T(),ei=T(),ii=T(),si=T(),ni=T(),ri=T(),oi=new Ke,ai=new Ke,ci=new class{constructor(){this.edge=null,this.depth=Number.NEGATIVE_INFINITY}},hi=(t,e,i,s)=>{t.depth=Number.NEGATIVE_INFINITY,t.edge=null,t.vertex=null;for(const n of e.edges()){q(He,n.normal),s.fromFirstToSecondVector(He,He),i.support(Xe,He),s.fromSecondToFirstPoint(Xe,Xe),W(Xe,Xe,n.v0.point);const e=Y(n.normal,Xe);if(e>=0)return t.depth=e,t.edge=n,t.vertex=i.cachedSupportVertex,t;e>t.depth&&(t.depth=e,t.edge=n,t.vertex=i.cachedSupportVertex)}return t};class li{constructor(){this.point0=T(),this.point1=T(),this.normal=T(),this.depth=0}}const di=(t,e,i,s)=>{if(t.length=null,hi(oi,e,i,s),!oi.edge||oi.depth>=0)return!1;if(hi(ai,i,e,s.inverted()),!ai.edge||ai.depth>=0)return!1;let n=oi,r=!1;ai.depth>oi.depth&&(n=ai,s=s.inverted(),r=!0);const o=n.edge;s.fromFirstToSecondVector(ri,o.normal);const a=Y(n.vertex.edge0.normal,ri)<Y(n.vertex.edge1.normal,ri)?n.vertex.edge0:n.vertex.edge1;s.fromSecondToFirstPoint(si,a.v0.point),s.fromSecondToFirstPoint(ni,a.v1.point),W(ri,o.v0.point,o.v1.point),It(si,ni,ri,o.v1.point),q(ri,ri),It(ni,si,ri,o.v0.point);for(const e of[si,ni]){W(ri,e,o.v0.point);const i=Y(ri,o.normal);if(i>=0)continue;const n=new li;s.fromFirstVector(n.normal,o.normal),n.depth=-i,r?(s.fromFirstPoint(n.point0,e),C(n.normal,n.normal),R(n.point1,n.point0,n.normal,n.depth)):(s.fromFirstPoint(n.point1,e),q(n.normal,n.normal),R(n.point0,n.point1,n.normal,-n.depth)),t.push(n)}return!0},ui=(t,e,i,s)=>{if(((t,e,i,s)=>{t.depth=Number.NEGATIVE_INFINITY,t.edge=null;for(const n of e.edges()){q(He,n.normal),s.fromFirstToSecondVector(He,He),i.support(Xe,He),s.fromSecondToFirstPoint(Xe,Xe),W(Xe,Xe,n.v0.point);const e=Y(n.normal,Xe);if(e>=0)return t.depth=e,t.edge=n,t;e>t.depth&&(t.depth=e,t.edge=n)}})(ci,e,i,s),!ci.edge||ci.depth>=0)return!1;s.fromFirstPoint($e,ci.edge.v0.point),s.fromFirstPoint(Ze,ci.edge.v1.point),U(Qe),s.fromSecondPoint(Qe,Qe),bt(ei,$e,Ze,Qe),At(ii,ei,$e,Ze),s.fromFirstVector(ri,ci.edge.normal),W(Ze,Qe,$e);let n=0;if(Y(Ze,ri)>0?(W(ri,ii,Qe),n=i.radius-z(ri)):(W(ri,Qe,ii),n=z(ri)+i.radius),n>0){L(ri,ri);const e=new li;return e.depth=n,C(e.normal,ri),C(e.point0,ii),R(e.point1,ii,e.normal,e.depth),t.push(e),!0}return!1},fi=(t,e,i,s)=>{U(Qe),s.fromFirstPoint(Qe,Qe),U(ti),s.fromSecondPoint(ti,ti);const n=e.radius+i.radius-J(Qe,ti);if(n<=0)return!1;const r=new li;return r.depth=n,N(r.normal,Qe,ti),L(r.normal,r.normal),R(r.point0,Qe,r.normal,-e.radius),R(r.point1,ti,r.normal,i.radius),t.push(r),!0};var pi=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},yi=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vi=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let mi=class{constructor(t){this.registry=t}*detectContacts(t){const e=[];for(const[i,s]of t){const t=zt(i.collider.id,s.collider.id),n=this.registry.getPairById(t);n.intercontact&&(n.updateTransform(),e.length=0,i.shape instanceof Nt&&s.shape instanceof Nt?di(e,i.shape,s.shape,n.spaceMapping)&&(yield*this.getContactInfo(e,i,s,n.spaceMapping)):i.shape instanceof Nt&&s.shape instanceof Rt?ui(e,i.shape,s.shape,n.spaceMapping)&&(yield*this.getContactInfo(e,i,s,n.spaceMapping)):i.shape instanceof Rt&&s.shape instanceof Nt?ui(e,s.shape,i.shape,n.spaceMapping.inverted())&&(yield*this.getContactInfo(e,s,i,n.spaceMapping.inverted())):i.shape instanceof Rt&&s.shape instanceof Rt&&fi(e,i.shape,s.shape,n.spaceMapping)&&(yield*this.getContactInfo(e,i,s,n.spaceMapping)))}}*getContactInfo(t,e,i,s){for(const n of t){const t=T();s.toFirstPoint(t,n.point0);const r=T();s.toSecondPoint(r,n.point1),yield{collider0:e.collider,collider1:i.collider,shape0:e.shape,shape1:i.shape,point0:n.point0,localPoint0:t,point1:n.point1,localPoint1:r,normal:n.normal,depth:n.depth}}}};mi=pi([m(),vi(0,v("PAIRS_REGISTRY")),yi("design:paramtypes",[Object])],mi);const bi=T(),gi=T(),wi=T(),Ai=T(),_i=T(),xi=T(),Ii=T(),Bi=T(),Si=T(),Pi=(t,e)=>{let i=t.edgeLoop;const s=Y(i.normal,e);if(Y(i.next.normal,e)>s)for(i=i.next;Y(i.next.normal,e)>Y(i.normal,e);)i=i.next;else if(Y(i.prev.normal,e)>s)for(i=i.prev;Y(i.prev.normal,e)>Y(i.normal,e);)i=i.prev;return i},Fi=(t,e,i,s,n,r,o)=>{const a=T();L(a,o),C(Ai,a),r.toSecondVector(Ai,Ai);let c=Pi(n,Ai);const h=Y(c.normal,Ai);q(Ai,a),r.toFirstVector(Ai,Ai);let l=Pi(i,Ai);let d=!1;if(h>Y(l.normal,Ai)){const t=c;c=l,l=t,r=r.inverted(),q(a,a),d=!0}r.fromSecondToFirstPoint(bi,c.v0.point),r.fromSecondToFirstPoint(gi,c.v1.point),W(wi,l.v0.point,l.v1.point),It(bi,gi,wi,l.v1.point),q(wi,wi),It(gi,bi,wi,l.v0.point),t.length=0;for(const o of[bi,gi]){W(wi,o,l.v0.point);const c=Y(wi,l.normal);if(c>=0)continue;const h=T();r.fromFirstPoint(h,o);const u=T();R(u,h,a,c);const f=T();r.toSecondPoint(f,h);const p=T();r.toFirstPoint(p,u),t.push({collider0:d?s:e,collider1:d?e:s,shape0:i,shape1:n,point0:u,localPoint0:p,point1:h,localPoint1:f,normal:a,depth:-c})}return t},Ti=(t,e,i,s,n,r,o)=>{const a=T();L(a,o),C(Ai,a),r.toFirstVector(Ai,Ai),q(Ai,Ai);const c=Pi(i,Ai);r.fromFirstPoint(_i,c.v0.point),r.fromFirstPoint(xi,c.v1.point),U(Bi),r.fromSecondPoint(Bi,Bi);const h=T();bt(Ii,_i,xi,Bi),At(h,Ii,_i,xi);const l=T();O(l,h,o),C(Ai,a),r.toSecondVector(Ai,Ai),n.support(l,Ai),r.fromSecondPoint(l,l);const d=J(h,l),u=T();r.toFirstPoint(u,h);const f=T();return r.toSecondPoint(f,l),t.length=0,t.push({collider0:e,collider1:s,shape0:i,shape1:n,point0:h,localPoint0:u,point1:l,localPoint1:f,normal:a,depth:d}),t},ji=(t,e,i,s,n,r,o)=>{const a=j(o);L(a,a),q(a,a),U(Bi),r.fromFirstPoint(Bi,Bi),U(Si),r.fromSecondPoint(Si,Si);const c=T();R(c,Bi,a,i.radius);const h=T();R(h,Si,a,-n.radius);const l=J(c,h),d=T();r.toFirstPoint(d,c);const u=T();return r.toSecondPoint(u,h),t.length=0,t.push({collider0:e,collider1:s,shape0:i,shape1:n,point0:c,localPoint0:d,point1:h,localPoint1:u,normal:a,depth:l}),t};var Mi=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Ci=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ei=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Oi=class{constructor(t,e){this.settings=t,this.registry=e,this.mtv=T(),this.simplex=new Set,this.initialDir=T()}*detectContacts(t){const e=[];for(const[i,s]of t){const t=zt(i.collider.id,s.collider.id),n=this.registry.getPairById(t);if(!n.intercontact)continue;n.updateTransform(),e.length=0,this.simplex.clear(),N(this.initialDir,i.collider.body.position,s.collider.body.position);if(be(this.simplex,i.shape,s.shape,n.spaceMapping,this.initialDir,-this.settings.narrowPhaseMargin,this.settings.gjkRelError,this.settings.gjkMaxIterations)<this.settings.epaEpsilon)this.simplex.clear(),be(this.simplex,i.shape,s.shape,n.spaceMapping,this.initialDir,0,this.settings.gjkRelError,this.settings.gjkMaxIterations),Ae(this.mtv,this.simplex,i.shape,s.shape,n.spaceMapping,0,this.settings.epaEpsilon,this.settings.epaMaxIterations),q(this.mtv,this.mtv);else{const t=T(),e=T();ge(this.mtv,this.simplex),n.spaceMapping.toSecondVector(e,this.mtv),s.shape.support(e,e),n.spaceMapping.fromSecondPoint(e,e),q(this.mtv,this.mtv),n.spaceMapping.toFirstVector(t,this.mtv),i.shape.support(t,t),n.spaceMapping.fromFirstPoint(t,t),q(this.mtv,this.mtv);const r=Y(this.mtv,e);if(Y(this.mtv,t)>=r)continue}i.shape instanceof Nt&&s.shape instanceof Nt?yield*Fi(e,i.collider,i.shape,s.collider,s.shape,n.spaceMapping,this.mtv):i.shape instanceof Nt&&s.shape instanceof Rt?yield*Ti(e,i.collider,i.shape,s.collider,s.shape,n.spaceMapping,this.mtv):i.shape instanceof Rt&&s.shape instanceof Nt?yield*Ti(e,s.collider,s.shape,i.collider,i.shape,n.spaceMapping.inverted(),M(-this.mtv[0],-this.mtv[1])):i.shape instanceof Rt&&s.shape instanceof Rt&&(yield*ji(e,s.collider,s.shape,i.collider,i.shape,n.spaceMapping,this.mtv))}}};Oi=Mi([m(),Ei(0,v("SETTINGS")),Ei(1,v("PAIRS_REGISTRY")),Ci("design:paramtypes",[Object,Object])],Oi);class Ni{constructor(t,e,i,s,n){this.body=t,this.shape=e,this.mask=i,this.virtual=s,this.material=n,this.aabb=new ce}get id(){return this.body.id}get transform(){return this.body.transform}updateAABB(){this.shape.aabb(this.aabb,this.body.transform)}}var ki;!function(t){t.BodyCreated="BodyCreated",t.BodyDestroyed="BodyDestroyed",t.ColliderAdded="ColliderAdded",t.ColliderRemoved="ColliderRemoved",t.JointAdded="JointAdded",t.JointRemoved="JointRemoved",t.CollisionStart="CollisionStart",t.Collide="Collide",t.CollisionEnd="CollisionEnd",t.PreStep="PreStep",t.IslandPreStep="IslandPreStep",t.IslandPostStep="IslandPostStep",t.PostStep="PostStep",t.FallAsleep="FallAsleep",t.Awake="Awake"}(ki||(ki={}));class Ri{constructor(t,e,i){this.id=t,this.world=e,this.continuous=i,this.omega=0,this.angle=0,this.bodyIndex=-1,this.islandId=-1,this.joints=new Set,this.contacts=new Set,this.solverConstraints=[],this._position=T(),this._velocity=T(),this._force=T(),this._torque=0,this._mass=0,this._invMass=0,this._invInertia=0,this._inertia=0,this._isStatic=!1,this._isSleeping=!1,this._sleepTimer=0,this._transform=w(),this._invTransform=w()}get velocity(){return this._velocity}get force(){return this._force}get torque(){return this._torque}get invMass(){return this._invMass}get mass(){return this._mass}get invInertia(){return this._invInertia}get inertia(){return this._inertia}get isStatic(){return this._isStatic}get isSleeping(){return this._isSleeping}get transform(){return this._transform}get invTransform(){return this._invTransform}get position(){return this._position}set position(t){C(this._position,t)}set velocity(t){C(this._velocity,t)}set force(t){C(this._force,t)}set torque(t){this._torque=t}set mass(t){this._mass=t,this._invMass=1/t,this._isStatic=!Number.isFinite(this._mass)&&!Number.isFinite(this._inertia)}set inertia(t){this._inertia=t,this._invInertia=1/t,this._isStatic=!Number.isFinite(this._mass)&&!Number.isFinite(this._inertia)}addJoint(t){this.joints.add(t),this.awake()}removeJoint(t){this.joints.delete(t),this.awake()}addContact(t){this.contacts.add(t),this.awake()}removeContact(t){this.contacts.delete(t),this.awake()}updateTransform(){I(this._transform,this._position),x(this._transform,this._transform,this.angle),mt(this._invTransform,this._transform)}applyForce(t,e){if(O(this._force,this._force,t),e){const i=T();G(i,e,this.transform),W(i,i,this._position),this._torque=vt(i,t)}this.awake()}clearForces(){U(this._force),this._torque=0}toLocalPoint(t,e){return G(t,e,this._invTransform)}toGlobalPoint(t,e){return G(t,e,this._transform)}tick(t){if(!this.isStatic){const e=z(this.velocity),i=Math.abs(this.omega);e<=this.world.settings.sleepingVelocityThreshold&&i<=this.world.settings.sleepingAngularVelocityThreshold?(this._sleepTimer-=t,this._sleepTimer<=0&&this.fallAsleep()):this.awake()}}awake(){this._isSleeping&&this.world.dispatch(ki.Awake,this),this._isSleeping=!1,this._sleepTimer=this.world.settings.fallAsleepTimer}fallAsleep(){this._isSleeping||this.world.dispatch(ki.FallAsleep,this),this._isSleeping=!0}}class Ji{constructor(){this.bodyA=null,this.bodyB=null,this.cache=[0,0]}getCache(t){return this.cache[t]}setCache(t,e){this.cache[t]=e}}const Vi=T(),zi=T(),Di=new Float32Array(6),qi=new Float32Array(6);class Li extends Ji{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.joint=s,this.normal=n,this.penetration=r}getJacobian(t){Di.fill(0),t.fill(0),W(Vi,this.joint,this.bodyA.position),Di[0]=t[0]=-this.normal[0],Di[1]=t[1]=-this.normal[1],Di[2]=t[2]=-vt(Vi,this.normal),W(zi,this.joint,this.bodyB.position),Di[3]=t[3]=this.normal[0],Di[4]=t[4]=this.normal[1],Di[5]=t[5]=vt(zi,this.normal)}getPushFactor(t,e){if(e){const i=this.penetration-this.world.settings.contactConstraintSlop;return Math.max(i,0)/t*e}{const t=Math.min(this.bodyA.collider.material.restitution,this.bodyB.collider.material.restitution);return-this.getCDot()*t}}getClamping(){return{min:0,max:this.world.settings.constraintMaxForce}}setPenetration(t){this.penetration=t}patch(t,e){C(this.joint,t),this.penetration=e}getCDot(){return qi.fill(0),qi[0]=this.bodyA.velocity[0],qi[1]=this.bodyA.velocity[1],qi[2]=this.bodyA.omega,qi[3]=this.bodyB.velocity[0],qi[4]=this.bodyB.velocity[1],qi[5]=this.bodyB.omega,((t,e)=>{let i=0;for(let s=0,n=t.length;s<n;s++)i+=t[s]*e[s];return i})(qi,Di)}}class Yi extends Ji{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.distance=r,this.pa=T(),this.pb=T(),this.pbpa=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.pbpa,this.pb,this.pa),L(this.pbpa,this.pbpa),W(this.ra,this.pa,this.bodyA.position),t[0]=-this.pbpa[0],t[1]=-this.pbpa[1],t[2]=-vt(this.ra,this.pbpa),W(this.rb,this.pb,this.bodyB.position),t[3]=this.pbpa[0],t[4]=this.pbpa[1],t[5]=vt(this.rb,this.pbpa)}getPushFactor(t,e=1){return G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),(this.distance-J(this.pb,this.pa))*e/t}getClamping(){return{min:-this.world.settings.constraintMaxForce,max:this.world.settings.constraintMaxForce}}}class Gi extends Yi{getPushFactor(t,e=1){G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform);const i=this.distance-J(this.pb,this.pa);return i<0?i/t:e*i/t}getClamping(){return{min:0,max:this.world.settings.constraintMaxForce}}}class Ui extends Yi{getPushFactor(t,e=1){G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform);const i=this.distance-J(this.pb,this.pa);return i>0?i/t:e*i/t}getClamping(){return{min:-this.world.settings.constraintMaxForce,max:0}}}const Wi=T(),Ki=T(),Hi=T();class Xi extends Ji{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.joint=s,this.normal=n,this.mu=r}getJacobian(t){t.fill(0),E(Wi,-this.normal[1],this.normal[0]),W(Ki,this.joint,this.bodyA.position),t[0]=-Wi[0],t[1]=-Wi[1],t[2]=-vt(Ki,Wi),W(Hi,this.joint,this.bodyB.position),t[3]=Wi[0],t[4]=Wi[1],t[5]=vt(Hi,Wi)}getPushFactor(){return 0}getClamping(){const t=this.bodyA.mass,e=this.bodyB.mass,i=Number.isFinite(t)&&Number.isFinite(e)?.5*(t+e):Number.isFinite(t)?t:Number.isFinite(e)?e:0,s=Math.abs(this.mu*i*Y(this.world.settings.gravity,this.normal));return{min:-s,max:s}}patch(t,e){C(this.joint,t),C(this.normal,e)}}class $i extends Ji{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.axisA=r,this.tangent=T(),this.pa=T(),this.pb=T(),this.u=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),E(this.tangent,-this.axisA[1],this.axisA[0]),_t(this.tangent,this.tangent,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),G(this.pa,this.jointA,this.bodyA.transform),W(this.u,this.pb,this.pa),W(this.ra,this.pa,this.bodyA.position),O(this.ra,this.ra,this.u),t[0]=-this.tangent[0],t[1]=-this.tangent[1],t[2]=-vt(this.ra,this.tangent),W(this.rb,this.pb,this.bodyB.position),t[3]=this.tangent[0],t[4]=this.tangent[1],t[5]=vt(this.rb,this.tangent)}getPushFactor(t,e){return E(this.tangent,-this.axisA[1],this.axisA[0]),_t(this.tangent,this.tangent,this.bodyA.transform),G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.u,this.pb,this.pa),-Y(this.tangent,this.u)/t*e}getClamping(){return{min:-this.world.settings.constraintMaxForce,max:this.world.settings.constraintMaxForce}}}class Zi extends Ji{constructor(t,e,i,s){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.angle=s}getJacobian(t){t.fill(0),isFinite(this.bodyA.inertia)&&(t[0]=0,t[1]=0,t[2]=-1),isFinite(this.bodyB.inertia)&&(t[3]=0,t[4]=0,t[5]=1)}getPushFactor(t,e){return(this.angle-(this.bodyB.angle-this.bodyA.angle))/t*e}getClamping(){return{min:-this.world.settings.constraintMaxForce,max:this.world.settings.constraintMaxForce}}}class Qi extends Ji{constructor(t,e,i,s,n){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.pa=T(),this.pb=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=1,t[1]=0,t[2]=-this.ra[1],G(this.pb,this.jointB,this.bodyB.transform),W(this.rb,this.pb,this.bodyB.position),t[3]=-1,t[4]=0,t[5]=this.rb[1]}getPushFactor(t,e){return G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),-(this.pa[0]-this.pb[0])/t*e}getClamping(){return{min:-this.world.settings.constraintMaxForce,max:this.world.settings.constraintMaxForce}}}class ts extends Ji{constructor(t,e,i,s,n){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.pa=T(),this.pb=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=0,t[1]=1,t[2]=this.ra[0],G(this.pb,this.jointB,this.bodyB.transform),W(this.rb,this.pb,this.bodyB.position),t[3]=0,t[4]=-1,t[5]=-this.rb[0]}getPushFactor(t,e){return G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),-(this.pa[1]-this.pb[1])/t*e}getClamping(){return{min:-this.world.settings.constraintMaxForce,max:this.world.settings.constraintMaxForce}}}class es extends Zi{getPushFactor(t){const e=this.angle-(this.bodyB.angle-this.bodyA.angle);return e<0?e/t:0}getClamping(){return{min:0,max:this.world.settings.constraintMaxForce}}}class is extends Zi{getPushFactor(t){const e=this.angle-(this.bodyB.angle-this.bodyA.angle);return e>0?e/t:0}getClamping(){return{min:-this.world.settings.constraintMaxForce,max:0}}}class ss extends Ji{constructor(t,e,i,s){super(),this.world=t,this.bodyA=e,this.speed=i,this.torque=s}getJacobian(t){t.fill(0),isFinite(this.bodyA.inertia)&&(t[0]=0,t[1]=0,t[2]=1)}getPushFactor(){return this.speed}getClamping(){return{min:-this.torque,max:this.torque}}}class ns extends Ji{constructor(t,e,i,s,n,r,o,a){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.length=r,this.stiffness=o,this.extinction=a,this.pa=T(),this.pb=T(),this.ra=T(),this.rb=T(),this.va=T(),this.vb=T(),this.pbpa=T(),this.normal=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.pbpa,this.pb,this.pa),L(this.pbpa,this.pbpa),W(this.ra,this.pa,this.bodyA.position),t[0]=-this.pbpa[0],t[1]=-this.pbpa[1],t[2]=-vt(this.ra,this.pbpa),W(this.rb,this.pb,this.bodyB.position),t[3]=this.pbpa[0],t[4]=this.pbpa[1],t[5]=vt(this.rb,this.pbpa)}getPushFactor(){return 0}getClamping(){G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.ra,this.pa,this.bodyA.position),E(this.ra,-this.ra[1],this.ra[0]),W(this.rb,this.pb,this.bodyB.position),E(this.rb,-this.rb[1],this.rb[0]),W(this.normal,this.pb,this.pa);const t=z(this.normal);k(this.normal,this.normal,1/t),C(this.va,this.bodyA.velocity),R(this.va,this.va,this.ra,this.bodyA.omega),C(this.vb,this.bodyB.velocity),R(this.vb,this.vb,this.rb,this.bodyB.omega);const e=this.extinction*(Y(this.normal,this.va)-Y(this.normal,this.vb)),i=this.stiffness*(this.length-t)+e;return{min:i,max:i}}}class rs extends Ji{constructor(t,e,i,s,n,r=Number.POSITIVE_INFINITY){super(),this.world=t,this.bodyA=e,this.joint=i,this.control=s,this.stiffness=n,this.maxForce=r,this.pa=T(),this.ra=T(),this.cursor=T()}getJacobian(t){t.fill(0),G(this.pa,this.joint,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=1,t[1]=0,t[2]=-this.ra[1]}getPushFactor(t){return this.control.getCursorPosition(this.cursor),G(this.pa,this.joint,this.bodyA.transform),-(this.pa[0]-this.cursor[0])/t*this.stiffness}getClamping(){return{min:-this.maxForce,max:this.maxForce}}}class os extends Ji{constructor(t,e,i,s,n,r=Number.POSITIVE_INFINITY){super(),this.world=t,this.bodyA=e,this.joint=i,this.control=s,this.stiffness=n,this.maxForce=r,this.pa=T(),this.ra=T(),this.cursor=T()}getJacobian(t){t.fill(0),G(this.pa,this.joint,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=0,t[1]=1,t[2]=this.ra[0]}getPushFactor(t){return this.control.getCursorPosition(this.cursor),G(this.pa,this.joint,this.bodyA.transform),-(this.pa[1]-this.cursor[1])/t*this.stiffness}getClamping(){return{min:-this.maxForce,max:this.maxForce}}}class as extends Ji{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.angle=s,this.stiffness=n,this.extinction=r}getJacobian(t){t.fill(0),isFinite(this.bodyA.inertia)&&(t[0]=0,t[1]=0,t[2]=-1),isFinite(this.bodyB.inertia)&&(t[3]=0,t[4]=0,t[5]=1)}getPushFactor(){return 0}getClamping(){const t=-this.extinction*(this.bodyB.omega-this.bodyA.omega),e=this.stiffness*(this.angle-(this.bodyB.angle-this.bodyA.angle))+t;return{min:e,max:e}}}class cs{constructor(t,e,i,s,n,r){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.distance=r,this.distanceConstraint=new Yi(t,e,j(i),s,j(n),r)}*[Symbol.iterator](){yield this.distanceConstraint}}class hs{constructor(t,e,i,s,n,r,o,a,c){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.localAxis=r,this.refAngle=o,this.minDistance=a,this.maxDistance=c,this.constraints=[],this.constraints.push(new $i(t,e,j(i),s,j(n),j(r)),new Zi(t,e,s,o)),a&&this.constraints.push(new Gi(t,e,j(i),s,j(n),a)),isFinite(c)&&this.constraints.push(new Ui(t,e,j(i),s,j(n),c))}*[Symbol.iterator](){yield*this.constraints}}class ls{constructor(t,e,i,s,n,r,o,a,c){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.minAngle=r,this.maxAngle=o,this.stiffness=a,this.damping=c,this.constraints=[],this.constraints.push(new Qi(t,e,j(i),s,j(n))),this.constraints.push(new ts(t,e,j(i),s,j(n))),isFinite(this.minAngle)&&this.constraints.push(new es(t,e,s,this.minAngle)),isFinite(this.maxAngle)&&this.constraints.push(new is(t,e,s,this.maxAngle)),this.stiffness&&this.constraints.push(new as(t,e,s,s.angle-e.angle,this.stiffness,this.damping))}*[Symbol.iterator](){yield*this.constraints}}class ds{constructor(t,e,i,s,n,r,o,a){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.distance=r,this.stiffness=o,this.extinction=a,this.springConstraint=new ns(t,e,j(i),s,j(n),r,o,a)}*[Symbol.iterator](){yield this.springConstraint}}class us{constructor(t,e,i,s,n,r){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.refAngle=r,this.revoluteXConstraint=new Qi(t,e,j(i),s,j(n)),this.revoluteYConstraint=new ts(t,e,j(i),s,j(n)),this.angleConstraint=new Zi(t,e,s,r||s.angle-e.angle)}*[Symbol.iterator](){yield this.revoluteXConstraint,yield this.revoluteYConstraint,yield this.angleConstraint}}class fs{constructor(t,e,i,s,n,r,o,a){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.localAxis=r,this.minDistance=o,this.maxDistance=a,this.constraints=[],this.constraints.push(new $i(t,e,j(i),s,j(n),j(r))),o&&this.constraints.push(new Gi(t,e,j(i),s,j(n),o)),isFinite(a)&&this.constraints.push(new Ui(t,e,j(i),s,j(n),a))}*[Symbol.iterator](){yield*this.constraints}}class ps{constructor(t,e,i,s,n,r){this.world=t,this.control=e,this.bodyA=i,this.joint=s,this.stiffness=n,this.maxForce=r,this.bodyB=null,this.mouseXConstraint=new rs(t,i,s,e,n,r),this.mouseYConstraint=new os(t,i,s,e,n,r)}*[Symbol.iterator](){yield this.mouseXConstraint,yield this.mouseYConstraint}}class ys{constructor(t,e,i,s){this.world=t,this.bodyA=e,this.speed=i,this.torque=s,this.bodyB=null,this.motorConstraint=new ss(t,e,i,s)}*[Symbol.iterator](){yield this.motorConstraint}}class vs{constructor(t){this.contactInfo=t;const e=t.collider0.body.world;this.contactConstraint=new Li(e,t.collider0.body,t.collider1.body,j(t.point0),M(-t.normal[0],-t.normal[1]),t.depth);const i=.5*(t.collider0.material.friction+t.collider1.material.friction);i>0&&(this.frictionConstraint=new Xi(e,t.collider0.body,t.collider1.body,j(t.point0),M(-t.normal[0],-t.normal[1]),i))}get bodyA(){return this.contactInfo.collider0.body}get bodyB(){return this.contactInfo.collider1.body}*[Symbol.iterator](){yield this.contactConstraint,this.frictionConstraint&&(yield this.frictionConstraint)}patchPenetration(t){this.contactConstraint.setPenetration(t)}patch(t){this.contactConstraint.patch(t.point0,t.depth),this.frictionConstraint&&this.frictionConstraint.patch(t.point0,M(-t.normal[0],-t.normal[1]))}}class ms{constructor(t,e,i,s){this.friction=t,this.restitution=e,this.damping=i,this.angularDamping=s}}var bs=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},gs=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ws=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let As=class{constructor(t,e,i,s,n,r,o){this.settings=t,this.islandGenerator=e,this.registry=i,this.detector=s,this.clock=n,this.idManager=r,this.dispatcher=o,this.bodies=new Map,this.bodyForce=T()}createBody(t){var e,i,s,n,r;if(this.bodies.size===this.settings.maxBodiesNumber)throw new Error(`World.createBody: Failed to create body: maximum namber of bodies attained: ${this.settings.maxBodiesNumber}`);const o=new Ri(this.idManager.getUniqueId(),this,null!==(e=t.isContinuos)&&void 0!==e&&e);return o.mass=null!==(i=t.mass)&&void 0!==i?i:1,o.inertia=null!==(s=null==t?void 0:t.inertia)&&void 0!==s?s:1,o.position=null!==(n=t.position)&&void 0!==n?n:T(),o.angle=null!==(r=t.angle)&&void 0!==r?r:0,o.updateTransform(),this.bodies.set(o.id,o),this.dispatch(ki.BodyCreated,o),o}destroyBody(t){this.bodies.has(t.id)&&(this.bodies.delete(t.id),this.idManager.releaseId(t.id),t.collider&&this.removeCollider(t.collider),this.dispatch(ki.BodyDestroyed,t))}getBody(t){return this.bodies.get(t)}addDistanceJoint(t){var e,i;const s=new cs(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),t.distance);return t.bodyA.addJoint(s),t.bodyB.addJoint(s),this.dispatch(ki.JointAdded,s),s}addPrismaticJoint(t){var e,i,s,n,r,o;const a=new hs(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.localAxis)&&void 0!==s?s:M(1,0),null!==(n=t.refAngle)&&void 0!==n?n:0,null!==(r=t.minDistance)&&void 0!==r?r:0,null!==(o=t.maxDistance)&&void 0!==o?o:Number.POSITIVE_INFINITY);return t.bodyA.addJoint(a),t.bodyB.addJoint(a),this.dispatch(ki.JointAdded,a),a}addRevoluteJoint(t){var e,i,s,n,r,o,a;const c=new ls(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.minAngle)&&void 0!==s?s:Number.NEGATIVE_INFINITY,null!==(n=t.maxAngle)&&void 0!==n?n:Number.POSITIVE_INFINITY,null!==(r=t.stiffness)&&void 0!==r?r:0,null!==(o=t.damping)&&void 0!==o?o:0);if(t.bodyA.addJoint(c),t.bodyB.addJoint(c),null!==(a=t.contacts)&&void 0!==a||(t.contacts=!0),!t.contacts&&t.bodyA.collider&&t.bodyB.collider){this.registry.getPairById(zt(t.bodyA.collider.id,t.bodyB.collider.id)).intercontact=!1}return this.dispatch(ki.JointAdded,c),c}addWeldJoint(t){var e,i,s;const n=new us(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.refAngle)&&void 0!==s?s:0);if(t.bodyA.addJoint(n),t.bodyB.addJoint(n),t.bodyA.collider&&t.bodyB.collider){this.registry.getPairById(zt(t.bodyA.collider.id,t.bodyB.collider.id)).intercontact=!1}return this.dispatch(ki.JointAdded,n),n}addWheelJonit(t){var e,i,s,n,r;const o=new fs(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.localAxis)&&void 0!==s?s:M(1,0),null!==(n=t.minDistance)&&void 0!==n?n:0,null!==(r=t.maxDistance)&&void 0!==r?r:Number.POSITIVE_INFINITY);return t.bodyA.addJoint(o),t.bodyB.addJoint(o),this.dispatch(ki.JointAdded,o),o}addSpring(t){var e,i,s,n,r;const o=new ds(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.distance)&&void 0!==s?s:.5,null!==(n=t.stiffness)&&void 0!==n?n:1,null!==(r=t.extinction)&&void 0!==r?r:1);return t.bodyA.addJoint(o),t.bodyB.addJoint(o),this.dispatch(ki.JointAdded,o),o}addMouseJoint(t){var e,i;const s=new ps(this,t.control,t.body,t.joint,null!==(e=t.stiffness)&&void 0!==e?e:1,null!==(i=t.maxForce)&&void 0!==i?i:1e4);return t.body.addJoint(s),this.dispatch(ki.JointAdded,s),s}addMotor(t){const e=new ys(this,t.body,t.speed,t.torque);return t.body.addJoint(e),this.dispatch(ki.JointAdded,e),e}addCollider(t){var e,i,s;const n=Object.assign(Object.assign({},this.settings.defaultMaterial),null!==(e=t.material)&&void 0!==e?e:{}),r=new ms(n.friction,n.restitution,n.damping,n.angularDamping),o=new Ni(t.body,t.shape,null!==(i=t.mask)&&void 0!==i?i:4294967295,null!==(s=t.isVirtual)&&void 0!==s&&s,r);Object.assign(o.body,{collider:o}),this.detector.registerCollider(o);for(const t of this.bodies.values())o.body.isStatic&&t.isStatic||!t.collider||t.collider===o||this.registry.registerPair(t.collider,o);return this.dispatch(ki.ColliderAdded,o,o.body),o}removeCollider(t){this.detector.unregisterCollider(t),Object.assign(t.body,{collider:null});for(const e of this.bodies.values()){const i=zt(e.collider.id,t.id);this.registry.unregisterPair(i)}this.dispatch(ki.ColliderRemoved,t,t.body)}removeJoint(t){t.bodyA&&t.bodyA.removeJoint(t),t.bodyB&&t.bodyB.removeJoint(t),this.dispatch(ki.JointRemoved,t)}clear(){for(const t of this.bodies.values())t.collider&&this.detector.unregisterCollider(t.collider),this.dispatch(ki.BodyDestroyed,t);this.registry.clear(),this.idManager.reset(),this.bodies.clear()}on(t,e){this.dispatcher.addEventListener(t,e)}off(t,e){this.dispatcher.removeEventListener(t,e)}dispatch(t,...e){this.dispatcher.dispatch(t,...e)}step(t){this.clock.tick(t),this.dispatch(ki.PreStep,this.clock.frame,this.clock.time);let e=this.settings.toiSubsteps,i=t,s=0,n=0;this.applyGlobalForces();do{s=this.detector.getTimeOfFirstImpact(i),s<.001&&(s=1),n=i*s,this.detectCollisions(),this.advance(n),i-=n}while(e--&&s<1);this.clearForces();for(const e of this.bodies.values())e.tick(t);this.dispatch(ki.PostStep,this.clock.frame,this.clock.time)}*[Symbol.iterator](){yield*this.bodies.values()}applyGlobalForces(){for(const t of this)C(this.bodyForce,t.force),t.invMass&&R(this.bodyForce,this.bodyForce,this.settings.gravity,t.mass),t.collider&&(R(this.bodyForce,this.bodyForce,t.velocity,-t.collider.material.damping),t.force=this.bodyForce,t.torque-=t.collider.material.angularDamping*t.omega)}clearForces(){for(const t of this.bodies.values())t.clearForces()}advance(t){for(const e of this.islandGenerator.generate(this.bodies.values()))e.sleeping||(this.dispatch(ki.IslandPreStep,e),e.step(t),this.dispatch(ki.IslandPostStep,e))}detectCollisions(){this.registry.validatePairs();for(const t of this.detector.detectCollisions())this.registry.addContact(t);this.registry.emitEvents()}};As=bs([m(),ws(0,v("SETTINGS")),ws(1,v("ISLANDS_GENERATOR")),ws(2,v("PAIRS_REGISTRY")),gs("design:paramtypes",[Object,Object,Object,Ne,qt,Vt,Gt])],As);class _s{constructor(t,e,i){this.settings=t,this.solver=e,this.memory=i,this.bodies=[],this.constraints=[],this.id=-1,this._sleeping=!0,this.bodyPosition=T(),this.bodyVelocity=T(),this.stack=new Qt(this.memory.reserve(60*this.settings.maxBodiesNumber))}get sleeping(){return this._sleeping}get empty(){return 0===this.bodies.length}setId(t){this.id=t}addBody(t){t.bodyIndex=this.bodies.length,t.islandId=this.id,this._sleeping=this._sleeping&&t.isSleeping,this.bodies.push(t)}addJoint(t){this.constraints.push(...t)}clear(){this.bodies.length=0,this.constraints.length=0,this._sleeping=!0}step(t){this.constraints.length>0?this.solve(t):this.integrate(t)}solve(t){const e=3*this.bodies.length;this.positions=this.stack.pushFloat32(e),this.velocities=this.stack.pushFloat32(e),this.solver.solve(this.positions,this.velocities,this.bodies,this.constraints,t),this.arraysToBodies(this.positions,this.velocities),this.stack.clear()}integrate(t){const e=3*this.bodies.length;this.positions=this.stack.pushFloat32(e),this.velocities=this.stack.pushFloat32(e),this.forces=this.stack.pushFloat32(e),this.invMasses=this.stack.pushFloat32(e),this.accelerations=this.stack.pushFloat32(e),this.serializeBodies(this.bodies),$(this.accelerations,this.forces,this.invMasses),Z(this.velocities,this.velocities,this.accelerations,t),Z(this.positions,this.positions,this.velocities,t),this.arraysToBodies(this.positions,this.velocities),this.stack.clear()}serializeBodies(t){let e=0;for(const i of t){const t=i.position,s=i.velocity,n=i.force;this.positions[e]=t[0],this.positions[e+1]=t[1],this.positions[e+2]=i.angle,this.velocities[e]=s[0],this.velocities[e+1]=s[1],this.velocities[e+2]=i.omega,this.forces[e]=n[0],this.forces[e+1]=n[1],this.forces[e+2]=i.torque,this.invMasses[e]=this.invMasses[e+1]=i.invMass,this.invMasses[e+2]=i.invInertia,e+=3}}arraysToBodies(t,e){const i=3*this.bodies.length;for(let s=0,n=0;s<i;s+=3,n++){const i=this.bodies[n];E(this.bodyPosition,t[s],t[s+1]),i.position=this.bodyPosition,i.angle=t[s+2],E(this.bodyVelocity,e[s],e[s+1]),i.velocity=this.bodyVelocity,i.omega=this.velocities[s+2],i.updateTransform()}}}var xs=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Is=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bs=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Ss=class{constructor(t,e,i){this.bodies=new Set,this.joints=new Set,this.contacts=new Set,this.stack=new Array,this.free=new Set,this.island=new _s(t,e,i)}*generate(t){let e=0;this.bodies.clear(),this.joints.clear(),this.contacts.clear(),this.free.clear();for(const i of t)if(!this.bodies.has(i))if(0!==i.contacts.size||0!==i.joints.size){for(this.island.clear(),this.stack.length=0,this.stack.push(i);this.stack.length;){const t=this.stack.pop();if(!this.bodies.has(t))if(t.isStatic)this.bodies.add(t);else{for(const e of t.joints){if(this.joints.has(e))continue;this.island.addJoint(e),this.joints.add(e);const i=e.bodyA===t?e.bodyB:e.bodyA;i&&!this.bodies.has(i)&&this.stack.push(i)}for(const e of t.contacts){if(this.contacts.has(e))continue;if(this.contacts.add(e),e.contactInfo.collider0.virtual||e.contactInfo.collider1.virtual)continue;this.island.addJoint(e);const i=e.bodyA===t?e.bodyB:e.bodyA;i&&!this.bodies.has(i)&&this.stack.push(i)}this.island.addBody(t),this.bodies.add(t)}}this.island.empty||(this.island.setId(e++),yield this.island)}else this.free.add(i),this.bodies.add(i);if(0!==this.free.size){this.island.clear(),this.island.setId(e++);for(const t of this.free)this.island.addBody(t);yield this.island}}};Ss=xs([m(),Bs(0,v("SETTINGS")),Bs(1,v("CONSTRAINTS_SOLVER")),Is("design:paramtypes",[Object,Object,$t])],Ss);var Ps=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Fs=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ts=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let js=class{constructor(t,e,i){this.joints=new Set,this.contacts=new Set,this.island=new _s(t,e,i)}*generate(t){this.joints.clear(),this.contacts.clear(),this.island.clear();for(const e of t)if(!e.isStatic){for(const t of e.joints)this.joints.has(t)||(this.island.addJoint(t),this.joints.add(t));for(const t of e.contacts)this.contacts.has(t)||(this.contacts.add(t),t.contactInfo.collider0.virtual||t.contactInfo.collider1.virtual||this.island.addJoint(t));this.island.addBody(e)}this.island.empty||(this.island.setId(0),yield this.island)}};js=Ps([m(),Ts(0,v("SETTINGS")),Ts(1,v("CONSTRAINTS_SOLVER")),Fs("design:paramtypes",[Object,Object,$t])],js);var Ms=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Cs=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Es=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Os=class{constructor(t,e,i){this.settings=t,this.linearEquationsSolver=e,this.memory=i,this.J={columns:[],rows:[],values:[],m:0,n:0},this.jacobian=new Float32Array(6),this.lookup=[],this.stack=new Qt(this.memory.reserve(this.getRequiredMemorySize(this.settings.maxBodiesNumber,this.settings.maxConstraintsNumber)))}solve(t,e,i,s,n){this.constraints=s,this.allocate(s.length,3*i.length),this.serializeBodies(i),this.createJacobianMatrix(s,n),this.createConstraintLookup(s),this.solveConstraintForces(this.cvForces,this.c0Forces,n),this.correctPositions(t,n),this.correctVelocities(e,n),this.deallocate()}allocate(t,e){this.rows=t,this.columns=e,this.positions=this.stack.pushFloat32(e),this.velocities=this.stack.pushFloat32(e),this.forces=this.stack.pushFloat32(e),this.invMasses=this.stack.pushFloat32(e),this.accelerations=this.stack.pushFloat32(e),this.c0Forces=this.stack.pushFloat32(e),this.cvForces=this.stack.pushFloat32(e),this.tmpForces=this.stack.pushFloat32(e),this.tmpVelocities=this.stack.pushFloat32(e),this.bhat=this.stack.pushFloat32(e),this.v0=this.stack.pushFloat32(t),this.v1=this.stack.pushFloat32(t),this.cMin=this.stack.pushFloat32(t),this.cMax=this.stack.pushFloat32(t),this.lambdas0=this.stack.pushFloat32(t),this.lambdas1=this.stack.pushFloat32(t),this.b=this.stack.pushFloat32(t),this.bt0=this.stack.pushFloat32(t),this.bt1=this.stack.pushFloat32(t)}serializeBodies(t){let e=0;for(const i of t){const t=i.position,s=i.velocity,n=i.force;this.positions[e]=t[0],this.positions[e+1]=t[1],this.positions[e+2]=i.angle,this.velocities[e]=s[0],this.velocities[e+1]=s[1],this.velocities[e+2]=i.omega,this.forces[e]=n[0],this.forces[e+1]=n[1],this.forces[e+2]=i.torque,this.invMasses[e]=this.invMasses[e+1]=i.invMass,this.invMasses[e+2]=i.invInertia,e+=3,i.solverConstraints.length=0}}createJacobianMatrix(t,e){this.J.m=this.rows,this.J.n=this.columns,this.J.columns.length=this.J.rows.length=this.J.values.length=0;let i=0;const s=this.J.values,n=this.J.columns,r=this.J.rows;for(const o of t){o.getJacobian(this.jacobian);const{min:t,max:a}=o.getClamping();this.cMin[i]=t,this.cMax[i]=a,this.v0[i]=o.getPushFactor(e,this.settings.constraintPushFactor),this.v1[i]=o.getPushFactor(e,0),this.lambdas0[i]=o.getCache(0),this.lambdas1[i]=o.getCache(1),r.push(s.length);const c=o.bodyA,h=o.bodyB;c&&!c.isStatic&&h&&!h.isStatic?(c.solverConstraints.push(i),h.solverConstraints.push(i),c.bodyIndex<h.bodyIndex?(s.push(this.jacobian[0],this.jacobian[1],this.jacobian[2],this.jacobian[3],this.jacobian[4],this.jacobian[5]),n.push(3*c.bodyIndex,3*c.bodyIndex+1,3*c.bodyIndex+2,3*h.bodyIndex,3*h.bodyIndex+1,3*h.bodyIndex+2)):(s.push(this.jacobian[3],this.jacobian[4],this.jacobian[5],this.jacobian[0],this.jacobian[1],this.jacobian[2]),n.push(3*h.bodyIndex,3*h.bodyIndex+1,3*h.bodyIndex+2,3*c.bodyIndex,3*c.bodyIndex+1,3*c.bodyIndex+2))):c&&!c.isStatic?(c.solverConstraints.push(i),s.push(this.jacobian[0],this.jacobian[1],this.jacobian[2]),n.push(3*c.bodyIndex,3*c.bodyIndex+1,3*c.bodyIndex+2)):h&&!h.isStatic&&(h.solverConstraints.push(i),s.push(this.jacobian[3],this.jacobian[4],this.jacobian[5]),n.push(3*h.bodyIndex,3*h.bodyIndex+1,3*h.bodyIndex+2)),i++}r.push(this.J.values.length)}createConstraintLookup(t){this.lookup.length=this.rows;let e=0;for(const i of t){const t=i.bodyA,s=i.bodyB,n=t?t.solverConstraints:[],r=s?s.solverConstraints:[];let o=0,a=0,c=-1;const h=[];for(;o<n.length||a<r.length;){let t;t=o===n.length?r[a++]:a===r.length||n[o]<r[a]?n[o++]:r[a++],c!==t&&(h.push(t),c=t)}this.lookup[e++]=h}}solveConstraintForces(t,e,i){const s=((t,e,i)=>{const s=[],n=[],r=[0];for(let o=0;o<t.m;o++){const a=t.rows[o],c=t.rows[o+1],h=i[o];for(const i of h){let r=0,o=a,h=t.rows[i];const l=t.rows[i+1];for(;o<c&&h<l;)t.columns[h]<t.columns[o]?h++:(t.columns[h]>t.columns[o]||(r+=e[t.columns[o]]*t.values[o]*t.values[h],h++),o++);r&&(s.push(r),n.push(i))}r.push(s.length)}return{m:t.m,n:t.m,values:s,columns:n,rows:r}})(this.J,this.invMasses,this.lookup);$(this.bhat,this.invMasses,this.forces),Z(this.bhat,this.bhat,this.velocities,1/i),((t,e,i)=>{t.fill(0);for(let s=0;s<e.m;s++)for(let n=e.rows[s],r=e.rows[s+1];n<r;n++)t[s]+=i[e.columns[n]]*e.values[n]})(this.b,this.J,this.bhat),tt(this.bt0,this.v0,1/i,this.b,-1),tt(this.bt1,this.v1,1/i,this.b,-1),this.linearEquationsSolver.solve(this.lambdas0,s,this.bt0,this.cMin,this.cMax),this.linearEquationsSolver.solve(this.lambdas1,s,this.bt1,this.cMin,this.cMax),X(t,this.J,this.lambdas0),X(e,this.J,this.lambdas1);for(let t=0;t<this.rows;t++)this.constraints[t].setCache(0,this.lambdas0[t]),this.constraints[t].setCache(1,this.lambdas1[t])}correctPositions(t,e){var i,s;Q(this.tmpForces,this.forces,this.cvForces),i=this.tmpVelocities,s=this.velocities,i.set(s,0),$(this.accelerations,this.tmpForces,this.invMasses),Z(this.tmpVelocities,this.tmpVelocities,this.accelerations,e),Z(t,this.positions,this.tmpVelocities,e)}correctVelocities(t,e){Q(this.tmpForces,this.forces,this.c0Forces),$(this.accelerations,this.tmpForces,this.invMasses),Z(t,this.velocities,this.accelerations,e)}deallocate(){this.stack.clear()}getRequiredMemorySize(t,e){return 120*t+36*e}};Os=Ms([m(),Es(0,v("SETTINGS")),Es(1,v("LINEAR_EQUATIONS_SOLVER")),Cs("design:paramtypes",[Object,Object,$t])],Os);class Ns{constructor(t,e,i){this.collider0=t,this.collider1=e,this.threshold=i,this.a=T(),this.b=T(),this.ab=T(),this.da=T(),this.db=T(),this.contacts=new Set}validate(){for(const t of this.contacts)G(this.a,t.contactInfo.localPoint0,t.contactInfo.collider0.transform),G(this.b,t.contactInfo.localPoint1,t.contactInfo.collider1.transform),W(this.ab,this.b,this.a),Y(this.ab,t.contactInfo.normal)<0?(this.contacts.delete(t),t.bodyA.removeContact(t),t.bodyB.removeContact(t)):(W(this.da,t.contactInfo.point0,this.a),W(this.db,t.contactInfo.point1,this.b),(H(this.da)>=this.threshold||H(this.db)>=this.threshold)&&(this.contacts.delete(t),t.bodyA.removeContact(t),t.bodyB.removeContact(t)));return this.contacts.size>0}addContact(t){for(const e of this.contacts)if(W(this.da,t.point0,e.contactInfo.point0),W(this.db,t.point1,e.contactInfo.point1),H(this.da)<=this.threshold&&H(this.db)<=this.threshold)return void e.patch(t);const e=new vs(t);if(this.contacts.add(e),this.contacts.size>Ns.MAX_CONTACTS){let t=null,i=Number.NEGATIVE_INFINITY;for(const e of this.contacts)e.contactInfo.depth>i&&(t=e,i=e.contactInfo.depth);this.contacts.delete(t);let s=null,n=Number.NEGATIVE_INFINITY;for(const e of this.contacts){const i=V(e.contactInfo.point0,t.contactInfo.point0);i>n&&(n=i,s=e)}this.contacts.delete(s);for(const t of this.contacts)this.contacts.delete(t),e.bodyA.removeContact(t),e.bodyB.removeContact(t);this.contacts.add(t),this.contacts.add(s)}this.contacts.has(e)&&(e.bodyA.addContact(e),e.bodyB.addContact(e))}*[Symbol.iterator](){yield*this.contacts}}Ns.MAX_CONTACTS=2;class ks{constructor(t,e,i){this.collider0=t,this.collider1=e,this.proximityThreshold=i,this.intercontact=!0,this.id=zt(this.collider0.id,this.collider1.id),this.spaceMapping=Pt(this.collider0.transform,this.collider1.transform),this.contactManifold=new Ns(this.collider0,this.collider1,this.proximityThreshold)}updateTransform(){this.spaceMapping.update(this.collider0.transform,this.collider1.transform)}validateContacts(){return this.contactManifold.validate()}addContact(t){this.contactManifold.addContact(t)}}var Rs=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Js=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Vs=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let zs=class{constructor(t,e){this.dispatcher=t,this.settings=e,this.registry=new Map,this.active=new Set,this.deleted=new Set,this.persistent=new Set,this.added=new Set}getPairById(t){return this.registry.get(t)}registerPair(t,e){const i=new ks(t,e,this.settings.contactProximityThreshold);this.registry.set(i.id,i)}unregisterPair(t){const e=this.getPairById(t);e&&(this.registry.delete(t),this.active.delete(e),this.persistent.delete(e),this.added.delete(e),this.deleted.delete(e))}clear(){this.registry.clear(),this.active.clear(),this.deleted.clear(),this.persistent.clear(),this.added.clear()}validatePairs(){this.deleted.clear(),this.persistent.clear(),this.added.clear();for(const t of this.active)t.validateContacts()?this.persistent.add(t):(this.active.delete(t),this.deleted.add(t))}addContact(t){const e=zt(t.collider0.id,t.collider1.id),i=this.registry.get(e);i.addContact(t),this.deleted.delete(i)&&this.persistent.add(i),this.active.add(i),this.added.add(i)}emitEvents(){for(const t of this.deleted)this.dispatcher.dispatch(ki.CollisionEnd,t.collider0,t.collider1);for(const t of this.persistent)this.dispatcher.dispatch(ki.Collide,t.collider0,t.collider1,t.contactManifold),this.added.delete(t);for(const t of this.added)this.dispatcher.dispatch(ki.CollisionStart,t.collider0,t.collider1,t.contactManifold)}};zs=Rs([m(),Vs(1,v("SETTINGS")),Js("design:paramtypes",[Gt,Object])],zs);const Ds={uid:"default",maxBodiesNumber:512,maxConstraintsNumber:4096,gravity:M(0,-9.8),totalReservedMemory:16e6,constraintPushFactor:.25,constraintMaxForce:1e6,defaultMaterial:{friction:.5,restitution:.5,damping:.005,angularDamping:.05},solverIterations:10,islandGenerator:"local",contactProximityThreshold:.005,contactConstraintSlop:.005,sleepingVelocityThreshold:.1,sleepingAngularVelocityThreshold:.1,fallAsleepTimer:.5,broadPhase:"naive",narrowPhase:"sat",narrowPhaseMargin:.01,toiEpsilon:.001,toiPenetrationDepth:.05,toiMaxIterations:8,toiSubsteps:8,gjkRelError:1e-6,gjkMaxIterations:24,epaEpsilon:1e-4,epaMaxIterations:24},qs=(t={})=>((t={})=>{var e;const i=Object.assign(Object.assign({},Ds.defaultMaterial),null!==(e=t.defaultMaterial)&&void 0!==e?e:{});t=Object.assign(Object.assign(Object.assign({},Ds),t),{defaultMaterial:i});const s=f.of(t.uid);if(s.set({id:"SETTINGS",value:t}),s.set({id:"WORLD",type:As}),s.set({id:"MID_PHASE",type:We}),s.set({id:"CONSTRAINTS_SOLVER",type:Os}),s.set({id:"LINEAR_EQUATIONS_SOLVER",type:Mt}),s.set({id:"PAIRS_REGISTRY",type:zs}),"sat"===t.narrowPhase)s.set({id:"NARROW_PHASE",type:mi});else{if("gjk-epa"!==t.narrowPhase)throw new Error("RbPhys2D: Unknown narrow phase identifier, supported keys: \'sat\', \'gjk-epa\'");s.set({id:"NARROW_PHASE",type:Oi})}if("naive"===t.broadPhase)s.set({id:"BROAD_PHASE",type:Re});else{if("sap"!==t.broadPhase)throw new Error("RbPhys2D: Unknown broad phase identifier, supported keys: \'naive\', \'sap\'");s.set({id:"BROAD_PHASE",type:Ge})}if("local"===t.islandGenerator)s.set({id:"ISLANDS_GENERATOR",type:Ss});else{if("sole"!==t.islandGenerator)throw new Error("RbPhys2D: Unknown island generator identifier, supported keys: \'local\', \'sole\'");s.set({id:"ISLANDS_GENERATOR",type:js})}return s})(t).get("WORLD");var Ls="undefined"!=typeof Float32Array?Float32Array:Array;function Ys(){var t=new Ls(3);return Ls!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Gs(t,e,i){var s=new Ls(3);return s[0]=t,s[1]=e,s[2]=i,s}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Us(){var t=new Ls(4);return Ls!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}!function(){var t=Ys()}(),function(){var t,e=(t=new Ls(4),Ls!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var Ws,Ks;function Hs(){var t=new Ls(2);return Ls!=Float32Array&&(t[0]=0,t[1]=0),t}function Xs(t,e,i){return t[0]=e,t[1]=i,t}!function(){var t=Ys(),e=Gs(1,0,0),i=Gs(0,1,0)}(),function(){var t=Us(),e=Us()}(),function(){var t,e=(t=new Ls(9),Ls!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t)}(),function(){var t=Hs()}();class $s{event;collection=new Set;world;constructor(t){this.event=t}get collecting(){return Boolean(this.world)}listen(t){this.world||(this.world=t,t.on(this.event,this.listener))}stop(){this.world.off(this.event,this.listener),this.world=null}reset(){this.collection.clear()}*[Symbol.iterator](){yield*this.collection}listener=(...t)=>this.addToCollection(...t)}class Zs extends $s{addToCollection(t){this.collection.add(t.id)}}class Qs extends $s{addToCollection(t,e){this.collection.add([t.body.id,e.body.id])}}!function(t){t[t.CollisionStart=1]="CollisionStart",t[t.Collide=2]="Collide",t[t.CollisionEnd=4]="CollisionEnd",t[t.FallAsleep=8]="FallAsleep",t[t.Awake=16]="Awake",t[t.BodyCreated=32]="BodyCreated",t[t.BodyDestroyed=64]="BodyDestroyed",t[t.ColliderAdded=128]="ColliderAdded",t[t.ColliderRemoved=256]="ColliderRemoved",t[t.JointAdded=512]="JointAdded",t[t.JointRemoved=1024]="JointRemoved",t[t.PreStep=2048]="PreStep",t[t.IslandPreStep=4096]="IslandPreStep",t[t.IslandPostStep=8192]="IslandPostStep",t[t.PostStep=16384]="PostStep",t[t.Cursor=32768]="Cursor",t[t.Collision=7]="Collision",t[t.Body=120]="Body"}(Ws||(Ws={})),function(t){t[t.Island=1]="Island",t[t.Position=2]="Position",t[t.Angle=4]="Angle",t[t.Velocity=8]="Velocity",t[t.Omega=16]="Omega",t[t.Force=32]="Force",t[t.Torque=64]="Torque",t[t.Mass=128]="Mass",t[t.Inertia=256]="Inertia",t[t.Flag=512]="Flag",t[t.None=0]="None",t[t.All=1023]="All"}(Ks||(Ks={}));const tn=(t,e,i,s)=>{const n=e;if(t[e++]=s,t[e++]=i.id,s&Ks.Island&&(t[e++]=i.islandId),s&Ks.Position)for(const s of i.position)t[e++]=s;if(s&Ks.Angle&&(t[e++]=i.angle),s&Ks.Velocity)for(const s of i.velocity)t[e++]=s;if(s&Ks.Omega&&(t[e++]=i.omega),s&Ks.Force)for(const s of i.force)t[e++]=s;return s&Ks.Torque&&(t[e++]=i.torque),s&Ks.Mass&&(t[e++]=i.mass),s&Ks.Inertia&&(t[e++]=i.inertia),s&Ks.Flag&&(t[e++]=Number(i.isSleeping)),e-n},en=Hs(),sn=(t,e,i)=>{const s=i,n=e[i++];return i++,n&Ks.Island&&(t.islandId=e[i++]),n&Ks.Position&&(Xs(en,e[i++],e[i++]),t.position=en),n&Ks.Angle&&(t.angle=e[i++]),n&Ks.Velocity&&(Xs(en,e[i++],e[i++]),t.velocity=en),n&Ks.Omega&&(t.omega=e[i++]),n&Ks.Force&&(Xs(en,e[i++],e[i++]),t.force=en),n&Ks.Torque&&(t.torque=e[i++]),n&Ks.Mass&&(t.mass=e[i++]),n&Ks.Inertia&&(t.inertia=e[i++]),n&Ks.Flag&&(t.isSleeping=Boolean(e[i++])),i-s},nn=(t,e,i)=>{const s=e;if(i instanceof Zs){t[e++]=Ws[i.event],t[e++]=0;let n=0;for(const s of i)t[e++]=s,n++;t[s+1]=n}else if(i instanceof Qs){t[e++]=Ws[i.event],t[e++]=0;let n=0;for(const[s,r]of i)t[e++]=s,t[e++]=r,n++;t[s+1]=n}else t.fill(0);return e-s};var rn;!function(t){t.Circle="Circle",t.Ellipse="Ellipse",t.Box="Box",t.Capsule="Capsule",t.Polygon="Polygon",t.Mesh="Mesh"}(rn||(rn={}));const on=t=>(t=>t.type===rn.Circle)(t)?new Rt(t.radius):(t=>t.type===rn.Ellipse)(t)?new le(t.a,t.b,t.subdivisions):(t=>t.type===rn.Capsule)(t)?new he(t.radius,t.height,t.subdivisions):(t=>t.type===rn.Box)(t)?new kt(t.width,t.height):(t=>t.type===rn.Polygon)(t)?new Nt(t.points,t.transformOrigin):(t=>t.type===rn.Mesh)(t)?new ae(t.mesh,t.transformOrigin):void 0;var an;!function(t){t.CreateWorld="CreateWorld",t.CreateBody="CreateBody",t.DestroyBody="DestroyBody",t.AddDistanceJoint="AddDistanceJoint",t.AddPrismaticJoint="AddPrismaticJoint",t.AddRevoluteJoint="AddRevoluteJoint",t.AddWeldJoint="AddWeldJoint",t.AddWheelJoint="AddWheelJoint",t.AddSpring="AddSpring",t.AddMouseJoint="AddMouseJoint",t.AddMotor="AddMotor",t.RemoveJoint="RemoveJoint",t.AddCollider="AddCollider",t.RemoveCollider="RemoveCollider",t.UpdateTransform="UpdateTransform",t.Clear="Clear",t.Return="Return",t.On="On",t.Off="Off"}(an||(an={}));class cn{bodiesBuffer;eventsBuffer;frame;time;dt;name="Step";constructor(t,e,i,s,n){this.bodiesBuffer=t,this.eventsBuffer=e,this.frame=i,this.time=s,this.dt=n}}const hn=(t,e="ok")=>({name:`${t.name}Result`,timestamp:Date.now(),task:t,result:e}),ln=(t,e)=>({name:`${t.name}Result`,timestamp:Date.now(),task:t,error:e});class dn{timer;interval;start(t,e){if(this.interval=e,"string"==typeof e){const e=()=>{t(.01667),self.requestAnimationFrame(e)};this.timer=self.requestAnimationFrame(e)}else this.timer=self.setInterval((()=>t(e)),1e3*e)}stop(){"string"==typeof this.interval?self.cancelAnimationFrame(this.timer):self.clearInterval(this.timer),this.timer=null}}class un{cursor=Hs();getCursorPosition(t){return function(t,e){return t[0]=e[0],t[1]=e[1],t}(t,this.cursor)}setCursor(t,e){Xs(this.cursor,t,e)}}const fn=new class{bodiesBuffer;eventsBuffer;world;bodiesNumber=0;joints=new Map;idManager=new Vt;loop=new dn;cursor=new un;eventCollectors=new Map([[ki.Awake,new Zs(ki.Awake)],[ki.FallAsleep,new Zs(ki.FallAsleep)],[ki.CollisionStart,new Qs(ki.CollisionStart)],[ki.Collide,new Qs(ki.Collide)],[ki.CollisionEnd,new Qs(ki.CollisionEnd)]]);processTask(t){switch(t.name){case an.CreateWorld:return this.createWorld(t);case an.CreateBody:return this.createBody(t);case an.DestroyBody:return this.destroyBody(t);case an.AddDistanceJoint:return this.addDistanceJoint(t);case an.AddPrismaticJoint:return this.addPrismaticJoint(t);case an.AddRevoluteJoint:return this.addRevoluteJoint(t);case an.AddWeldJoint:return this.addWeldJoint(t);case an.AddWheelJoint:return this.addWheelJoint(t);case an.AddSpring:return this.addSpring(t);case an.AddMouseJoint:return this.addMouseJoint(t);case an.AddMotor:return this.addMotor(t);case an.RemoveJoint:return this.removeJoint(t);case an.AddCollider:return this.addCollider(t);case an.RemoveCollider:return this.removeCollider(t);case an.Clear:return this.clear(t);case an.Return:return this.returnBuffer(t);case an.On:return this.on(t);case an.Off:return this.off(t);default:return ln(t,new Error("Unknown message"))}}createWorld(t){try{return this.world=qs(t.settings),this.bodiesBuffer=new Float32Array(15*t.settings.maxBodiesNumber),this.eventsBuffer=new Float32Array(4),this.loop.start((t=>this.step(t)),t.settings.step),hn(t)}catch(e){return ln(t,e)}}createBody(t){const e=this.world.createBody(t.bodyDef);return this.bodiesNumber++,hn(t,e.id)}destroyBody(t){return this.world.destroyBody(this.world.getBody(t.body.id)),this.bodiesNumber--,hn(t)}addDistanceJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,distance:r}=t,o=this.world.addDistanceJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,distance:r}),a=this.idManager.getUniqueId();return this.joints.set(a,o),hn(t,a)}addPrismaticJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,localAxis:r,refAngle:o,minDistance:a,maxDistance:c}=t,h=this.world.addPrismaticJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,localAxis:r,refAngle:o,minDistance:a,maxDistance:c}),l=this.idManager.getUniqueId();return this.joints.set(l,h),hn(t,l)}addRevoluteJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,minAngle:r,maxAngle:o,stiffness:a,damping:c,contacts:h}=t,l=this.world.addRevoluteJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,minAngle:r,maxAngle:o,stiffness:a,damping:c,contacts:h}),d=this.idManager.getUniqueId();return this.joints.set(d,l),hn(t,d)}addWeldJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,refAngle:r}=t,o=this.world.addWeldJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,refAngle:r}),a=this.idManager.getUniqueId();return this.joints.set(a,o),hn(t,a)}addWheelJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,localAxis:r,minDistance:o,maxDistance:a}=t,c=this.world.addWheelJonit({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,localAxis:r,minDistance:o,maxDistance:a}),h=this.idManager.getUniqueId();return this.joints.set(h,c),hn(t,h)}addSpring(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,distance:r,stiffness:o,extinction:a}=t,c=this.world.addSpring({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,distance:r,stiffness:o,extinction:a}),h=this.idManager.getUniqueId();return this.joints.set(h,c),hn(t,h)}addMouseJoint(t){const{cursor:e,body:i,joint:s,maxForce:n,stiffness:r}=t;this.cursor.setCursor(e[0],e[1]);const o=this.world.addMouseJoint({control:this.cursor,body:this.world.getBody(i.id),joint:s,stiffness:r,maxForce:n}),a=this.idManager.getUniqueId();return this.joints.set(a,o),hn(t,a)}addMotor(t){const{body:e,speed:i,torque:s}=t,n=this.world.addMotor({body:this.world.getBody(e.id),speed:i,torque:s}),r=this.idManager.getUniqueId();return this.joints.set(r,n),hn(t,r)}removeJoint(t){if(this.joints.has(t.jointId)){const e=this.joints.get(t.jointId);return this.joints.delete(t.jointId),this.idManager.releaseId(t.jointId),e.bodyA&&e.bodyA.removeJoint(e),e.bodyB&&e.bodyB.removeJoint(e),hn(t)}return ln(t,`TaskWorker: Failed to remove joint, joint with id#${t.jointId} not found. `)}addCollider(t){const{body:e,shape:i,mask:s,isVirtual:n,material:r}=t;return this.world.addCollider({body:this.world.getBody(e.id),shape:on(i),mask:s,isVirtual:n,material:r}),hn(t)}removeCollider(t){const e=this.world.getBody(t.collider.id);return this.world.removeCollider(e.collider),hn(t)}clear(t){return this.world.clear(),this.joints.clear(),this.idManager.reset(),this.bodiesNumber=0,hn(t)}returnBuffer(t){return this.bodiesBuffer=t.bodiesBuffer,this.eventsBuffer=t.eventsBuffer,this.deserializeBodies(t),this.deserializeEvents(t),null}on(t){const e=this.eventCollectors.get(t.event);return e&&!e.collecting&&(e.listen(this.world),this.eventsBuffer=new Float32Array(this.getEventBufferSize())),hn(t)}off(t){const e=this.eventCollectors.get(t.event);return e&&e.collecting&&(e.stop(),this.eventsBuffer=new Float32Array(this.getEventBufferSize())),hn(t)}step(t){this.resetEvents(),this.world.step(t),this.bodiesBuffer.byteLength>0&&this.eventsBuffer.byteLength>0&&this.bodiesNumber>0&&(this.serializeBodies(),this.serializeEvents(),self.postMessage(new cn(this.bodiesBuffer,this.eventsBuffer,this.world.clock.frame,this.world.clock.time,t),{transfer:[this.bodiesBuffer.buffer,this.eventsBuffer.buffer]}))}getEventBufferSize(){let t=1;for(const[e,i]of this.eventCollectors)i.collecting&&(e===ki.Awake&&(t+=this.world.settings.maxBodiesNumber+2),e===ki.FallAsleep&&(t+=this.world.settings.maxBodiesNumber+2),e===ki.CollisionStart&&(t+=8*this.world.settings.maxBodiesNumber+2),e===ki.Collide&&(t+=8*this.world.settings.maxBodiesNumber+2),e===ki.CollisionEnd&&(t+=8*this.world.settings.maxBodiesNumber+2));return t}resetEvents(){for(const t of this.eventCollectors.values())t.reset()}serializeBodies(){let t=0;this.bodiesBuffer[t++]=this.bodiesNumber;for(const e of this.world)t+=tn(this.bodiesBuffer,t,e,Ks.All)}serializeEvents(){let t=0;this.eventsBuffer[t++]=this.eventCollectors.size;for(const e of this.eventCollectors.values())t+=nn(this.eventsBuffer,t,e)}deserializeBodies(t){let e=0;const i=t.bodiesBuffer[e++];for(let s=0;s<i;s++){const i=this.world.getBody(t.bodiesBuffer[e+1]);i&&(e+=sn(i,t.bodiesBuffer,e),i.updateTransform())}}deserializeEvents(t){let e=0;const i=t.eventsBuffer[e++];for(let s=0;s<i;s++){t.eventsBuffer[e++]&Ws.Cursor&&this.cursor.setCursor(t.eventsBuffer[e++],t.eventsBuffer[e++])}}};self.addEventListener("message",(t=>{const e=t.data;if((t=>t&&"taskId"in t)(e)){const t=fn.processTask(e);t&&self.postMessage(t)}}));\n' as string;
