export default 'var t,e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};\n/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the "License"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */!function(t){!function(i){var s="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=r(t);function r(t,e){return function(i,s){"function"!=typeof t[i]&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:s}),e&&e(i,s)}}void 0===s.Reflect?s.Reflect=t:n=r(s.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,s=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Object.create,o={__proto__:[]}instanceof Array,a=!r&&!o,h={create:r?function(){return st(Object.create(null))}:o?function(){return st({__proto__:null})}:function(){return st({})},has:a?function(t,i){return e.call(t,i)}:function(t,e){return e in t},get:a?function(t,i){return e.call(t,i)?t[i]:void 0}:function(t,e){return t[e]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?tt():Map,u=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?et():Set,f=new(l||"function"!=typeof WeakMap?it():WeakMap);function p(t,e,i,s){if(M(i)){if(!Y(t))throw new TypeError;if(!U(e))throw new TypeError;return x(t,e)}if(!Y(t))throw new TypeError;if(!V(e))throw new TypeError;if(!V(s)&&!M(s)&&!k(s))throw new TypeError;return k(s)&&(s=void 0),S(t,e,i=L(i),s)}function y(t,e){function i(i,s){if(!V(i))throw new TypeError;if(!M(s)&&!W(s))throw new TypeError;N(t,e,i,s)}return i}function v(t,e,i,s){if(!V(i))throw new TypeError;return M(s)||(s=L(s)),N(t,e,i,s)}function b(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),B(t,e,i)}function m(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),T(t,e,i)}function g(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),F(t,e,i)}function w(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),j(t,e,i)}function _(t,e){if(!V(t))throw new TypeError;return M(e)||(e=L(e)),E(t,e)}function A(t,e){if(!V(t))throw new TypeError;return M(e)||(e=L(e)),C(t,e)}function I(t,e,i){if(!V(e))throw new TypeError;M(i)||(i=L(i));var s=P(e,i,!1);if(M(s))return!1;if(!s.delete(t))return!1;if(s.size>0)return!0;var n=f.get(e);return n.delete(i),n.size>0||f.delete(e),!0}function x(t,e){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e);if(!M(s)&&!k(s)){if(!U(s))throw new TypeError;e=s}}return e}function S(t,e,i,s){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e,i,s);if(!M(r)&&!k(r)){if(!V(r))throw new TypeError;s=r}}return s}function P(t,e,i){var s=f.get(t);if(M(s)){if(!i)return;s=new d,f.set(t,s)}var n=s.get(e);if(M(n)){if(!i)return;n=new d,s.set(e,n)}return n}function B(t,e,i){if(T(t,e,i))return!0;var s=Q(e);return!k(s)&&B(t,s,i)}function T(t,e,i){var s=P(e,i,!1);return!M(s)&&D(s.has(t))}function F(t,e,i){if(T(t,e,i))return j(t,e,i);var s=Q(e);return k(s)?void 0:F(t,s,i)}function j(t,e,i){var s=P(e,i,!1);if(!M(s))return s.get(t)}function N(t,e,i,s){P(i,s,!0).set(t,e)}function E(t,e){var i=C(t,e),s=Q(t);if(null===s)return i;var n=E(s,e);if(n.length<=0)return i;if(i.length<=0)return n;for(var r=new u,o=[],a=0,h=i;a<h.length;a++){var c=h[a];r.has(c)||(r.add(c),o.push(c))}for(var l=0,d=n;l<d.length;l++){c=d[l];r.has(c)||(r.add(c),o.push(c))}return o}function C(t,e){var i=[],s=P(t,e,!1);if(M(s))return i;for(var n=H(s.keys()),r=0;;){var o=$(n);if(!o)return i.length=r,i;var a=X(o);try{i[r]=a}catch(t){try{Z(n)}finally{throw t}}r++}}function O(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function M(t){return void 0===t}function k(t){return null===t}function R(t){return"symbol"==typeof t}function V(t){return"object"==typeof t?null!==t:"function"==typeof t}function J(t,e){switch(O(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var i=3===e?"string":5===e?"number":"default",n=K(t,s);if(void 0!==n){var r=n.call(t,i);if(V(r))throw new TypeError;return r}return z(t,"default"===i?"number":i)}function z(t,e){if("string"===e){var i=t.toString;if(G(i))if(!V(n=i.call(t)))return n;if(G(s=t.valueOf))if(!V(n=s.call(t)))return n}else{var s;if(G(s=t.valueOf))if(!V(n=s.call(t)))return n;var n,r=t.toString;if(G(r))if(!V(n=r.call(t)))return n}throw new TypeError}function D(t){return!!t}function q(t){return""+t}function L(t){var e=J(t,3);return R(e)?e:q(e)}function Y(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function G(t){return"function"==typeof t}function U(t){return"function"==typeof t}function W(t){switch(O(t)){case 3:case 4:return!0;default:return!1}}function K(t,e){var i=t[e];if(null!=i){if(!G(i))throw new TypeError;return i}}function H(t){var e=K(t,n);if(!G(e))throw new TypeError;var i=e.call(t);if(!V(i))throw new TypeError;return i}function X(t){return t.value}function $(t){var e=t.next();return!e.done&&e}function Z(t){var e=t.return;e&&e.call(t)}function Q(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===c)return e;if(e!==c)return e;var i=t.prototype,s=i&&Object.getPrototypeOf(i);if(null==s||s===Object.prototype)return e;var n=s.constructor;return"function"!=typeof n||n===t?e:n}function tt(){var t={},e=[],i=function(){function t(t,e,i){this._index=0,this._keys=t,this._values=e,this._selector=i}return t.prototype["@@iterator"]=function(){return this},t.prototype[n]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var i=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var i=this._find(t,!0);return this._values[i]=e,this},e.prototype.delete=function(e){var i=this._find(e,!1);if(i>=0){for(var s=this._keys.length,n=i+1;n<s;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new i(this._keys,this._values,s)},e.prototype.values=function(){return new i(this._keys,this._values,r)},e.prototype.entries=function(){return new i(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[n]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function s(t,e){return t}function r(t,e){return e}function o(t,e){return[t,e]}}function et(){return function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[n]=function(){return this.keys()},t}()}function it(){var t=16,i=h.create(),s=n();return function(){function t(){this._key=n()}return t.prototype.has=function(t){var e=r(t,!1);return void 0!==e&&h.has(e,this._key)},t.prototype.get=function(t){var e=r(t,!1);return void 0!==e?h.get(e,this._key):void 0},t.prototype.set=function(t,e){return r(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=r(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=n()},t}();function n(){var t;do{t="@@WeakMap@@"+c()}while(h.has(i,t));return i[t]=!0,t}function r(t,i){if(!e.call(t,s)){if(!i)return;Object.defineProperty(t,s,{value:h.create()})}return t[s]}function o(t,e){for(var i=0;i<e;++i)t[i]=255*Math.random()|0;return t}function a(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t)}function c(){var e=a(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var i="",s=0;s<t;++s){var n=e[s];4!==s&&6!==s&&8!==s||(i+="-"),n<16&&(i+="0"),i+=n.toString(16).toLowerCase()}return i}}function st(t){return t.__=void 0,delete t.__,t}t("decorate",p),t("metadata",y),t("defineMetadata",v),t("hasMetadata",b),t("hasOwnMetadata",m),t("getMetadata",g),t("getOwnMetadata",w),t("getMetadataKeys",_),t("getOwnMetadataKeys",A),t("deleteMetadata",I)}(n)}()}(t||(t={}));\n/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the "License"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar i;!function(t){!function(i){var s="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=r(t);function r(t,e){return function(i,s){"function"!=typeof t[i]&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:s}),e&&e(i,s)}}void 0===s.Reflect?s.Reflect=t:n=r(s.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,s=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Object.create,o={__proto__:[]}instanceof Array,a=!r&&!o,h={create:r?function(){return st(Object.create(null))}:o?function(){return st({__proto__:null})}:function(){return st({})},has:a?function(t,i){return e.call(t,i)}:function(t,e){return e in t},get:a?function(t,i){return e.call(t,i)?t[i]:void 0}:function(t,e){return t[e]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?tt():Map,u=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?et():Set,f=new(l||"function"!=typeof WeakMap?it():WeakMap);function p(t,e,i,s){if(M(i)){if(!Y(t))throw new TypeError;if(!U(e))throw new TypeError;return x(t,e)}if(!Y(t))throw new TypeError;if(!V(e))throw new TypeError;if(!V(s)&&!M(s)&&!k(s))throw new TypeError;return k(s)&&(s=void 0),S(t,e,i=L(i),s)}function y(t,e){function i(i,s){if(!V(i))throw new TypeError;if(!M(s)&&!W(s))throw new TypeError;N(t,e,i,s)}return i}function v(t,e,i,s){if(!V(i))throw new TypeError;return M(s)||(s=L(s)),N(t,e,i,s)}function b(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),B(t,e,i)}function m(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),T(t,e,i)}function g(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),F(t,e,i)}function w(t,e,i){if(!V(e))throw new TypeError;return M(i)||(i=L(i)),j(t,e,i)}function _(t,e){if(!V(t))throw new TypeError;return M(e)||(e=L(e)),E(t,e)}function A(t,e){if(!V(t))throw new TypeError;return M(e)||(e=L(e)),C(t,e)}function I(t,e,i){if(!V(e))throw new TypeError;M(i)||(i=L(i));var s=P(e,i,!1);if(M(s))return!1;if(!s.delete(t))return!1;if(s.size>0)return!0;var n=f.get(e);return n.delete(i),n.size>0||f.delete(e),!0}function x(t,e){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e);if(!M(s)&&!k(s)){if(!U(s))throw new TypeError;e=s}}return e}function S(t,e,i,s){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e,i,s);if(!M(r)&&!k(r)){if(!V(r))throw new TypeError;s=r}}return s}function P(t,e,i){var s=f.get(t);if(M(s)){if(!i)return;s=new d,f.set(t,s)}var n=s.get(e);if(M(n)){if(!i)return;n=new d,s.set(e,n)}return n}function B(t,e,i){if(T(t,e,i))return!0;var s=Q(e);return!k(s)&&B(t,s,i)}function T(t,e,i){var s=P(e,i,!1);return!M(s)&&D(s.has(t))}function F(t,e,i){if(T(t,e,i))return j(t,e,i);var s=Q(e);return k(s)?void 0:F(t,s,i)}function j(t,e,i){var s=P(e,i,!1);if(!M(s))return s.get(t)}function N(t,e,i,s){P(i,s,!0).set(t,e)}function E(t,e){var i=C(t,e),s=Q(t);if(null===s)return i;var n=E(s,e);if(n.length<=0)return i;if(i.length<=0)return n;for(var r=new u,o=[],a=0,h=i;a<h.length;a++){var c=h[a];r.has(c)||(r.add(c),o.push(c))}for(var l=0,d=n;l<d.length;l++){c=d[l];r.has(c)||(r.add(c),o.push(c))}return o}function C(t,e){var i=[],s=P(t,e,!1);if(M(s))return i;for(var n=H(s.keys()),r=0;;){var o=$(n);if(!o)return i.length=r,i;var a=X(o);try{i[r]=a}catch(t){try{Z(n)}finally{throw t}}r++}}function O(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function M(t){return void 0===t}function k(t){return null===t}function R(t){return"symbol"==typeof t}function V(t){return"object"==typeof t?null!==t:"function"==typeof t}function J(t,e){switch(O(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var i=3===e?"string":5===e?"number":"default",n=K(t,s);if(void 0!==n){var r=n.call(t,i);if(V(r))throw new TypeError;return r}return z(t,"default"===i?"number":i)}function z(t,e){if("string"===e){var i=t.toString;if(G(i))if(!V(n=i.call(t)))return n;if(G(s=t.valueOf))if(!V(n=s.call(t)))return n}else{var s;if(G(s=t.valueOf))if(!V(n=s.call(t)))return n;var n,r=t.toString;if(G(r))if(!V(n=r.call(t)))return n}throw new TypeError}function D(t){return!!t}function q(t){return""+t}function L(t){var e=J(t,3);return R(e)?e:q(e)}function Y(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function G(t){return"function"==typeof t}function U(t){return"function"==typeof t}function W(t){switch(O(t)){case 3:case 4:return!0;default:return!1}}function K(t,e){var i=t[e];if(null!=i){if(!G(i))throw new TypeError;return i}}function H(t){var e=K(t,n);if(!G(e))throw new TypeError;var i=e.call(t);if(!V(i))throw new TypeError;return i}function X(t){return t.value}function $(t){var e=t.next();return!e.done&&e}function Z(t){var e=t.return;e&&e.call(t)}function Q(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===c)return e;if(e!==c)return e;var i=t.prototype,s=i&&Object.getPrototypeOf(i);if(null==s||s===Object.prototype)return e;var n=s.constructor;return"function"!=typeof n||n===t?e:n}function tt(){var t={},e=[],i=function(){function t(t,e,i){this._index=0,this._keys=t,this._values=e,this._selector=i}return t.prototype["@@iterator"]=function(){return this},t.prototype[n]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var i=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var i=this._find(t,!0);return this._values[i]=e,this},e.prototype.delete=function(e){var i=this._find(e,!1);if(i>=0){for(var s=this._keys.length,n=i+1;n<s;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new i(this._keys,this._values,s)},e.prototype.values=function(){return new i(this._keys,this._values,r)},e.prototype.entries=function(){return new i(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[n]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function s(t,e){return t}function r(t,e){return e}function o(t,e){return[t,e]}}function et(){return function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[n]=function(){return this.keys()},t}()}function it(){var t=16,i=h.create(),s=n();return function(){function t(){this._key=n()}return t.prototype.has=function(t){var e=r(t,!1);return void 0!==e&&h.has(e,this._key)},t.prototype.get=function(t){var e=r(t,!1);return void 0!==e?h.get(e,this._key):void 0},t.prototype.set=function(t,e){return r(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=r(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=n()},t}();function n(){var t;do{t="@@WeakMap@@"+c()}while(h.has(i,t));return i[t]=!0,t}function r(t,i){if(!e.call(t,s)){if(!i)return;Object.defineProperty(t,s,{value:h.create()})}return t[s]}function o(t,e){for(var i=0;i<e;++i)t[i]=255*Math.random()|0;return t}function a(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t)}function c(){var e=a(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var i="",s=0;s<t;++s){var n=e[s];4!==s&&6!==s&&8!==s||(i+="-"),n<16&&(i+="0"),i+=n.toString(16).toLowerCase()}return i}}function st(t){return t.__=void 0,delete t.__,t}t("decorate",p),t("metadata",y),t("defineMetadata",v),t("hasMetadata",b),t("hasOwnMetadata",m),t("getMetadata",g),t("getOwnMetadata",w),t("getMetadataKeys",_),t("getOwnMetadataKeys",A),t("deleteMetadata",I)}(n)}()}(i||(i={}));var s,n=function(t){this.name=t},r=self&&self.__extends||(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=function(t){function e(e){var i,s,r=t.call(this)||this;return r.name="ServiceNotFoundError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof e?r.normalizedIdentifier=e:e instanceof n?r.normalizedIdentifier="Token<"+(e.name||"UNSET_NAME")+">":e&&(e.name||(null===(i=e.prototype)||void 0===i?void 0:i.name))&&(r.normalizedIdentifier="MaybeConstructable<"+e.name+">"||"MaybeConstructable<"+(null===(s=e.prototype)||void 0===s?void 0:s.name)+">"),r}return r(e,t),Object.defineProperty(e.prototype,"message",{get:function(){return\'Service with "\'+this.normalizedIdentifier+\'" identifier was not found in the container. Register it before usage via explicitly calling the "Container.set" function or using the "@Service()" decorator.\'},enumerable:!1,configurable:!0}),e}(Error),a=self&&self.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),h=function(t){function e(e){var i,s,r=t.call(this)||this;return r.name="CannotInstantiateValueError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof e?r.normalizedIdentifier=e:e instanceof n?r.normalizedIdentifier="Token<"+(e.name||"UNSET_NAME")+">":e&&(e.name||(null===(i=e.prototype)||void 0===i?void 0:i.name))&&(r.normalizedIdentifier="MaybeConstructable<"+e.name+">"||"MaybeConstructable<"+(null===(s=e.prototype)||void 0===s?void 0:s.name)+">"),r}return a(e,t),Object.defineProperty(e.prototype,"message",{get:function(){return\'Cannot instantiate the requested value for the "\'+this.normalizedIdentifier+"\\" identifier. The related metadata doesn\'t contain a factory or a type to instantiate."},enumerable:!1,configurable:!0}),e}(Error),c=Symbol("EMPTY_VALUE"),l=self&&self.__assign||function(){return l=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},l.apply(this,arguments)},d=self&&self.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var s=Array(t),n=0;for(e=0;e<i;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,n++)s[n]=r[o];return s},u=function(){function t(t){this.services=[],this.id=t}return t.prototype.has=function(t){return!!this.findService(t)},t.prototype.get=function(t){var e=f.of(void 0),i=e.findService(t),s=this.findService(t);if(i&&!0===i.global)return this.getServiceValue(i);if(s)return this.getServiceValue(s);if(i&&this!==e){var n=l({},i);n.value=c,this.set(n);var r=this.getServiceValue(n);return this.set(l(l({},n),{value:r})),r}if(i)return this.getServiceValue(i);throw new o(t)},t.prototype.getMany=function(t){var e=this;return this.findAllServices(t).map((function(t){return e.getServiceValue(t)}))},t.prototype.set=function(t,e){var i=this;if(t instanceof Array)return t.forEach((function(t){return i.set(t)})),this;if("string"==typeof t||t instanceof n)return this.set({id:t,type:null,value:e,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});if("function"==typeof t)return this.set({id:t,type:t,value:e,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});var s=l({id:new n("UNREACHABLE"),type:null,factory:void 0,value:c,global:!1,multiple:!1,eager:!1,transient:!1},t),r=this.findService(s.id);return r&&!0!==r.multiple?Object.assign(r,s):this.services.push(s),s.eager&&this.get(s.id),this},t.prototype.remove=function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){return e.remove(t)})):this.services=this.services.filter((function(i){return i.id!==t||(e.destroyServiceInstance(i),!1)})),this},t.prototype.reset=function(t){var e=this;switch(void 0===t&&(t={strategy:"resetValue"}),t.strategy){case"resetValue":this.services.forEach((function(t){return e.destroyServiceInstance(t)}));break;case"resetServices":this.services.forEach((function(t){return e.destroyServiceInstance(t)})),this.services=[];break;default:throw new Error("Received invalid reset strategy.")}return this},t.prototype.findAllServices=function(t){return this.services.filter((function(e){return e.id===t}))},t.prototype.findService=function(t){return this.services.find((function(e){return e.id===t}))},t.prototype.getServiceValue=function(t){var e,i=c;if(t.value!==c)return t.value;if(!t.factory&&!t.type)throw new h(t.id);if(t.factory)if(t.factory instanceof Array){var s=void 0;try{s=this.get(t.factory[0])}catch(e){if(!(e instanceof o))throw e;s=new t.factory[0]}i=s[t.factory[1]](this,t.id)}else i=t.factory(this,t.id);if(!t.factory&&t.type){var n=t.type,r=(null===(e=Reflect)||void 0===e?void 0:e.getMetadata("design:paramtypes",n))||[],a=this.initializeParams(n,r);a.push(this),i=new(n.bind.apply(n,d([void 0],a)))}if(t.transient||i===c||(t.value=i),i===c)throw new h(t.id);return t.type&&this.applyPropertyHandlers(t.type,i),i},t.prototype.initializeParams=function(t,e){var i=this;return e.map((function(e,s){var n=f.handlers.find((function(e){return(e.object===t||e.object===Object.getPrototypeOf(t))&&e.index===s}));return n?n.value(i):e&&e.name&&!i.isPrimitiveParamType(e.name)?i.get(e):void 0}))},t.prototype.isPrimitiveParamType=function(t){return["string","boolean","number","object"].includes(t.toLowerCase())},t.prototype.applyPropertyHandlers=function(t,e){var i=this;f.handlers.forEach((function(s){"number"!=typeof s.index&&(s.object.constructor===t||t.prototype instanceof s.object.constructor)&&s.propertyName&&(e[s.propertyName]=s.value(i))}))},t.prototype.destroyServiceInstance=function(t,e){if(void 0===e&&(e=!1),e||!!t.type||!!t.factory){if("function"==typeof(null==t?void 0:t.value).destroy)try{t.value.destroy()}catch(t){}t.value=c}},t}(),f=function(){function t(){}return t.of=function(t){if(void 0===t&&(t="default"),"default"===t)return this.globalInstance;var e=this.instances.find((function(e){return e.id===t}));return e||(e=new u(t),this.instances.push(e)),e},t.has=function(t){return this.globalInstance.has(t)},t.get=function(t){return this.globalInstance.get(t)},t.getMany=function(t){return this.globalInstance.getMany(t)},t.set=function(t,e){return this.globalInstance.set(t,e),this},t.remove=function(t){return this.globalInstance.remove(t),this},t.reset=function(t){if(void 0===t&&(t="default"),"default"==t)this.globalInstance.reset(),this.instances.forEach((function(t){return t.reset()}));else{var e=this.instances.find((function(e){return e.id===t}));e&&(e.reset(),this.instances.splice(this.instances.indexOf(e),1))}return this},t.registerHandler=function(t){return this.handlers.push(t),this},t.import=function(t){return this},t.handlers=[],t.globalInstance=new u("default"),t.instances=[],t}(),p=self&&self.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),y=function(t){function e(e,i){var s=t.call(this)||this;return s.target=e,s.propertyName=i,s.name="CannotInjectValueError",s}return p(e,t),Object.defineProperty(e.prototype,"message",{get:function(){return\'Cannot inject value into "\'+this.target.constructor.name+"."+this.propertyName+"\\". Please make sure you setup reflect-metadata properly and you don\'t use interfaces without service tokens as injection value."},enumerable:!1,configurable:!0}),e}(Error);function v(t){return function(e,i,s){var r=function(t,e,i,s){var r;if((t&&"string"==typeof t||t instanceof n)&&(r={eagerType:t,lazyType:function(){return t}}),t&&"function"==typeof t&&(r={eagerType:null,lazyType:function(){return t()}}),!t&&i){var o=Reflect.getMetadata("design:type",e,i);r={eagerType:o,lazyType:function(){return o}}}if(!t&&"number"==typeof s&&Number.isInteger(s)){var a=Reflect.getMetadata("design:paramtypes",e,i),h=null==a?void 0:a[s];r={eagerType:h,lazyType:function(){return h}}}return r}(t,e,i,s);if(void 0===r||void 0===r.eagerType||r.eagerType===Object)throw new y(e,i);f.registerHandler({object:e,propertyName:i,index:s,value:function(t){var s=r.lazyType();if(void 0===s||s===Object)throw new y(e,i);return t.get(s)}})}}function b(t){return function(e){var i={id:e,type:e,factory:void 0,multiple:!1,global:!1,eager:!1,transient:!1,value:c};t instanceof n||"string"==typeof t?i.id=t:t&&(i.id=t.id||e,i.factory=t.factory||void 0,i.multiple=t.multiple||!1,i.global=t.global||!1,i.eager=t.eager||!1,i.transient=t.transient||!1),f.set(i)}}var m="undefined"!=typeof Float32Array?Float32Array:Array;function g(){var t=new m(9);return m!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function w(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function _(t,e,i){var s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=e[6],l=e[7],d=e[8],u=i[0],f=i[1],p=i[2],y=i[3],v=i[4],b=i[5],m=i[6],g=i[7],w=i[8];return t[0]=u*s+f*o+p*c,t[1]=u*n+f*a+p*l,t[2]=u*r+f*h+p*d,t[3]=y*s+v*o+b*c,t[4]=y*n+v*a+b*l,t[5]=y*r+v*h+b*d,t[6]=m*s+g*o+w*c,t[7]=m*n+g*a+w*l,t[8]=m*r+g*h+w*d,t}function A(t,e,i){var s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=e[6],l=e[7],d=e[8],u=Math.sin(i),f=Math.cos(i);return t[0]=f*s+u*o,t[1]=f*n+u*a,t[2]=f*r+u*h,t[3]=f*o-u*s,t[4]=f*a-u*n,t[5]=f*h-u*r,t[6]=c,t[7]=l,t[8]=d,t}function I(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function x(){var t=new m(3);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function S(t,e,i){var s=new m(3);return s[0]=t,s[1]=e,s[2]=i,s}function P(t,e,i,s){return t[0]=e,t[1]=i,t[2]=s,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function B(){var t=new m(4);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}x(),function(){var t,e=(t=new m(4),m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function T(){var t=new m(2);return m!=Float32Array&&(t[0]=0,t[1]=0),t}function F(t){var e=new m(2);return e[0]=t[0],e[1]=t[1],e}function j(t,e){var i=new m(2);return i[0]=t,i[1]=e,i}function N(t,e){return t[0]=e[0],t[1]=e[1],t}function E(t,e,i){return t[0]=e,t[1]=i,t}function C(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function O(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function M(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function k(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t}function R(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.hypot(i,s)}function V(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s}function J(t){var e=t[0],i=t[1];return Math.hypot(e,i)}function z(t){var e=t[0],i=t[1];return e*e+i*i}function D(t,e){return t[0]=-e[0],t[1]=-e[1],t}function q(t,e){var i=e[0],s=e[1],n=i*i+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function L(t,e){return t[0]*e[0]+t[1]*e[1]}function Y(t,e,i){var s=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=s,t}function G(t,e,i){var s=e[0],n=e[1];return t[0]=i[0]*s+i[3]*n+i[6],t[1]=i[1]*s+i[4]*n+i[7],t}function U(t){return t[0]=0,t[1]=0,t}x(),S(1,0,0),S(0,1,0),B(),B(),g();var W=O,K=V,H=z;!function(){var t=T()}();class X{constructor(t=null,e=null){this.collider=t,this.shape=e}}const $=(t,e,i)=>{t.fill(0);for(let s=0;s<e.m;s++)for(let n=e.rows[s],r=e.rows[s+1];n<r;n++)t[e.columns[n]]+=i[s]*e.values[n]},Z=(t,e,i)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e[s]*i[s]},Q=(t,e,i,s)=>{for(let n=0,r=t.length;n<r;n++)t[n]=e[n]+i[n]*s},tt=(t,e,i)=>{for(let s=0,n=t.length;s<n;s++)t[s]=e[s]+i[s]},et=(t,e,i,s,n)=>{for(let r=0,o=t.length;r<o;r++)t[r]=e[r]*i+s[r]*n},it=T(),st=(t,e)=>t[0]*e[1]-t[1]*e[0],nt=(t,e)=>function(t,e,i,s,n,r,o,a,h,c){return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=o,t[6]=a,t[7]=h,t[8]=c,t}(t,e[0],e[3],0,e[1],e[4],0,-e[0]*e[6]-e[1]*e[7],-e[3]*e[6]-e[4]*e[7],1),rt=T(),ot=T(),at=T(),ht=T(),ct=T(),lt=T(),dt=T(),ut=T(),ft=T(),pt=T(),yt=T(),vt=(t,e,i,s)=>{W(rt,i,e),W(ot,s,e);let n=L(ot,rt)/L(rt,rt);return n<0&&(n=0),n>1&&(n=1),E(t,1-n,n)},bt=(t,e,i)=>{W(rt,e,t),W(ot,i,t);let s=L(ot,rt)/L(rt,rt);return s<0&&(s=0),s>1&&(s=1),k(ut,t,rt,s),K(i,ut)},mt=(t,e,i,s,n)=>{const r=O(T(),i,e),o=O(T(),s,e),a=O(T(),s,i),h=O(T(),n,e),c=O(T(),n,i),l=O(T(),n,s),d=L(h,r),u=-L(c,r),f=L(h,o),p=-L(l,o);if(d<=0&&f<=0)return P(t,1,0,0);const y=L(c,a),v=-L(l,a);if(u<=0&&y<=0)return P(t,0,1,0);if(p<=0&&v<=0)return P(t,0,0,1);const b=Y(x(),r,o)[2],m=b*st(h,c);if(m<=0&&d>=0&&u>=0){const e=d/(d+u);return P(t,1-e,e,0)}const g=b*st(c,l);if(g<=0&&y>=0&&v>=0){const e=y/(y+v);return P(t,0,1-e,e)}const w=b*st(l,h);if(w<=0&&f>=0&&p>=0){const e=f/(f+p);return P(t,1-e,0,e)}const _=g/(g+w+m),A=w/(g+w+m);return P(t,_,A,1-_-A)},gt=(t,e,...i)=>{E(t,0,0);for(let s=0;s<e.length;s++)k(t,t,i[s],e[s]);return t},wt=(t,e,i)=>E(t,i[0]*e[0]+i[3]*e[1],i[1]*e[0]+i[4]*e[1]),_t=t=>{let e=0;for(let i=0;i<t.length;i++){const s=t[i],n=t[(i+1)%t.length];e+=s[0]*n[1]-n[0]*s[1]}return.5*e},At=(t,e,i,s)=>{W(ut,s,t),W(ft,e,t);let n=L(ut,i)/L(ft,i);return n=Math.max(0,Math.min(1,n)),k(t,t,ft,n)},It=(t,e)=>new St(t,e),xt=t=>new Pt(t);class St{constructor(t,e){this.first=g(),this.second=g(),this.invFirst=g(),this.invSecond=g(),this.invFirstSecond=g(),this.invSecondFirst=g(),this.update(t,e)}toFirstPoint(t,e){return G(t,e,this.invFirst)}fromFirstPoint(t,e){return G(t,e,this.first)}toFirstVector(t,e){return wt(t,e,this.invFirst)}fromFirstVector(t,e){return wt(t,e,this.first)}toSecondPoint(t,e){return G(t,e,this.invSecond)}fromSecondPoint(t,e){return G(t,e,this.second)}toSecondVector(t,e){return wt(t,e,this.invSecond)}fromSecondVector(t,e){return wt(t,e,this.second)}fromFirstToSecondPoint(t,e){return G(t,e,this.invSecondFirst)}fromFirstToSecondVector(t,e){return wt(t,e,this.invSecondFirst)}fromSecondToFirstPoint(t,e){return G(t,e,this.invFirstSecond)}fromSecondToFirstVector(t,e){return wt(t,e,this.invFirstSecond)}update(t,e){w(this.first,t),w(this.second,e),nt(this.invFirst,t),nt(this.invSecond,e),_(this.invFirstSecond,this.invFirst,e),_(this.invSecondFirst,this.invSecond,t)}}class Pt{constructor(t){this.mapping=t}toFirstPoint(t,e){return this.mapping.toSecondPoint(t,e)}fromFirstPoint(t,e){return this.mapping.fromSecondPoint(t,e)}toFirstVector(t,e){return this.mapping.toSecondVector(t,e)}fromFirstVector(t,e){return this.mapping.fromSecondVector(t,e)}toSecondPoint(t,e){return this.mapping.toFirstPoint(t,e)}fromSecondPoint(t,e){return this.mapping.fromFirstPoint(t,e)}toSecondVector(t,e){return this.mapping.toFirstVector(t,e)}fromSecondVector(t,e){return this.mapping.fromFirstVector(t,e)}fromFirstToSecondPoint(t,e){return this.mapping.fromSecondToFirstPoint(t,e)}fromFirstToSecondVector(t,e){return this.mapping.fromSecondToFirstVector(t,e)}fromSecondToFirstPoint(t,e){return this.mapping.fromFirstToSecondPoint(t,e)}fromSecondToFirstVector(t,e){return this.mapping.fromFirstToSecondVector(t,e)}}var Bt=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Tt=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ft=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let jt=class{constructor(t){this.settings=t}solve(t,e,i,s,n){((t,e,i,s,n,r)=>{const o=i.length;for(;r-- >0;)for(let r=0;r<o;r++){t[r]=i[r];let o=1;for(let i=e.rows[r],s=e.rows[r+1];i<s;i++){const s=e.columns[i],n=e.values[i];s!==r?t[r]-=n*t[s]:o=n}t[r]/=o,t[r]=Math.min(t[r],n[r]),t[r]=Math.max(t[r],s[r])}})(t,e,i,s,n,this.settings.solverIterations)}};jt=Bt([b(),Ft(0,v("SETTINGS")),Tt("design:paramtypes",[Object])],jt);const Nt=(t,e)=>e[0][0]<t[1][0]&&e[1][0]>t[0][0]&&e[0][1]<t[1][1]&&e[1][1]>t[0][1],Et=(t,e,i,s,n=.001)=>{const r=T(),o=T();if(!((t,e,i,s,n,r=.001)=>{let o=0,a=1;const h=W(T(),n,s);for(let t=0;t<2;t++)if(Math.abs(h[t])<r){if(s[t]<i[0][t]||n[t]>i[1][t])return!1}else{const e=1/h[t];let n=(i[0][t]-s[t])*e,r=(i[1][t]-s[t])*e;if(n>r){const t=n;n=r,r=t}if(n>o&&(o=n),r<a&&(a=r),a<o)return!1}return k(t,s,h,o),k(e,s,h,a),!0})(r,o,[j(t[0][0]-s,t[0][1]-s),j(t[1][0]+s,t[1][1]+s)],e,i,n))return!1;const a=s*s;if(r[0]<t[0][0]){if(r[1]<t[0][1])return bt(r,o,t[0])<a;if(r[1]>t[1][1])return bt(r,o,j(t[0][0],t[1][1]))<a}else if(r[0]>t[1][0]){if(r[1]>t[1][1])return bt(r,o,t[1])<a;if(r[1]<t[0][1])return bt(r,o,j(t[1][0],t[0][1]))<a}return!0},Ct=(t,e,i,s,n,r)=>{const o=T(),a=T();((t,e,i,s,n,r)=>{W(rt,s,i);const o=L(rt,rt);W(at,n,i),W(ht,r,i),W(ct,r,n);const a=L(ct,ct);W(lt,i,n),W(dt,s,n);const h=Math.max(0,Math.min(1,L(rt,at)/o)),c=Math.max(0,Math.min(1,L(rt,ht)/o)),l=Math.max(0,Math.min(1,L(ct,lt)/a)),d=Math.max(0,Math.min(1,L(ct,dt)/a));k(ut,i,rt,h),k(ft,i,rt,c),k(pt,n,ct,l),k(yt,n,ct,d);let u=Number.POSITIVE_INFINITY;for(const[o,a]of[[ut,n],[ft,r],[i,pt],[s,yt]]){const i=K(o,a);i<u&&(N(t,o),N(e,a),u=i)}})(o,a,t,e,s,n);const h=i+r;return V(o,a)<h*h};var Ot=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Mt=class{constructor(){this.colliders=[],this.capsuleAABB=[T(),T()],this.candidatePair=[new X,new X]}registerCollider(t){this.colliders.push(t)}unregisterCollider(t){this.colliders.splice(this.colliders.indexOf(t),1)}*queryCapsule(t,e,i){E(this.capsuleAABB[0],Math.min(t[0],e[0])-i,Math.min(t[1],e[1])-i),E(this.capsuleAABB[1],Math.max(t[0],e[0])+i,Math.max(t[1],e[1])+i),this.updateAABBs();for(const s of this.colliders)Nt(this.capsuleAABB,s.aabb)&&Et(s.aabb,t,e,i)&&(yield s)}*detectCandidates(){this.updateAABBs();for(let t=0;t<this.colliders.length-1;t++)for(let e=t+1;e<this.colliders.length;e++){const i=this.colliders[t],s=this.colliders[e];i.mask&s.mask&&(Nt(i.aabb,s.aabb)&&(this.candidatePair[0].collider=i,this.candidatePair[0].shape=i.shape,this.candidatePair[1].collider=s,this.candidatePair[1].shape=s.shape,yield this.candidatePair))}}updateAABBs(){for(const t of this.colliders)t.updateAABB()}};Mt=Ot([b()],Mt);var kt=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Rt=class{constructor(){this.counter=0,this.freeList=[]}getUniqueId(){return 0===this.freeList.length?++this.counter:this.freeList.shift()}releaseId(t){this.freeList.push(t)}reset(){this.counter=0,this.freeList.length=0}};Rt=kt([b()],Rt);const Vt=(t,e)=>t>e?t<<15|e:e<<15|t;var Jt=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let zt=class{constructor(){this._time=0,this._lastTime=0,this._frame=0}get time(){return this._time}get lastTime(){return this._lastTime}get frame(){return this._frame}tick(t){this._lastTime=this._time,this._time+=t,this._frame++}};zt=Jt([b()],zt);let Dt=class{constructor(t,e){this.p0=t,this.p1=e}};const qt=t=>Array.from(t.reduce(((t,e)=>(t.add(e.p0),t.add(e.p1),t.add(e.p2),t)),new Set)),Lt=t=>{const e=qt(t),i=(t=>{const e=qt(t),i=T();for(const t of e)C(i,i,t);return M(i,i,1/e.length)})(t);let s=0,n=0,r=0;for(const t of e)s+=(t[0]-i[0])*(t[0]-i[0]),n+=(t[0]-i[0])*(t[1]-i[1]),r+=(t[1]-i[1])*(t[1]-i[1]);const o=1/e.length;return a=s*o,h=n*o,c=n*o,l=r*o,(d=new m(4))[0]=a,d[1]=h,d[2]=c,d[3]=l,d;var a,h,c,l,d},Yt=t=>{const e=qt(t),i=Lt(t),[s,n]=(t=>{const e=t[0],i=t[1],s=t[2],n=t[3];if(Math.abs(i)<1e-6)return[j(1,0),j(0,1)];const r=(e+n)*(e+n)-4*(e*n-s*i);if(r<0)throw Error("getEigenVectors: something went wrong");const o=.5*(e+n-Math.sqrt(r)),a=.5*(e+n+Math.sqrt(r)),h=T();E(h,-s/(e-o),1);const c=T();return E(c,-s/(e-a),1),[h,c]})(i);q(s,s),q(n,n);Y(x(),s,n)[2]<0&&D(s,s);let r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(const t of e){let e=L(t,s);e<r&&(r=e),e>o&&(o=e),e=L(t,n),e<a&&(a=e),e>h&&(h=e)}const c=.5*Math.abs(o-r),l=.5*Math.abs(h-a),d=.5*(r+o),u=.5*(a+h),f=T();k(f,f,s,d),k(f,f,n,u);const p=(y=s[0],v=s[1],b=0,w=n[0],_=n[1],A=0,I=f[0],S=f[1],P=1,(B=new m(9))[0]=y,B[1]=v,B[2]=b,B[3]=w,B[4]=_,B[5]=A,B[6]=I,B[7]=S,B[8]=P,B);var y,v,b,w,_,A,I,S,P,B;const F=g();return nt(F,p),{transform:p,invTransform:F,extent:j(c,l)}},Gt=t=>j((t.p0[0]+t.p1[0]+t.p2[0])/3,(t.p0[1]+t.p1[1]+t.p2[1])/3);var Ut=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Wt=class{constructor(){this.lisneters=new Map}addEventListener(t,e){this.lisneters.has(t)||this.lisneters.set(t,new Set),this.lisneters.get(t).add(e)}removeEventListener(t,e){this.lisneters.has(t)&&(this.lisneters.get(t).delete(e),0===this.lisneters.get(t).size&&this.lisneters.delete(t))}dispatch(t,...e){if(this.lisneters.has(t))for(const i of this.lisneters.get(t))i(...e)}hasEventListeners(t){return this.lisneters.has(t)}reset(){this.lisneters.clear()}};Wt=Ut([b()],Wt);var Kt,Ht=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Xt=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$t=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};class Zt{constructor(t,e,i){this.array=t,this.start=e,this.size=i,this.prev=null,this.next=null,this.end=this.start+this.size}}let Qt=Kt=class{constructor(t){this.reserved=new WeakMap,this.buffer=new Uint8Array(this.size=t.totalReservedMemory),this.freeList=new Zt(this.buffer,0,this.size)}reserve(t){if(t<Kt.MIN_BLOCK_SIZE)throw new Error(`Memory.reserve: failed to reserve block with size ${t} - minimal allowed size is ${Kt.MIN_BLOCK_SIZE}`);const e=this.bestFit(t);if(!e)throw new Error(`Memory.reserve: failed to reserve block with size ${t} - no such block can be found`);if(e.size!==t){const i=new Zt(this.buffer.subarray(e.start,e.start+t),e.start,t),s=new Zt(this.buffer.subarray(e.start+t,e.end),e.start+t,e.size-t);return s.prev=e.prev,s.next=e.next,e.prev?e.prev.next=s:this.freeList=s,e.next&&(e.next.prev=s),e.next=e.prev=null,this.reserved.set(i.array,i),i.array}return e.next&&(e.next.prev=e.prev),e.prev?e.prev.next=e.next:this.freeList=e.next,e.next=e.prev=null,this.reserved.set(e.array,e),e.array}free(t){const e=this.reserved.get(t);if(!e)throw new Error("Memory.free: failed to release block - it seems that buffer was created somewhere outside");const[i,s]=this.closests(e);let n;i&&i.end===e.start&&s&&s.start===e.end?(n=this.mergeInBetween(i,e,s),this.reserved.delete(i.array),this.reserved.delete(e.array),this.reserved.delete(s.array)):i&&i.end===e.start?(n=this.mergeRight(i,e),this.reserved.delete(i.array),this.reserved.delete(e.array)):s&&s.start===e.end?(n=this.mergeLeft(e,s),this.reserved.delete(e.array),this.reserved.delete(s.array)):(e.prev=i,e.next=s,i&&(i.next=e),s&&(s.prev=e),n=e,this.reserved.delete(e.array)),n.prev||(this.freeList=n)}clear(){let t=this.freeList;for(;null!==t;){const e=t.next;t.prev=null,t.next=null,this.reserved.delete(t.array),t=e}this.buffer.fill(0),this.freeList=new Zt(this.buffer,0,this.size)}dump(){const t=[];let e=this.freeList;for(;null!==e;)t.push(e),e=e.next;return t}mergeLeft(t,e){const i=new Zt(this.buffer.subarray(t.start,e.end),t.start,t.size+e.size);return i.prev=e.prev,i.next=e.next,e.prev&&(e.prev.next=i),e.next&&(e.next.prev=i),t.prev=t.next=null,e.prev=e.next=null,i}mergeInBetween(t,e,i){const s=new Zt(this.buffer.subarray(t.start,i.end),t.start,t.size+e.size+i.size);return s.prev=t.prev,s.next=i.next,t.prev&&(t.prev.next=s),i.next&&(i.next.prev=s),t.prev=t.next=null,e.prev=e.next=null,i.prev=i.next=null,s}mergeRight(t,e){const i=new Zt(this.buffer.subarray(t.start,e.end),t.start,t.size+e.size);return i.prev=t.prev,i.next=t.next,t.prev&&(t.prev.next=i),t.next&&(t.next.prev=i),t.prev=t.next=null,e.prev=e.next=null,i}bestFit(t){let e=this.freeList,i=null;for(;null!==e;)e.size>=t&&(null===i||i.size>e.size)&&(i=e),e=e.next;return i}closests(t){let e=this.freeList;for(;null!==e&&e.end<=t.start;)e=e.next;return e?[e.prev,e]:[null,null]}};Qt.MIN_BLOCK_SIZE=32,Qt=Kt=Ht([b(),$t(0,v("SETTINGS")),Xt("design:paramtypes",[Object])],Qt);class te{constructor(t,e,i){this.block=t,this.offset=e,this.size=i}}class ee{constructor(t){this.buffer=t,this.size=0,this.stack=[],this.end=0,this.offset=0,this.size=t.length,this.offset=t.byteOffset,this.end=t.byteOffset+t.length}pushInt8(t){return this.pushTypedArray(Int8Array,t)}pushUint8(t){return this.pushTypedArray(Uint8Array,t)}pushInt16(t){return this.pushTypedArray(Int16Array,t)}pushUint16(t){return this.pushTypedArray(Uint16Array,t)}pushInt32(t){return this.pushTypedArray(Int32Array,t)}pushUint32(t){return this.pushTypedArray(Uint32Array,t)}pushFloat32(t){return this.pushTypedArray(Float32Array,t)}pushFloat64(t){return this.pushTypedArray(Float64Array,t)}pop(t=1){for(;t>0&&this.stack.length>0;){const e=this.stack.pop();this.offset-=e.size,t--}}clear(){this.stack.length=0,this.offset=this.buffer.byteOffset,this.buffer.fill(0)}dump(){return this.stack}pushTypedArray(t,e){const i=e*t.BYTES_PER_ELEMENT;if(i+this.offset>this.end){const t=this.end-this.offset;throw new Error(`Stack.push: Not enough memory to allocate, requested: ${i}, free: ${t} bytes`)}const s=new te(new t(this.buffer.buffer,this.offset,e),this.offset,i);return this.offset+=i,this.stack.push(s),s.block}}class ie{get size(){return this._size}constructor(t){this.predicate=t,this.lookup=new WeakMap,this.begin=null,this.end=null,this._size=0}enqueue(t){let e;if(null===this.end)this.begin=this.end=e={value:t,prev:null,next:null};else{let i=this.end;for(;i&&this.predicate(i.value,t)>0;)i=i.prev;i?i.next?(e={value:t,prev:i,next:i.next},i.next.prev=e,i.next=e):(e={value:t,prev:i,next:null},this.end.next=e,this.end=e):(e={value:t,prev:null,next:this.begin},this.begin.prev=e,this.begin=e)}this.lookup.set(t,e),this._size++}resort(){if(this._size<2)return;let t=this.begin.next;for(;null!==t;){let e=t.prev;const i=t.next;for(;e&&this.predicate(e.value,t.value)>0;)e=e.prev;e!==t.prev&&(t.prev&&(t.prev.next=t.next),t.next?t.next.prev=t.prev:(this.end=t.prev,this.end.next=null),e?(e.next.prev=t,t.next=e.next,e.next=t,t.prev=e):(t.next=this.begin,t.prev=null,this.begin.prev=t,this.begin=t)),t=i}}dequeue(){if(0===this._size)return null;const t=this.begin.value;return this.begin.next&&(this.begin.next.prev=null),this.begin=this.begin.next,this._size--,this.lookup.delete(t),t}remove(t){if(!this.lookup.has(t))return;const e=this.lookup.get(t);e.prev&&e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.next?(e.next.prev=null,this.begin=e.next):e.prev?(e.prev.next=null,this.end=e.prev):this.end=this.begin=null,this.lookup.delete(t),this._size--}*[Symbol.iterator](){for(let t=this.begin;null!=t;t=t.next)yield t.value}}var se,ne;!function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(se||(se={})),function(t){t[t.Start=0]="Start",t[t.End=1]="End"}(ne||(ne={}));class re{get value(){return this.interval.aabb[this.type][this.interval.type]}constructor(t,e){this.type=t,this.interval=e}}class oe{constructor(t,e,i,s){this.id=t,this.aabb=e,this.collider=i,this.type=s,this.start=new re(ne.Start,this),this.end=new re(ne.End,this)}}const ae=(t,e)=>t.value-e.value;class he{constructor(t){this.type=t,this.aabbInterval=new Map,this.queue=new ie(ae),this.active=new Set,this.intersected=new Map}registerAABB(t){const e=new oe(this.aabbInterval.size+1,t.aabb,t,this.type);this.aabbInterval.set(t.aabb,e),this.queue.enqueue(e.start),this.queue.enqueue(e.end)}unregisterAABB(t){const e=this.aabbInterval.get(t.aabb);this.queue.remove(e.start),this.queue.remove(e.end),this.aabbInterval.delete(t.aabb)}update(){this.active.clear(),this.intersected.clear(),this.queue.resort();for(const t of this.queue)if(t.type===ne.Start){for(const e of this.active)this.intersected.set(Vt(e.id,t.interval.id),[e,t.interval]);this.active.add(t.interval)}else this.active.delete(t.interval)}}var ce=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let le=class{constructor(){this.colliders=new Set,this.capsuleAABB=[T(),T()],this.candidatePair=[new X,new X],this.xIntervalKeeper=new he(se.X),this.yIntervalKeeper=new he(se.Y)}registerCollider(t){this.colliders.add(t),this.xIntervalKeeper.registerAABB(t),this.yIntervalKeeper.registerAABB(t)}unregisterCollider(t){this.colliders.delete(t),this.xIntervalKeeper.unregisterAABB(t),this.yIntervalKeeper.unregisterAABB(t)}*queryCapsule(t,e,i){E(this.capsuleAABB[0],Math.min(t[0],e[0])-i,Math.min(t[1],e[1])-i),E(this.capsuleAABB[1],Math.max(t[0],e[0])+i,Math.max(t[1],e[1])+i),this.updateAABBs();for(const s of this.colliders)Nt(this.capsuleAABB,s.aabb)&&Et(s.aabb,t,e,i)&&(yield s)}*detectCandidates(){this.updateAABBs(),this.xIntervalKeeper.update(),this.yIntervalKeeper.update();for(const[t,e]of this.xIntervalKeeper.intersected)if(this.yIntervalKeeper.intersected.has(t)){const t=e[0].collider,i=e[1].collider;if(!(t.mask&i.mask))continue;t.id<i.id?(this.candidatePair[0].collider=t,this.candidatePair[0].shape=t.shape,this.candidatePair[1].collider=i,this.candidatePair[1].shape=i.shape):(this.candidatePair[1].collider=t,this.candidatePair[1].shape=t.shape,this.candidatePair[0].collider=i,this.candidatePair[0].shape=i.shape),yield this.candidatePair}}updateAABBs(){for(const t of this.colliders)t.updateAABB()}};le=ce([b()],le);const de=T();class ue{constructor(t){this.point=t,this.prev=null,this.next=null,this.edge0=null,this.edge1=null}}let fe=class{constructor(t,e){this.v0=t,this.v1=e,this.normal=T(),this.prev=null,this.next=null,W(this.normal,this.v1.point,this.v0.point),q(this.normal,this.normal),E(this.normal,this.normal[1],-this.normal[0])}};class pe{constructor(t,e=!0){this.points=t,this.transformOrigin=e,this.radius=0,this.loop=null,this.edgeLoop=null,this.cachedSupportVertex=null,e&&(t=this.transformOriginToCentroid(t)),this.loop=this.cachedSupportVertex=this.createVertexLoop(t),this.edgeLoop=this.createEdgeLoop(this.loop),this.radius=this.getRadius()}support(t,e,i=0){let s=this.cachedSupportVertex;const n=L(s.point,e);if(L(s.next.point,e)>n)for(s=s.next;L(s.next.point,e)>L(s.point,e);)s=s.next;else if(L(s.prev.point,e)>n)for(s=s.prev;L(s.prev.point,e)>L(s.point,e);)s=s.prev;return this.cachedSupportVertex=s,N(t,s.point),k(t,t,s.normal,i)}aabb(t,e){let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const t of this.vertices())G(de,t.point,e),de[0]<i&&(i=de[0]),de[1]<s&&(s=de[1]),de[0]>n&&(n=de[0]),de[1]>r&&(r=de[1]);return E(t[0],i,s),E(t[1],n,r),t}testPoint(t){const e=T(),i=T(),s=x();for(const n of this.vertices()){const r=n.point,o=n.next.point;if(W(e,o,r),W(i,t,r),Y(s,e,i),s[2]<0)return!1}return!0}inetria(t){let e=0,i=0,s=0;for(const t of this.vertices()){const n=t.point,r=t.next.point,o=n[0]*r[1]-r[0]*n[1];i+=o*(n[1]*n[1]+n[1]*r[1]+r[1]*r[1]),s+=o*(n[0]*n[0]+n[0]*r[0]+r[0]*r[0]),e+=o}return t/6/e*(i+s)}*vertices(){let t=this.loop;do{yield t,t=t.next}while(t!==this.loop)}*edges(){let t=this.edgeLoop;do{yield t,t=t.next}while(t!==this.edgeLoop)}transformOriginToCentroid(t){const e=((t,e)=>{let i=0,s=0;for(let e=0;e<t.length;e++){const n=t[e],r=t[(e+1)%t.length],o=n[0]*r[1]-r[0]*n[1];i+=(n[0]+r[0])*o,s+=(n[1]+r[1])*o}return j((e=1/6/e)*i,e*s)})(t,_t(t));return t.map((t=>O(T(),t,e)))}getRadius(){return Array.from(this.vertices()).map((t=>J(t.point))).reduce(((t,e)=>e>t?e:t),0)}createVertexLoop(t){let e=null,i=null;for(const s of t){const t=new ue(s);i?(i.next=t,t.prev=i):e=t,i=t}return i.next=e,e.prev=i,e}createEdgeLoop(t){let e=null,i=null,s=t;do{const t=new fe(s,s.next);i?(i.next=t,t.prev=i):e=t,s.edge0=i,s.edge1=t,i=t,s=s.next}while(s!==t);i.next=e,e.prev=i,s.edge0=i;let n=e;do{const t=T();C(t,n.normal,n.prev.normal),M(t,t,1/(1+L(n.normal,n.prev.normal))),n.v0.normal=t,n=n.next}while(n!==e);return e}}class ye extends pe{constructor(t,e){super([j(.5*-t,.5*e),j(.5*-t,.5*-e),j(.5*t,.5*-e),j(.5*t,.5*e)]),this.width=t,this.height=e}}class ve{constructor(t){this.radius=t}support(t,e,i=0){return q(t,e),M(t,t,this.radius+i)}aabb(t,e){const i=e[6],s=e[7];return E(t[0],i-this.radius,s-this.radius),E(t[1],i+this.radius,s+this.radius),t}testPoint(t){return L(t,t)<this.radius*this.radius}inetria(t){return.5*t*this.radius*this.radius}}class be{constructor(t,e=!0){this.mesh=t,this.transformOrigin=e,this.radius=0,this.triangles=new Array,this.hull=new Array,e&&(this.mesh=this.transformOriginToCentroid(this.mesh)),this.obbTree=(t=>{const e={obb:Yt(t),children:[],leaf:!1},i=[{node:e,soup:t}];for(;i.length;){const{soup:t,node:e}=i.shift();if(t.length>1){const s=T(),n=T();e.obb.extent[0]>e.obb.extent[1]?(E(s,e.obb.transform[0],e.obb.transform[1]),E(n,e.obb.transform[3],e.obb.transform[4])):(E(s,e.obb.transform[3],e.obb.transform[4]),E(n,e.obb.transform[0],e.obb.transform[1]));let r=0,o=!1;for(;!o&&r<2;){const a=T();if(0===r)E(a,e.obb.transform[6],e.obb.transform[7]);else{for(const e of t)C(a,a,Gt(e));M(a,a,1/t.length)}for(const r of[s,n]){const s=[],n=[],h=L(a,r);for(const e of t)L(r,Gt(e))>h?s.push(e):n.push(e);if(0===s.length||0===n.length)continue;const c={obb:Yt(n),children:[],leaf:!1};e.children.push(c),i.push({node:c,soup:n});const l={obb:Yt(s),children:[],leaf:!1};e.children.push(l),i.push({node:l,soup:s}),o=!0;break}r++}if(!o)for(const s of t){const t={obb:Yt([s]),children:[],leaf:!1};e.children.push(t),i.push({node:t,soup:[s]})}}else e.payload={triangle:t[0],triangleShape:new pe([t[0].p0,t[0].p1,t[0].p2],!1)},e.leaf=!0}return e})(this.mesh),this.getLeafs(),this.getConvexHull(),this.radius=this.getRadius()}testPoint(t){return this.triangles.some((e=>e.testPoint(t)))}support(t,e){const i=this.indexOfFarhestPoint(e);return N(t,this.hull[i])}aabb(t,e){const i=T();let s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const t of this.hull)G(i,t,e),i[0]<s&&(s=i[0]),i[1]<n&&(n=i[1]),i[0]>r&&(r=i[0]),i[1]>o&&(o=i[1]);return E(t[0],s,n),E(t[1],r,o),t}inetria(t){return((t,e)=>{let i=0,s=0;for(const e of t){const t=Gt(e),n=Math.abs(_t([e.p0,e.p1,e.p2]));s+=L(t,t)*n,i+=n}return e/i*s})(this.mesh,t)}getLeafs(){const t=[this.obbTree];for(;t.length;){const{payload:e,children:i}=t.pop();e&&this.triangles.push(e.triangleShape);for(const e of i)t.push(e)}}getConvexHull(){const t=new Set;for(const e of this.mesh)t.add(e.p0),t.add(e.p1),t.add(e.p2);const e=new Set;((t,e)=>{const i=new Map;for(const s of e){const e=s.toString();i.has(e)||(t.add(s),i.set(e,s))}})(e,t),((t,e)=>{let i=j(Number.POSITIVE_INFINITY,0),s=j(0,Number.NEGATIVE_INFINITY),n=j(Number.NEGATIVE_INFINITY,0),r=j(0,Number.POSITIVE_INFINITY);const o=new Set;for(const t of e)t[0]<i[0]&&(i=t),t[1]>s[1]&&(s=t),t[0]>n[0]&&(n=t),t[1]<r[1]&&(r=t),o.add(t);const a=[],h=[i,r,n,s];for(let t=0;t<h.length;t++){const e=h[t],i=h[(t+1)%h.length];e!==i&&a.push(new Dt(e,i))}const c=T(),l=T(),d=[];for(const t of a){const e=new Set;for(const i of o)W(c,i,t.p0),W(l,t.p1,t.p0),st(c,l)>0&&e.add(i);d.push({points:e,edge:t})}for(;d.length;){const{edge:e,points:i}=d.pop();if(0===i.size)t.push(e.p0);else{let t=null,s=0;for(const n of i){W(c,n,e.p0),W(l,e.p1,e.p0),M(l,l,L(c,l)/L(l,l)),W(c,c,l);const i=z(c);i>s&&(s=i,t=n)}if(null!==t){const s=new Dt(t,e.p1),n=new Dt(e.p0,t);for(const t of[n,s]){const e=new Set;for(const s of i)W(c,s,t.p0),W(l,t.p1,t.p0),st(c,l)>0&&e.add(s);d.push({points:e,edge:t})}}}}})(this.hull,e)}transformOriginToCentroid(t){const e=(t=>{const e=new Set;let i=0;for(const s of t){const t=Gt(s),n=Math.abs(_t([s.p0,s.p1,s.p2]));e.add(M(t,t,n)),i+=n}let s=0,n=0;for(const t of e)s+=t[0]/i,n+=t[1]/i;return j(s,n)})(t);return t.map((t=>({p0:O(T(),t.p0,e),p1:O(T(),t.p1,e),p2:O(T(),t.p2,e)})))}indexOfFarhestPoint(t){let e=Number.NEGATIVE_INFINITY,i=-1;for(let s=0;s<this.hull.length;s++){const n=L(this.hull[s],t);n>e&&(e=n,i=s)}return i}getRadius(){return this.hull.map((t=>J(t))).reduce(((t,e)=>e>t?e:t),0)}}const me=T(),ge=(t,e,i)=>(E(me,i[1],i[4]),e(me,me),G(me,me,i),t[1][1]=me[1],E(me,i[0],i[3]),e(me,me),G(me,me,i),t[1][0]=me[0],E(me,-i[1],-i[4]),e(me,me),G(me,me,i),t[0][1]=me[1],E(me,-i[0],-i[3]),e(me,me),G(me,me,i),t[0][0]=me[0],t);class we extends pe{constructor(t,e,i=16){super(Ae(t,e,i)),this.r=t,this.height=e,this.subdivisions=i,this.capsuleSupportFun=_e(t,.5*e)}testPoint(t){const e=T(),i=T(),s=j(0,.5*-this.height),n=j(0,.5*this.height);return vt(e,s,n,t),gt(i,e,s,n),R(i,t)<this.r}aabb(t,e){return ge(t,this.capsuleSupportFun,e)}}const _e=(t,e)=>(i,s)=>(q(i,s),E(i,i[0]*t,i[1]*t+Math.sign(i[1])*e)),Ae=(t,e,i)=>{const s=[],n=[];let r=0;const o=Math.PI/i;for(let a=0;a<=i;a++,r+=o){const i=Math.cos(r),o=Math.sin(r);s.push(j(t*i,t*o+.5*e)),n.push(j(-t*i,-t*o-.5*e))}return s.concat(n)};class Ie extends pe{constructor(t,e,i=32){super(Se(t,e,i)),this.a=t,this.b=e,this.subdivisions=i,this.ellipseSupportFun=xe(t,e)}aabb(t,e){return ge(t,this.ellipseSupportFun,e)}testPoint(t){return t[0]*t[0]/this.a/this.a+t[1]*t[1]/this.b/this.b<1}}const xe=(t,e)=>(i,s)=>{const n=t*t,r=e*e,o=Math.sqrt(s[0]*s[0]*n+s[1]*s[1]*r);return E(i,s[0]*n/o,s[1]*r/o)},Se=(t,e,i)=>{const s=[];let n=0;const r=2*Math.PI/i;for(let o=0;o<i;o++,n+=r){const i=Math.cos(n),r=Math.sin(n);s.push(j(t*i,e*r))}return s},Pe=T(),Be=T(),Te=T(),Fe=(t,e,i,s,n,r)=>(s.toFirstVector(Te,n),e.support(Pe,Te,r),s.fromFirstPoint(Pe,Pe),D(Te,n),s.toSecondVector(Te,Te),i.support(Be,Te,r),s.fromSecondPoint(Be,Be),O(t,Pe,Be)),je=(t,e,i,s,n,r=0,o=.01,a=25)=>{const h=1e4*Number.EPSILON,c=1e-4,l=F(n),d=T(),u=x();let f=Number.NEGATIVE_INFINITY,p=Number.POSITIVE_INFINITY,y=null;for(;3!=t.size&&p>0*h&&a--;){D(l,l);const n=T();Fe(n,e,i,s,l,r),p=L(l,l),f=-L(l,n);if(y&&y[0]===n[0]&&y[1]===n[1]||p-f<=o*p)return Math.sqrt(p);if(y=n,t.add(n),1===t.size){N(l,Array.from(t.values())[0])}else if(2===t.size){const e=Array.from(t.values());vt(d,e[0],e[1],it),gt(l,d,e[0],e[1]);for(let i=0;i<2;i++)d[i]<c&&t.delete(e[i])}else if(3===t.size){const e=Array.from(t.values());mt(u,e[0],e[1],e[2],it),gt(l,u,e[0],e[1],e[2]);for(let i=0;i<3;i++)u[i]<c&&t.delete(e[i])}else console.warn("gjk.distance: for some reason simplex has more than 3 vertices");for(const e of t)L(e,e)}return 0},Ne=(t,e)=>{const i=T(),s=x();if(1===e.size){N(t,Array.from(e.values())[0])}else if(2==e.size){const s=Array.from(e.values());vt(i,s[0],s[1],it),gt(t,i,s[0],s[1])}else if(3===e.size){const i=Array.from(e.values());mt(s,i[0],i[1],i[2],it),gt(t,s,i[0],i[1],i[2])}else U(t)};class Ee{constructor(t,e){this.p0=t,this.p1=e,this.closest=T(),this.closestBarycentric=T(),this.distance=0}}const Ce=(t,e,i,s,n,r=0,o=1e-4,a=25)=>{let h=null;if(3===e.size){const[t,i,s]=Array.from(e);h=((t,e,i)=>{const s=new Ee(t,e),n=new Ee(e,i),r=new Ee(i,t),o=new ie(((t,e)=>t.distance-e.distance));for(const t of[s,n,r])vt(t.closestBarycentric,t.p0,t.p1,it),gt(t.closest,t.closestBarycentric,t.p0,t.p1),t.distance=L(t.closest,t.closest),o.enqueue(t);return o})(t,i,s)}else{if(2!==e.size)return void U(t);{const[t,o]=Array.from(e);h=((t,e,i,s,n,r=0)=>{const o=T();O(o,e,t),E(o,-o[1],o[0]);const a=T();Fe(a,i,s,n,o,r),D(o,o);const h=T();Fe(h,i,s,n,o,r);const c=new Ee(a,t),l=new Ee(t,h),d=new Ee(h,e),u=new Ee(e,a),f=new ie(((t,e)=>t.distance-e.distance));for(const t of[c,l,d,u])vt(t.closestBarycentric,t.p0,t.p1,it),gt(t.closest,t.closestBarycentric,t.p0,t.p1),t.distance=L(t.closest,t.closest),f.enqueue(t);return f})(t,o,i,s,n,r)}}let c=null,l=0,d=0;for(;a--&&h.size;){const t=h.dequeue();if(t.closestBarycentric[0]<1e-6||t.closestBarycentric[1]<1e-6)continue;c=t;const e=T();if(Fe(e,i,s,n,c.closest,r),l=L(c.closest,c.closest),d=L(c.closest,e),d-l<o)break;const a=new Ee(c.p0,e),u=new Ee(e,c.p1);for(const t of[a,u])vt(t.closestBarycentric,t.p0,t.p1,it),gt(t.closest,t.closestBarycentric,t.p0,t.p1),t.distance=L(t.closest,t.closest),h.enqueue(t)}c?gt(t,c.closestBarycentric,c.p0,c.p1):U(t)};class Oe{constructor(){this.transform=g(),this.position=T(),this.velocity=T(),this.angle=0,this.omega=0}advance(t){k(this.position,this.position,this.velocity,t),this.angle+=this.omega*t,this.updateTransform()}wrap(t){this.shape=t.collider.shape,N(this.position,t.position),this.angle=t.angle,N(this.velocity,t.velocity),this.omega=t.omega,this.updateTransform()}updateTransform(){I(this.transform,this.position),A(this.transform,this.transform,this.angle)}}const Me=T(),ke=new Set,Re=It(g(),g()),Ve=new Oe,Je=new Oe,ze=(t,e,i,s)=>{O(Me,i.position,e.position),Re.update(e.transform,i.transform),ke.clear();const n=je(ke,e.shape,i.shape,Re,Me,-s);return 0===n?0:(Ne(t,ke),q(t,t),n)},De=T(),qe=T(),Le=(t,e,i,s,n,r,o,a)=>{Ve.wrap(t),Je.wrap(i);let h=0,c=Number.POSITIVE_INFINITY;O(qe,Je.velocity,Ve.velocity);const l=Math.abs(Ve.omega)*e+Math.abs(Je.omega)*s;do{c=ze(De,Ve,Je,a);const t=L(qe,De)+l;if(t<=0)return 1;const e=c/t;Number.isFinite(e)||console.warn("getToi: something went wrong with time of impact estimation"),Ve.advance(e),Je.advance(e),h+=e}while(c>=r&&h<n&&h>=0&&--o);return h=Math.min(n,Math.max(0,h)),h/n};var Ye=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Ge=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ue=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let We=class{constructor(t,e,i,s){this.settings=t,this.broadPhase=e,this.midPhase=i,this.narrowPhase=s,this.continuous=new Array,this.p0=T(),this.p1=T(),this.q0=T(),this.q1=T()}getTimeOfFirstImpact(t){let e=1;const i=new Set,s=this.continuous.length;for(let e=0;e<s;e++){const n=this.continuous[e];N(this.p0,n.body.position),k(this.p1,this.p0,n.body.velocity,t);for(let r=e+1;r<s;r++){const e=this.continuous[r];0!=(n.mask&e.mask)&&(N(this.q0,e.body.position),k(this.q1,this.q0,e.body.velocity,t),Ct(this.p0,this.p1,n.shape.radius,this.q0,this.q1,e.shape.radius)&&i.add([n,e]))}const r=this.broadPhase.queryCapsule(this.p0,this.p1,n.shape.radius);for(const t of r)t===n||t.body.continuous||0==(n.mask&t.mask)||i.add([n,t])}for(const[s,n]of i){let i=0;n.shape instanceof be||(i=Le(s.body,s.shape.radius,n.body,n.shape.radius,t,this.settings.toiEpsilon,this.settings.toiMaxIterations,this.settings.toiPenetrationDepth),i<e&&(e=i))}return e}registerCollider(t){this.broadPhase.registerCollider(t),t.body.continuous&&this.continuous.push(t)}unregisterCollider(t){this.broadPhase.unregisterCollider(t),t.body.continuous&&this.continuous.splice(this.continuous.indexOf(t),1)}*detectCollisions(){const t=this.broadPhase.detectCandidates(),e=this.midPhase.detectCandidates(t);yield*this.narrowPhase.detectContacts(e)}};We=Ye([b(),Ue(0,v("SETTINGS")),Ue(1,v("BROAD_PHASE")),Ue(2,v("MID_PHASE")),Ue(3,v("NARROW_PHASE")),Ge("design:paramtypes",[Object,Object,Object,Object])],We);const Ke=(t,e,i,s)=>{let n=[j(-e.extent[0],-e.extent[1]),j(e.extent[0],-e.extent[1]),j(e.extent[0],e.extent[1]),j(-e.extent[0],e.extent[1])].map((t=>G(t,t,i)));return!(n.every((e=>e[0]<t[0][0]))||n.every((e=>e[0]>t[1][0]))||n.every((e=>e[1]<t[0][1]))||n.every((e=>e[1]>t[1][1])))&&(n=[j(t[0][0],t[0][1]),j(t[1][0],t[0][1]),j(t[1][0],t[1][1]),j(t[0][0],t[1][1])].map((t=>G(t,t,s))),!(n.every((t=>t[0]<-e.extent[0]))||n.every((t=>t[0]>e.extent[0]))||n.every((t=>t[1]<-e.extent[1]))||n.every((t=>t[1]>e.extent[1]))))},He=(t,e,i,s)=>{let n=[j(-e.extent[0],-e.extent[1]),j(e.extent[0],-e.extent[1]),j(e.extent[0],e.extent[1]),j(-e.extent[0],e.extent[1])].map((t=>G(t,t,s)));return!(n.every((e=>e[0]<-t.extent[0]))||n.every((e=>e[0]>t.extent[0]))||n.every((e=>e[1]<-t.extent[1]))||n.every((e=>e[1]>t.extent[1])))&&(n=[j(-t.extent[0],-t.extent[1]),j(t.extent[0],-t.extent[1]),j(t.extent[0],t.extent[1]),j(-t.extent[0],t.extent[1])].map((t=>G(t,t,i))),!(n.every((t=>t[0]<-e.extent[0]))||n.every((t=>t[0]>e.extent[0]))||n.every((t=>t[1]<-e.extent[1]))||n.every((t=>t[1]>e.extent[1]))))},Xe=(t,e,i,s)=>{const n=[i],r=g(),o=g();for(t.clear();n.length;){const i=n.shift();if(_(r,s,i.obb.transform),nt(o,r),Ke(e,i.obb,r,o))if(i.payload)t.add(i);else for(const t of i.children)n.push(t)}return 0!==t.size},$e=t=>t.extent[0]*t.extent[1]*4,Ze=(t,e,i,s,n)=>{const r=g();nt(r,n),_(r,r,i);const o=g();nt(o,r);const a=[[e,s]],h=g(),c=g();for(t.clear();a.length;){const[e,i]=a.shift();if(_(h,r,e.obb.transform),_(h,i.obb.invTransform,h),nt(c,h),He(e.obb,i.obb,h,c))if(e.leaf||i.leaf)if(!e.leaf&&i.leaf)for(const t of e.children)a.push([t,i]);else if(e.leaf&&!i.leaf)for(const t of i.children)a.push([e,t]);else t.add([e,i]);else if($e(e.obb)>$e(i.obb))for(const t of e.children)a.push([t,i]);else for(const t of i.children)a.push([e,t])}return 0!==t.size};var Qe=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let ti=class{constructor(){this.candidatePair=[new X,new X]}*detectCandidates(t){for(const e of t){const[t,i]=e;if(t.shape instanceof be&&i.shape instanceof be){const e=new Set;if(Ze(e,t.shape.obbTree,t.collider.transform,i.shape.obbTree,i.collider.transform))for(const[s,n]of e)this.candidatePair[0].collider=t.collider,this.candidatePair[0].shape=s.payload.triangleShape,this.candidatePair[1].collider=i.collider,this.candidatePair[1].shape=n.payload.triangleShape,yield this.candidatePair}else if(t.shape instanceof be){const e=new Set;if(Xe(e,i.collider.aabb,t.shape.obbTree,t.collider.transform))for(const s of e)this.candidatePair[0].collider=t.collider,this.candidatePair[0].shape=s.payload.triangleShape,this.candidatePair[1].collider=i.collider,this.candidatePair[1].shape=i.shape,yield this.candidatePair}else if(i.shape instanceof be){const e=new Set;if(Xe(e,t.collider.aabb,i.shape.obbTree,i.collider.transform))for(const s of e)this.candidatePair[0].collider=t.collider,this.candidatePair[0].shape=t.shape,this.candidatePair[1].collider=i.collider,this.candidatePair[1].shape=s.payload.triangleShape,yield this.candidatePair}else yield e}}};var ei;ti=Qe([b()],ti),function(t){t.BodyCreated="BodyCreated",t.BodyDestroyed="BodyDestroyed",t.ColliderAdded="ColliderAdded",t.ColliderRemoved="ColliderRemoved",t.JointAdded="JointAdded",t.JointRemoved="JointRemoved",t.CollisionStart="CollisionStart",t.Collide="Collide",t.CollisionEnd="CollisionEnd",t.PreStep="PreStep",t.IslandPreStep="IslandPreStep",t.IslandPostStep="IslandPostStep",t.PostStep="PostStep",t.FallAsleep="FallAsleep",t.Awake="Awake"}(ei||(ei={}));class ii{get transform(){return this._transform}get invTransform(){return this._invTransform}get position(){return this._position}set position(t){N(this._position,t)}get velocity(){return this._velocity}set velocity(t){N(this._velocity,t)}get force(){return this._force}set force(t){N(this._force,t)}get torque(){return this._torque}set torque(t){this._torque=t}get invMass(){return this._invMass}get mass(){return this._mass}set mass(t){this._mass=t,this._invMass=1/t,this._isStatic=!Number.isFinite(this._mass)&&!Number.isFinite(this._inertia)}get invInertia(){return this._invInertia}get inertia(){return this._inertia}set inertia(t){this._inertia=t,this._invInertia=1/t,this._isStatic=!Number.isFinite(this._mass)&&!Number.isFinite(this._inertia)}get isStatic(){return this._isStatic}get isSleeping(){return this._isSleeping}constructor(t,e,i){this.id=t,this.world=e,this.continuous=i,this.omega=0,this.angle=0,this.bodyIndex=-1,this.islandId=-1,this.joints=new Set,this.contacts=new Set,this.solverConstraints=[],this._position=T(),this._velocity=T(),this._force=T(),this._torque=0,this._mass=0,this._invMass=0,this._invInertia=0,this._inertia=0,this._isStatic=!1,this._isSleeping=!1,this._sleepTimer=0,this._transform=g(),this._invTransform=g()}addJoint(t){this.joints.add(t),this.awake()}removeJoint(t){this.joints.delete(t),this.awake()}addContact(t){this.contacts.add(t),this.awake()}removeContact(t){this.contacts.delete(t),this.awake()}updateTransform(){I(this._transform,this._position),A(this._transform,this._transform,this.angle),nt(this._invTransform,this._transform)}applyForce(t,e){if(C(this._force,this._force,t),e){const i=T();G(i,e,this.transform),W(i,i,this._position),this._torque=st(i,t)}this.awake()}clearForces(){U(this._force),this._torque=0}toLocalPoint(t,e){return G(t,e,this._invTransform)}toGlobalPoint(t,e){return G(t,e,this._transform)}tick(t){if(!this.isStatic){const e=J(this.velocity),i=Math.abs(this.omega);e<=this.world.settings.sleepingVelocityThreshold&&i<=this.world.settings.sleepingAngularVelocityThreshold?(this._sleepTimer-=t,this._sleepTimer<=0&&this.fallAsleep()):this.awake()}}awake(){this._isSleeping&&this.world.dispatch(ei.Awake,this),this._isSleeping=!1,this._sleepTimer=this.world.settings.fallAsleepTimer}fallAsleep(){this._isSleeping||this.world.dispatch(ei.FallAsleep,this),this._isSleeping=!0}}class si{constructor(){this.bodyA=null,this.bodyB=null,this.cache=[0,0]}getCache(t){return this.cache[t]}setCache(t,e){this.cache[t]=e}}const ni=T(),ri=T(),oi=new Float32Array(6),ai=new Float32Array(6);class hi extends si{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.joint=s,this.normal=n,this.penetration=r}getJacobian(t){oi.fill(0),t.fill(0),W(ni,this.joint,this.bodyA.position),oi[0]=t[0]=-this.normal[0],oi[1]=t[1]=-this.normal[1],oi[2]=t[2]=-st(ni,this.normal),W(ri,this.joint,this.bodyB.position),oi[3]=t[3]=this.normal[0],oi[4]=t[4]=this.normal[1],oi[5]=t[5]=st(ri,this.normal)}getPushFactor(t,e){if(e){const i=this.penetration-this.world.settings.contactConstraintSlop;return Math.max(i,0)/t*e}return-this.getCDot()*this.world.settings.defaultRestitution}getClamping(){return{min:0,max:Number.POSITIVE_INFINITY}}setPenetration(t){this.penetration=t}getCDot(){return ai.fill(0),ai[0]=this.bodyA.velocity[0],ai[1]=this.bodyA.velocity[1],ai[2]=this.bodyA.omega,ai[3]=this.bodyB.velocity[0],ai[4]=this.bodyB.velocity[1],ai[5]=this.bodyB.omega,((t,e)=>{let i=0;for(let s=0,n=t.length;s<n;s++)i+=t[s]*e[s];return i})(ai,oi)}}class ci extends si{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.distance=r,this.pa=T(),this.pb=T(),this.pbpa=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.pbpa,this.pb,this.pa),q(this.pbpa,this.pbpa),W(this.ra,this.pa,this.bodyA.position),t[0]=-this.pbpa[0],t[1]=-this.pbpa[1],t[2]=-st(this.ra,this.pbpa),W(this.rb,this.pb,this.bodyB.position),t[3]=this.pbpa[0],t[4]=this.pbpa[1],t[5]=st(this.rb,this.pbpa)}getPushFactor(t,e=1){return G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),(this.distance-R(this.pb,this.pa))*e/t}getClamping(){return{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}class li extends ci{constructor(t,e,i,s,n,r){super(t,e,i,s,n,r)}getPushFactor(t,e=1){G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform);const i=this.distance-R(this.pb,this.pa);return i<0?i/t:e*i/t}getClamping(){return{min:0,max:Number.POSITIVE_INFINITY}}}class di extends ci{constructor(t,e,i,s,n,r){super(t,e,i,s,n,r)}getPushFactor(t,e=1){G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform);const i=this.distance-R(this.pb,this.pa);return i>0?i/t:e*i/t}getClamping(){return{min:Number.NEGATIVE_INFINITY,max:0}}}const ui=T(),fi=T(),pi=T();class yi extends si{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.joint=s,this.normal=n,this.mu=r}getJacobian(t){t.fill(0),E(ui,-this.normal[1],this.normal[0]),W(fi,this.joint,this.bodyA.position),t[0]=-ui[0],t[1]=-ui[1],t[2]=-st(fi,ui),W(pi,this.joint,this.bodyB.position),t[3]=ui[0],t[4]=ui[1],t[5]=st(pi,ui)}getPushFactor(){return 0}getClamping(){const t=this.bodyA.mass,e=this.bodyB.mass,i=Number.isFinite(t)&&Number.isFinite(e)?.5*(t+e):Number.isFinite(t)?t:Number.isFinite(e)?e:0,s=Math.abs(this.mu*i*L(this.world.settings.gravity,this.normal));return{min:-s,max:s}}}class vi extends si{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.axisA=r,this.tangent=T(),this.pa=T(),this.pb=T(),this.u=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),E(this.tangent,-this.axisA[1],this.axisA[0]),wt(this.tangent,this.tangent,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),G(this.pa,this.jointA,this.bodyA.transform),W(this.u,this.pb,this.pa),W(this.ra,this.pa,this.bodyA.position),C(this.ra,this.ra,this.u),t[0]=-this.tangent[0],t[1]=-this.tangent[1],t[2]=-st(this.ra,this.tangent),W(this.rb,this.pb,this.bodyB.position),t[3]=this.tangent[0],t[4]=this.tangent[1],t[5]=st(this.rb,this.tangent)}getPushFactor(t,e){return E(this.tangent,-this.axisA[1],this.axisA[0]),wt(this.tangent,this.tangent,this.bodyA.transform),G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.u,this.pb,this.pa),-L(this.tangent,this.u)/t*e}getClamping(){return{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}class bi extends si{constructor(t,e,i,s){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.angle=s}getJacobian(t){t.fill(0),isFinite(this.bodyA.inertia)&&(t[0]=0,t[1]=0,t[2]=-1),isFinite(this.bodyB.inertia)&&(t[3]=0,t[4]=0,t[5]=1)}getPushFactor(t,e){return(this.angle-(this.bodyB.angle-this.bodyA.angle))/t*e}getClamping(){return{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}class mi extends si{constructor(t,e,i,s,n){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.pa=T(),this.pb=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=1,t[1]=0,t[2]=-this.ra[1],G(this.pb,this.jointB,this.bodyB.transform),W(this.rb,this.pb,this.bodyB.position),t[3]=-1,t[4]=0,t[5]=this.rb[1]}getPushFactor(t,e){return G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),-(this.pa[0]-this.pb[0])/t*e}getClamping(){return{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}class gi extends si{constructor(t,e,i,s,n){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.pa=T(),this.pb=T(),this.ra=T(),this.rb=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=0,t[1]=1,t[2]=this.ra[0],G(this.pb,this.jointB,this.bodyB.transform),W(this.rb,this.pb,this.bodyB.position),t[3]=0,t[4]=-1,t[5]=-this.rb[0]}getPushFactor(t,e){return G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),-(this.pa[1]-this.pb[1])/t*e}getClamping(){return{min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY}}}class wi extends bi{constructor(t,e,i,s){super(t,e,i,s)}getPushFactor(t){const e=this.angle-(this.bodyB.angle-this.bodyA.angle);return e<0?e/t:0}getClamping(){return{min:0,max:Number.POSITIVE_INFINITY}}}class _i extends bi{constructor(t,e,i,s){super(t,e,i,s)}getPushFactor(t){const e=this.angle-(this.bodyB.angle-this.bodyA.angle);return e>0?e/t:0}getClamping(){return{min:Number.NEGATIVE_INFINITY,max:0}}}class Ai extends si{constructor(t,e,i,s){super(),this.world=t,this.bodyA=e,this.speed=i,this.torque=s}getJacobian(t){t.fill(0),isFinite(this.bodyA.inertia)&&(t[0]=0,t[1]=0,t[2]=1)}getPushFactor(){return this.speed}getClamping(){return{min:-this.torque,max:this.torque}}}class Ii extends si{constructor(t,e,i,s,n,r,o,a){super(),this.world=t,this.bodyA=e,this.jointA=i,this.bodyB=s,this.jointB=n,this.length=r,this.stiffness=o,this.extinction=a,this.pa=T(),this.pb=T(),this.ra=T(),this.rb=T(),this.va=T(),this.vb=T(),this.pbpa=T(),this.normal=T()}getJacobian(t){t.fill(0),G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.pbpa,this.pb,this.pa),q(this.pbpa,this.pbpa),W(this.ra,this.pa,this.bodyA.position),t[0]=-this.pbpa[0],t[1]=-this.pbpa[1],t[2]=-st(this.ra,this.pbpa),W(this.rb,this.pb,this.bodyB.position),t[3]=this.pbpa[0],t[4]=this.pbpa[1],t[5]=st(this.rb,this.pbpa)}getPushFactor(){return 0}getClamping(){G(this.pa,this.jointA,this.bodyA.transform),G(this.pb,this.jointB,this.bodyB.transform),W(this.ra,this.pa,this.bodyA.position),E(this.ra,-this.ra[1],this.ra[0]),W(this.rb,this.pb,this.bodyB.position),E(this.rb,-this.rb[1],this.rb[0]),W(this.normal,this.pb,this.pa);const t=J(this.normal);M(this.normal,this.normal,1/t),N(this.va,this.bodyA.velocity),k(this.va,this.va,this.ra,this.bodyA.omega),N(this.vb,this.bodyB.velocity),k(this.vb,this.vb,this.rb,this.bodyB.omega);const e=this.extinction*(L(this.normal,this.va)-L(this.normal,this.vb)),i=this.stiffness*(this.length-t)+e;return{min:i,max:i}}}class xi extends si{constructor(t,e,i,s,n,r=Number.POSITIVE_INFINITY){super(),this.world=t,this.bodyA=e,this.joint=i,this.control=s,this.stiffness=n,this.maxForce=r,this.pa=T(),this.ra=T(),this.cursor=T()}getJacobian(t){t.fill(0),G(this.pa,this.joint,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=1,t[1]=0,t[2]=-this.ra[1]}getPushFactor(t){return this.control.getCursorPosition(this.cursor),G(this.pa,this.joint,this.bodyA.transform),-(this.pa[0]-this.cursor[0])/t*this.stiffness}getClamping(){return{min:-this.maxForce,max:this.maxForce}}}class Si extends si{constructor(t,e,i,s,n,r=Number.POSITIVE_INFINITY){super(),this.world=t,this.bodyA=e,this.joint=i,this.control=s,this.stiffness=n,this.maxForce=r,this.pa=T(),this.ra=T(),this.cursor=T()}getJacobian(t){t.fill(0),G(this.pa,this.joint,this.bodyA.transform),W(this.ra,this.pa,this.bodyA.position),t[0]=0,t[1]=1,t[2]=this.ra[0]}getPushFactor(t){return this.control.getCursorPosition(this.cursor),G(this.pa,this.joint,this.bodyA.transform),-(this.pa[1]-this.cursor[1])/t*this.stiffness}getClamping(){return{min:-this.maxForce,max:this.maxForce}}}class Pi extends si{constructor(t,e,i,s,n,r){super(),this.world=t,this.bodyA=e,this.bodyB=i,this.angle=s,this.stiffness=n,this.extinction=r}getJacobian(t){t.fill(0),isFinite(this.bodyA.inertia)&&(t[0]=0,t[1]=0,t[2]=-1),isFinite(this.bodyB.inertia)&&(t[3]=0,t[4]=0,t[5]=1)}getPushFactor(){return 0}getClamping(){const t=-this.extinction*(this.bodyB.omega-this.bodyA.omega),e=this.stiffness*(this.angle-(this.bodyB.angle-this.bodyA.angle))+t;return{min:e,max:e}}}class Bi{constructor(t,e,i,s,n,r){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.distance=r,this.distanceConstraint=new ci(t,e,F(i),s,F(n),r)}*[Symbol.iterator](){yield this.distanceConstraint}}class Ti{constructor(t,e,i,s,n,r,o,a,h){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.localAxis=r,this.refAngle=o,this.minDistance=a,this.maxDistance=h,this.constraints=[],this.constraints.push(new vi(t,e,F(i),s,F(n),F(r)),new bi(t,e,s,o)),a&&this.constraints.push(new li(t,e,F(i),s,F(n),a)),isFinite(h)&&this.constraints.push(new di(t,e,F(i),s,F(n),h))}*[Symbol.iterator](){yield*this.constraints}}class Fi{constructor(t,e,i,s,n,r,o,a,h){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.minAngle=r,this.maxAngle=o,this.stiffness=a,this.damping=h,this.constraints=[],this.constraints.push(new mi(t,e,F(i),s,F(n))),this.constraints.push(new gi(t,e,F(i),s,F(n))),isFinite(this.minAngle)&&this.constraints.push(new wi(t,e,s,this.minAngle)),isFinite(this.maxAngle)&&this.constraints.push(new _i(t,e,s,this.maxAngle)),this.stiffness&&this.constraints.push(new Pi(t,e,s,s.angle-e.angle,this.stiffness,this.damping))}*[Symbol.iterator](){yield*this.constraints}}class ji{constructor(t,e,i,s,n,r,o,a){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.distance=r,this.stiffness=o,this.extinction=a,this.springConstraint=new Ii(t,e,F(i),s,F(n),r,o,a)}*[Symbol.iterator](){yield this.springConstraint}}class Ni{constructor(t,e,i,s,n,r){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.refAngle=r,this.revoluteXConstraint=new mi(t,e,F(i),s,F(n)),this.revoluteYConstraint=new gi(t,e,F(i),s,F(n)),this.angleConstraint=new bi(t,e,s,r||s.angle-e.angle)}*[Symbol.iterator](){yield this.revoluteXConstraint,yield this.revoluteYConstraint,yield this.angleConstraint}}class Ei{constructor(t,e,i,s,n,r,o,a){this.world=t,this.bodyA=e,this.pivotA=i,this.bodyB=s,this.pivotB=n,this.localAxis=r,this.minDistance=o,this.maxDistance=a,this.constraints=[],this.constraints.push(new vi(t,e,F(i),s,F(n),F(r))),o&&this.constraints.push(new li(t,e,F(i),s,F(n),o)),isFinite(a)&&this.constraints.push(new di(t,e,F(i),s,F(n),a))}*[Symbol.iterator](){yield*this.constraints}}class Ci{constructor(t,e,i,s,n,r){this.world=t,this.control=e,this.bodyA=i,this.joint=s,this.stiffness=n,this.maxForce=r,this.bodyB=null,this.mouseXConstraint=new xi(t,i,s,e,n,r),this.mouseYConstraint=new Si(t,i,s,e,n,r)}*[Symbol.iterator](){yield this.mouseXConstraint,yield this.mouseYConstraint}}class Oi{constructor(t,e,i,s){this.world=t,this.bodyA=e,this.speed=i,this.torque=s,this.bodyB=null,this.motorConstraint=new Ai(t,e,i,s)}*[Symbol.iterator](){yield this.motorConstraint}}class Mi{get bodyA(){return this.contactInfo.collider0.body}get bodyB(){return this.contactInfo.collider1.body}constructor(t){this.contactInfo=t;const e=t.collider0.body.world;this.contactConstraint=new hi(e,t.collider0.body,t.collider1.body,F(t.point0),j(-t.normal[0],-t.normal[1]),t.depth),e.settings.defaultFriction>0&&(this.frictionConstraint=new yi(e,t.collider0.body,t.collider1.body,F(t.point0),j(-t.normal[0],-t.normal[1]),e.settings.defaultFriction))}*[Symbol.iterator](){yield this.contactConstraint,this.frictionConstraint&&(yield this.frictionConstraint)}updatePenetration(t){this.contactConstraint.setPenetration(t)}}var ki=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Ri=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const Vi=T(),Ji=T(),zi=T(),Di=T(),qi=T();class Li{constructor(t,e,i){this.collider0=t,this.collider1=e,this.threshold=i,this.contacts=new Set}validate(){for(const t of this.contacts)G(Vi,t.contactInfo.localPoint0,t.contactInfo.collider0.transform),G(Ji,t.contactInfo.localPoint1,t.contactInfo.collider1.transform),W(zi,Ji,Vi),L(zi,t.contactInfo.normal)<0?(this.contacts.delete(t),t.bodyA.removeContact(t),t.bodyB.removeContact(t)):(W(Di,t.contactInfo.point0,Vi),W(qi,t.contactInfo.point1,Ji),(H(Di)>=this.threshold||H(qi)>=this.threshold)&&(this.contacts.delete(t),t.bodyA.removeContact(t),t.bodyB.removeContact(t)));return this.contacts.size>0}addContact(t){for(const e of this.contacts)if(W(Di,t.point0,e.contactInfo.point0),W(qi,t.point1,e.contactInfo.point1),H(Di)<=this.threshold&&H(qi)<=this.threshold)return void e.updatePenetration(t.depth);const e=new Mi(t);if(this.contacts.add(e),this.contacts.size>Li.MAX_CONTACTS){let t=null,i=Number.NEGATIVE_INFINITY;for(const e of this.contacts)e.contactInfo.depth>i&&(t=e,i=e.contactInfo.depth);this.contacts.delete(t);let s=null,n=Number.NEGATIVE_INFINITY;for(const e of this.contacts){const i=V(e.contactInfo.point0,t.contactInfo.point0);i>n&&(n=i,s=e)}this.contacts.delete(s);for(const t of this.contacts)this.contacts.delete(t),e.bodyA.removeContact(t),e.bodyB.removeContact(t);this.contacts.add(t),this.contacts.add(s)}this.contacts.has(e)&&(e.bodyA.addContact(e),e.bodyB.addContact(e))}}Li.MAX_CONTACTS=2;class Yi{constructor(t,e,i){this.collider0=t,this.collider1=e,this.proximityThreshold=i,this.id=Vt(this.collider0.id,this.collider1.id),this.spacesMapping=It(this.collider0.transform,this.collider1.transform),this.contactManifold=new Li(this.collider0,this.collider1,this.proximityThreshold)}updateTransforms(){this.spacesMapping.update(this.collider0.transform,this.collider1.transform)}validateContacts(){return this.contactManifold.validate()}addContact(t){this.contactManifold.addContact(t)}}let Gi=class{constructor(t){this.dispatcher=t,this.registry=new Map,this.active=new Set,this.deleted=new Set,this.persistent=new Set,this.added=new Set}getPairById(t){return this.registry.get(t)}registerPair(t){this.registry.set(t.id,t)}unregisterPair(t){const e=this.getPairById(t);e&&(this.active.delete(e),this.registry.delete(t))}clear(){this.registry.clear(),this.active.clear(),this.deleted.clear(),this.persistent.clear(),this.added.clear()}validatePairs(){this.deleted.clear(),this.persistent.clear(),this.added.clear();for(const t of this.active)t.validateContacts()?this.persistent.add(t):(this.active.delete(t),this.deleted.add(t))}addContact(t){const e=Vt(t.collider0.id,t.collider1.id),i=this.registry.get(e);i.addContact(t),this.deleted.delete(i)&&this.persistent.add(i),this.active.add(i),this.added.add(i)}emitEvents(){for(const t of this.deleted)this.dispatcher.dispatch(ei.CollisionEnd,t.collider0,t.collider1);for(const t of this.persistent)this.dispatcher.dispatch(ei.Collide,t.collider0,t.collider1,t.contactManifold.contacts),this.added.delete(t);for(const t of this.added)this.dispatcher.dispatch(ei.CollisionStart,t.collider0,t.collider1,t.contactManifold.contacts)}};Gi=ki([b(),Ri("design:paramtypes",[Wt])],Gi);var Ui=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Wi=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ki=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Hi=class{constructor(t,e,i,s,n,r,o){this.settings=t,this.islandGenerator=e,this.registry=i,this.detector=s,this.clock=n,this.idManager=r,this.dispatcher=o,this.bodies=new Map,this.bodyForce=T()}createBody(t){var e,i,s,n,r;if(this.bodies.size===this.settings.maxBodiesNumber)throw new Error(`World.createBody: Failed to create body: maximum namber of bodies attained: ${this.settings.maxBodiesNumber}`);const o=new ii(this.idManager.getUniqueId(),this,null!==(e=t.isContinuos)&&void 0!==e&&e);return o.mass=null!==(i=t.mass)&&void 0!==i?i:1,o.inertia=null!==(s=null==t?void 0:t.inertia)&&void 0!==s?s:1,o.position=null!==(n=t.position)&&void 0!==n?n:T(),o.angle=null!==(r=t.angle)&&void 0!==r?r:0,o.updateTransform(),this.bodies.set(o.id,o),this.dispatch(ei.BodyCreated,o),o}destroyBody(t){this.bodies.has(t.id)&&(this.bodies.delete(t.id),this.idManager.releaseId(t.id),t.collider&&this.removeCollider(t.collider),this.dispatch(ei.BodyDestroyed,t))}getBody(t){return this.bodies.get(t)}addDistanceJoint(t){var e,i;const s=new Bi(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),t.distance);return t.bodyA.addJoint(s),t.bodyB.addJoint(s),this.dispatch(ei.JointAdded,s),s}addPrismaticJoint(t){var e,i,s,n,r,o;const a=new Ti(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.localAxis)&&void 0!==s?s:j(1,0),null!==(n=t.refAngle)&&void 0!==n?n:0,null!==(r=t.minDistance)&&void 0!==r?r:0,null!==(o=t.maxDistance)&&void 0!==o?o:Number.POSITIVE_INFINITY);return t.bodyA.addJoint(a),t.bodyB.addJoint(a),this.dispatch(ei.JointAdded,a),a}addRevoluteJoint(t){var e,i,s,n,r,o;const a=new Fi(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.minAngle)&&void 0!==s?s:Number.NEGATIVE_INFINITY,null!==(n=t.maxAngle)&&void 0!==n?n:Number.POSITIVE_INFINITY,null!==(r=t.stiffness)&&void 0!==r?r:0,null!==(o=t.damping)&&void 0!==o?o:0);return t.bodyA.addJoint(a),t.bodyB.addJoint(a),this.dispatch(ei.JointAdded,a),a}addWeldJoint(t){var e,i,s;const n=new Ni(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.refAngle)&&void 0!==s?s:0);return t.bodyA.addJoint(n),t.bodyB.addJoint(n),this.dispatch(ei.JointAdded,n),n}addWheelJonit(t){var e,i,s,n,r;const o=new Ei(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.localAxis)&&void 0!==s?s:j(1,0),null!==(n=t.minDistance)&&void 0!==n?n:0,null!==(r=t.maxDistance)&&void 0!==r?r:Number.POSITIVE_INFINITY);return t.bodyA.addJoint(o),t.bodyB.addJoint(o),this.dispatch(ei.JointAdded,o),o}addSpring(t){var e,i,s,n,r;const o=new ji(this,t.bodyA,null!==(e=t.pivotA)&&void 0!==e?e:T(),t.bodyB,null!==(i=t.pivotB)&&void 0!==i?i:T(),null!==(s=t.distance)&&void 0!==s?s:.5,null!==(n=t.stiffness)&&void 0!==n?n:1,null!==(r=t.extinction)&&void 0!==r?r:1);return t.bodyA.addJoint(o),t.bodyB.addJoint(o),this.dispatch(ei.JointAdded,o),o}addMouseJoint(t){var e,i;const s=new Ci(this,t.control,t.body,t.joint,null!==(e=t.stiffness)&&void 0!==e?e:1,null!==(i=t.maxForce)&&void 0!==i?i:1e4);return t.body.addJoint(s),this.dispatch(ei.JointAdded,s),s}addMotor(t){const e=new Oi(this,t.body,t.speed,t.torque);return t.body.addJoint(e),this.dispatch(ei.JointAdded,e),e}addCollider(t){var e,i;const s=new Xs(t.body,t.shape,null!==(e=t.mask)&&void 0!==e?e:4294967295,null!==(i=t.isVirtual)&&void 0!==i&&i);Object.assign(s.body,{collider:s}),this.detector.registerCollider(s);for(const t of this.bodies.values())t.collider&&t.collider!==s&&this.registry.registerPair(new Yi(t.collider,s,this.settings.contactProximityThreshold));return this.dispatch(ei.ColliderAdded,s,s.body),s}removeCollider(t){this.detector.unregisterCollider(t),Object.assign(t.body,{collider:null});for(const e of this.bodies.values()){const i=Vt(e.collider.id,t.id);this.registry.unregisterPair(i)}this.dispatch(ei.ColliderRemoved,t,t.body)}removeJoint(t){t.bodyA&&t.bodyA.removeJoint(t),t.bodyB&&t.bodyB.removeJoint(t),this.dispatch(ei.JointRemoved,t)}clear(){for(const t of this.bodies.values())t.collider&&this.detector.unregisterCollider(t.collider);this.registry.clear(),this.idManager.reset(),this.bodies.clear()}on(t,e){this.dispatcher.addEventListener(t,e)}off(t,e){this.dispatcher.removeEventListener(t,e)}dispatch(t,...e){this.dispatcher.dispatch(t,...e)}*[Symbol.iterator](){yield*this.bodies.values()}applyGlobalForces(){for(const t of this.bodies.values())N(this.bodyForce,t.force),t.invMass&&k(this.bodyForce,this.bodyForce,this.settings.gravity,t.mass),this.settings.defaultDamping&&k(this.bodyForce,this.bodyForce,t.velocity,-this.settings.defaultDamping),t.force=this.bodyForce,this.settings.defaultAngularDamping&&(t.torque-=this.settings.defaultAngularDamping*t.omega)}step(t){this.clock.tick(t),this.dispatch(ei.PreStep,this.clock.frame,this.clock.time);let e=this.settings.toiSubsteps,i=t,s=0,n=0;this.applyGlobalForces();do{s=this.detector.getTimeOfFirstImpact(i),s<.001&&(s=1),n=i*s,this.detectCollisions(),this.advance(n),i-=n}while(e--&&s<1);this.clearForces();for(const e of this.bodies.values())e.tick(t);this.dispatch(ei.PostStep,this.clock.frame,this.clock.time)}clearForces(){for(const t of this.bodies.values())t.clearForces()}advance(t){for(const e of this.islandGenerator.generate(this.bodies.values()))e.sleeping||(this.dispatch(ei.IslandPreStep,e),e.step(t),this.dispatch(ei.IslandPostStep,e))}detectCollisions(){this.registry.validatePairs();for(const t of this.detector.detectCollisions())this.registry.addContact(t);this.registry.emitEvents()}};Hi=Ui([b(),Ki(0,v("SETTINGS")),Ki(1,v("ISLANDS_GENERATOR")),Wi("design:paramtypes",[Object,Object,Gi,We,zt,Rt,Wt])],Hi);class Xi{get sleeping(){return this._sleeping}get empty(){return 0===this.bodies.length}constructor(t,e,i){this.settings=t,this.solver=e,this.memory=i,this.bodies=[],this.constraints=[],this.id=-1,this._sleeping=!0,this.bodyPosition=T(),this.bodyVelocity=T(),this.stack=new ee(this.memory.reserve(60*this.settings.maxBodiesNumber))}setId(t){this.id=t}addBody(t){t.bodyIndex=this.bodies.length,t.islandId=this.id,this._sleeping=this._sleeping&&t.isSleeping,this.bodies.push(t)}addJoint(t){this.constraints.push(...t)}clear(){this.bodies.length=0,this.constraints.length=0,this._sleeping=!0}step(t){this.constraints.length>0?this.solve(t):this.integrate(t)}solve(t){const e=3*this.bodies.length;this.positions=this.stack.pushFloat32(e),this.velocities=this.stack.pushFloat32(e),this.solver.solve(this.positions,this.velocities,this.bodies,this.constraints,t),this.arraysToBodies(this.positions,this.velocities),this.stack.clear()}integrate(t){const e=3*this.bodies.length;this.positions=this.stack.pushFloat32(e),this.velocities=this.stack.pushFloat32(e),this.forces=this.stack.pushFloat32(e),this.invMasses=this.stack.pushFloat32(e),this.accelerations=this.stack.pushFloat32(e),this.serializeBodies(this.bodies),Z(this.accelerations,this.forces,this.invMasses),Q(this.velocities,this.velocities,this.accelerations,t),Q(this.positions,this.positions,this.velocities,t),this.arraysToBodies(this.positions,this.velocities),this.stack.clear()}serializeBodies(t){let e=0;for(const i of t){const t=i.position,s=i.velocity,n=i.force;this.positions[e]=t[0],this.positions[e+1]=t[1],this.positions[e+2]=i.angle,this.velocities[e]=s[0],this.velocities[e+1]=s[1],this.velocities[e+2]=i.omega,this.forces[e]=n[0],this.forces[e+1]=n[1],this.forces[e+2]=i.torque,this.invMasses[e]=this.invMasses[e+1]=i.invMass,this.invMasses[e+2]=i.invInertia,e+=3}}arraysToBodies(t,e){const i=3*this.bodies.length;for(let s=0,n=0;s<i;s+=3,n++){const i=this.bodies[n];E(this.bodyPosition,t[s],t[s+1]),i.position=this.bodyPosition,i.angle=t[s+2],E(this.bodyVelocity,e[s],e[s+1]),i.velocity=this.bodyVelocity,i.omega=this.velocities[s+2],i.updateTransform()}}}var $i=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Zi=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Qi=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let ts=class{constructor(t,e,i){this.bodies=new Set,this.joints=new Set,this.contacts=new Set,this.stack=new Array,this.free=new Set,this.island=new Xi(t,e,i)}*generate(t){let e=0;this.bodies.clear(),this.joints.clear(),this.contacts.clear(),this.free.clear();for(const i of t)if(!this.bodies.has(i))if(0!==i.contacts.size||0!==i.joints.size){for(this.island.clear(),this.stack.length=0,this.stack.push(i);this.stack.length;){const t=this.stack.pop();if(!this.bodies.has(t))if(t.isStatic)this.bodies.add(t);else{for(const e of t.joints){if(this.joints.has(e))continue;this.island.addJoint(e),this.joints.add(e);const i=e.bodyA===t?e.bodyB:e.bodyA;i&&!this.bodies.has(i)&&this.stack.push(i)}for(const e of t.contacts){if(this.contacts.has(e))continue;if(this.contacts.add(e),e.contactInfo.collider0.virtual||e.contactInfo.collider1.virtual)continue;this.island.addJoint(e);const i=e.bodyA===t?e.bodyB:e.bodyA;i&&!this.bodies.has(i)&&this.stack.push(i)}this.island.addBody(t),this.bodies.add(t)}}this.island.empty||(this.island.setId(e++),yield this.island)}else this.free.add(i),this.bodies.add(i);if(0!==this.free.size){this.island.clear();for(const t of this.free)this.island.addBody(t);yield this.island}}};ts=$i([b(),Qi(0,v("SETTINGS")),Qi(1,v("CONSTRAINTS_SOLVER")),Zi("design:paramtypes",[Object,Object,Qt])],ts);var es=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},is=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ss=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let ns=class{constructor(t,e,i){this.joints=new Set,this.contacts=new Set,this.island=new Xi(t,e,i)}*generate(t){this.joints.clear(),this.contacts.clear(),this.island.clear();for(const e of t)if(!e.isStatic){for(const t of e.joints)this.joints.has(t)||(this.island.addJoint(t),this.joints.add(t));for(const t of e.contacts)this.contacts.has(t)||(this.contacts.add(t),t.contactInfo.collider0.virtual||t.contactInfo.collider1.virtual||this.island.addJoint(t));this.island.addBody(e)}this.island.empty||(this.island.setId(0),yield this.island)}};ns=es([b(),ss(0,v("SETTINGS")),ss(1,v("CONSTRAINTS_SOLVER")),is("design:paramtypes",[Object,Object,Qt])],ns);var rs=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},os=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},as=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let hs=class{constructor(t,e,i){this.settings=t,this.linearEquationsSolver=e,this.memory=i,this.J={columns:[],rows:[],values:[],m:0,n:0},this.jacobian=new Float32Array(6),this.lookup=[],this.stack=new ee(this.memory.reserve(this.getRequiredMemorySize(this.settings.maxBodiesNumber,this.settings.maxConstraintsNumber)))}solve(t,e,i,s,n){this.constraints=s,this.allocate(s.length,3*i.length),this.serializeBodies(i),this.createJacobianMatrix(s,n),this.createConstraintLookup(s),this.solveConstraintForces(this.cvForces,this.c0Forces,n),this.correctPositions(t,n),this.correctVelocities(e,n),this.deallocate()}allocate(t,e){this.rows=t,this.columns=e,this.positions=this.stack.pushFloat32(e),this.velocities=this.stack.pushFloat32(e),this.forces=this.stack.pushFloat32(e),this.invMasses=this.stack.pushFloat32(e),this.accelerations=this.stack.pushFloat32(e),this.c0Forces=this.stack.pushFloat32(e),this.cvForces=this.stack.pushFloat32(e),this.tmpForces=this.stack.pushFloat32(e),this.tmpVelocities=this.stack.pushFloat32(e),this.bhat=this.stack.pushFloat32(e),this.v0=this.stack.pushFloat32(t),this.v1=this.stack.pushFloat32(t),this.cMin=this.stack.pushFloat32(t),this.cMax=this.stack.pushFloat32(t),this.lambdas0=this.stack.pushFloat32(t),this.lambdas1=this.stack.pushFloat32(t),this.b=this.stack.pushFloat32(t),this.bt0=this.stack.pushFloat32(t),this.bt1=this.stack.pushFloat32(t)}serializeBodies(t){let e=0;for(const i of t){const t=i.position,s=i.velocity,n=i.force;this.positions[e]=t[0],this.positions[e+1]=t[1],this.positions[e+2]=i.angle,this.velocities[e]=s[0],this.velocities[e+1]=s[1],this.velocities[e+2]=i.omega,this.forces[e]=n[0],this.forces[e+1]=n[1],this.forces[e+2]=i.torque,this.invMasses[e]=this.invMasses[e+1]=i.invMass,this.invMasses[e+2]=i.invInertia,e+=3,i.solverConstraints.length=0}}createJacobianMatrix(t,e){this.J.m=this.rows,this.J.n=this.columns,this.J.columns.length=this.J.rows.length=this.J.values.length=0;let i=0;const s=this.J.values,n=this.J.columns,r=this.J.rows;for(const o of t){o.getJacobian(this.jacobian);const{min:t,max:a}=o.getClamping();this.cMin[i]=t,this.cMax[i]=a,this.v0[i]=o.getPushFactor(e,this.settings.defaultPushFactor),this.v1[i]=o.getPushFactor(e,0),this.lambdas0[i]=o.getCache(0),this.lambdas1[i]=o.getCache(1),r.push(s.length);const h=o.bodyA,c=o.bodyB;h&&!h.isStatic&&c&&!c.isStatic?(h.solverConstraints.push(i),c.solverConstraints.push(i),h.bodyIndex<c.bodyIndex?(s.push(this.jacobian[0],this.jacobian[1],this.jacobian[2],this.jacobian[3],this.jacobian[4],this.jacobian[5]),n.push(3*h.bodyIndex,3*h.bodyIndex+1,3*h.bodyIndex+2,3*c.bodyIndex,3*c.bodyIndex+1,3*c.bodyIndex+2)):(s.push(this.jacobian[3],this.jacobian[4],this.jacobian[5],this.jacobian[0],this.jacobian[1],this.jacobian[2]),n.push(3*c.bodyIndex,3*c.bodyIndex+1,3*c.bodyIndex+2,3*h.bodyIndex,3*h.bodyIndex+1,3*h.bodyIndex+2))):h&&!h.isStatic?(h.solverConstraints.push(i),s.push(this.jacobian[0],this.jacobian[1],this.jacobian[2]),n.push(3*h.bodyIndex,3*h.bodyIndex+1,3*h.bodyIndex+2)):c&&!c.isStatic&&(c.solverConstraints.push(i),s.push(this.jacobian[3],this.jacobian[4],this.jacobian[5]),n.push(3*c.bodyIndex,3*c.bodyIndex+1,3*c.bodyIndex+2)),i++}r.push(this.J.values.length)}createConstraintLookup(t){this.lookup.length=this.rows;let e=0;for(const i of t){const t=i.bodyA,s=i.bodyB,n=t?t.solverConstraints:[],r=s?s.solverConstraints:[];let o=0,a=0,h=-1;const c=[];for(;o<n.length||a<r.length;){let t;t=o===n.length?r[a++]:a===r.length||n[o]<r[a]?n[o++]:r[a++],h!==t&&(c.push(t),h=t)}this.lookup[e++]=c}}solveConstraintForces(t,e,i){const s=((t,e,i)=>{const s=[],n=[],r=[0];for(let o=0;o<t.m;o++){const a=t.rows[o],h=t.rows[o+1],c=i[o];for(const i of c){let r=0,o=a,c=t.rows[i];const l=t.rows[i+1];for(;o<h&&c<l;)t.columns[c]<t.columns[o]?c++:(t.columns[c]>t.columns[o]||(r+=e[t.columns[o]]*t.values[o]*t.values[c],c++),o++);r&&(s.push(r),n.push(i))}r.push(s.length)}return{m:t.m,n:t.m,values:s,columns:n,rows:r}})(this.J,this.invMasses,this.lookup);Z(this.bhat,this.invMasses,this.forces),Q(this.bhat,this.bhat,this.velocities,1/i),((t,e,i)=>{t.fill(0);for(let s=0;s<e.m;s++)for(let n=e.rows[s],r=e.rows[s+1];n<r;n++)t[s]+=i[e.columns[n]]*e.values[n]})(this.b,this.J,this.bhat),et(this.bt0,this.v0,1/i,this.b,-1),et(this.bt1,this.v1,1/i,this.b,-1),this.linearEquationsSolver.solve(this.lambdas0,s,this.bt0,this.cMin,this.cMax),this.linearEquationsSolver.solve(this.lambdas1,s,this.bt1,this.cMin,this.cMax),$(t,this.J,this.lambdas0),$(e,this.J,this.lambdas1);for(let t=0;t<this.rows;t++)this.constraints[t].setCache(0,this.lambdas0[t]),this.constraints[t].setCache(1,this.lambdas1[t])}correctPositions(t,e){var i,s;tt(this.tmpForces,this.forces,this.cvForces),i=this.tmpVelocities,s=this.velocities,i.set(s,0),Z(this.accelerations,this.tmpForces,this.invMasses),Q(this.tmpVelocities,this.tmpVelocities,this.accelerations,e),Q(t,this.positions,this.tmpVelocities,e)}correctVelocities(t,e){tt(this.tmpForces,this.forces,this.c0Forces),Z(this.accelerations,this.tmpForces,this.invMasses),Q(t,this.velocities,this.accelerations,e)}deallocate(){this.stack.clear()}getRequiredMemorySize(t,e){return 120*t+36*e}};hs=rs([b(),as(0,v("SETTINGS")),as(1,v("LINEAR_EQUATIONS_SOLVER")),os("design:paramtypes",[Object,Object,Qt])],hs);class cs{constructor(){this.edge=null,this.vertex=null,this.depth=Number.NEGATIVE_INFINITY}}const ls=T(),ds=T(),us=T(),fs=T(),ps=T(),ys=T(),vs=T(),bs=T(),ms=T(),gs=T(),ws=T(),_s=new cs,As=new cs,Is=new class{constructor(){this.edge=null,this.depth=Number.NEGATIVE_INFINITY}},xs=(t,e,i,s)=>{t.depth=Number.NEGATIVE_INFINITY,t.edge=null,t.vertex=null;for(const n of e.edges()){D(ls,n.normal),s.fromFirstToSecondVector(ls,ls),i.support(ds,ls),s.fromSecondToFirstPoint(ds,ds),W(ds,ds,n.v0.point);const e=L(n.normal,ds);if(e>=0)return t.depth=e,t.edge=n,t.vertex=i.cachedSupportVertex,t;e>t.depth&&(t.depth=e,t.edge=n,t.vertex=i.cachedSupportVertex)}return t};class Ss{constructor(){this.point0=T(),this.point1=T(),this.normal=T(),this.depth=0}}const Ps=(t,e,i,s)=>{if(t.length=null,xs(_s,e,i,s),_s.depth>=0)return!1;const n=xt(s);if(xs(As,i,e,n),As.depth>=0)return!1;let r=_s,o=!1;As.depth>_s.depth&&(r=As,s=n,o=!0);const a=r.edge;s.fromFirstToSecondVector(ws,a.normal);const h=L(r.vertex.edge0.normal,ws)<L(r.vertex.edge1.normal,ws)?r.vertex.edge0:r.vertex.edge1;s.fromSecondToFirstPoint(ms,h.v0.point),s.fromSecondToFirstPoint(gs,h.v1.point),W(ws,a.v0.point,a.v1.point),At(ms,gs,ws,a.v1.point),D(ws,ws),At(gs,ms,ws,a.v0.point);for(const e of[ms,gs]){W(ws,e,a.v0.point);const i=L(ws,a.normal);if(i>=0)continue;const n=new Ss;s.fromFirstVector(n.normal,a.normal),n.depth=-i,o?(s.fromFirstPoint(n.point0,e),N(n.normal,n.normal),k(n.point1,n.point0,n.normal,n.depth)):(s.fromFirstPoint(n.point1,e),D(n.normal,n.normal),k(n.point0,n.point1,n.normal,-n.depth)),t.push(n)}return!0},Bs=(t,e,i,s)=>{if(t.length=null,((t,e,i,s)=>{t.depth=Number.NEGATIVE_INFINITY,t.edge=null;for(const n of e.edges()){D(ls,n.normal),s.fromFirstToSecondVector(ls,ls),i.support(ds,ls),s.fromSecondToFirstPoint(ds,ds),W(ds,ds,n.v0.point);const e=L(n.normal,ds);if(e>=0)return t.depth=e,t.edge=n,t;e>t.depth&&(t.depth=e,t.edge=n)}})(Is,e,i,s),Is.depth>=0)return!1;s.fromFirstPoint(us,Is.edge.v0.point),s.fromFirstPoint(fs,Is.edge.v1.point),U(ps),s.fromSecondPoint(ps,ps),vt(vs,us,fs,ps),gt(bs,vs,us,fs),W(ws,bs,ps);const n=J(ws);if(n<i.radius){const e=new Ss;return e.depth=i.radius-n,q(e.normal,ws),N(e.point0,bs),k(e.point1,bs,e.normal,e.depth),t.push(e),!0}return!1},Ts=(t,e,i,s)=>{U(ps),s.fromFirstPoint(ps,ps),U(ys),s.fromSecondPoint(ys,ys);const n=e.radius+i.radius-R(ps,ys);if(n<=0)return!1;const r=new Ss;return r.depth=n,O(r.normal,ps,ys),q(r.normal,r.normal),k(r.point0,ps,r.normal,-e.radius),k(r.point1,ys,r.normal,i.radius),t.push(r),!0};var Fs=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},js=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ns=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Es=class{constructor(t){this.registry=t}*detectContacts(t){const e=[];for(const[i,s]of t){const t=i.shape,n=s.shape,r=Vt(i.collider.id,s.collider.id),o=this.registry.getPairById(r);let a=o.spacesMapping;o.updateTransforms(),e.length=0,t instanceof pe&&n instanceof pe?Ps(e,t,n,a)&&(yield*this.getContactInfo(e,i,s,a)):t instanceof pe&&n instanceof ve?Bs(e,t,n,a)&&(yield*this.getContactInfo(e,i,s,a)):t instanceof ve&&n instanceof pe?(a=xt(a),Bs(e,n,t,a)&&(yield*this.getContactInfo(e,s,i,a))):t instanceof ve&&n instanceof ve&&Ts(e,t,n,a)&&(yield*this.getContactInfo(e,i,s,a))}}*getContactInfo(t,e,i,s){for(const n of t){const t=T();s.toFirstPoint(t,n.point0);const r=T();s.toSecondPoint(r,n.point1),yield{collider0:e.collider,collider1:i.collider,shape0:e.shape,shape1:i.shape,point0:n.point0,localPoint0:t,point1:n.point1,localPoint1:r,normal:n.normal,depth:n.depth}}}};Es=Fs([b(),Ns(0,v((()=>Gi))),js("design:paramtypes",[Object])],Es);const Cs=T(),Os=T(),Ms=T(),ks=T(),Rs=T(),Vs=T(),Js=T(),zs=T(),Ds=T(),qs=(t,e)=>{let i=t.edgeLoop;const s=L(i.normal,e);if(L(i.next.normal,e)>s)for(i=i.next;L(i.next.normal,e)>L(i.normal,e);)i=i.next;else if(L(i.prev.normal,e)>s)for(i=i.prev;L(i.prev.normal,e)>L(i.normal,e);)i=i.prev;return i},Ls=(t,e,i,s,n,r,o)=>{const a=T();q(a,o),N(ks,a),r.toSecondVector(ks,ks);let h=qs(n,ks);const c=L(h.normal,ks);D(ks,a),r.toFirstVector(ks,ks);let l=qs(i,ks);let d=!1;if(c>L(l.normal,ks)){const t=h;h=l,l=t,r=xt(r),D(a,a),d=!0}r.fromSecondToFirstPoint(Cs,h.v0.point),r.fromSecondToFirstPoint(Os,h.v1.point),W(Ms,l.v0.point,l.v1.point),At(Cs,Os,Ms,l.v1.point),D(Ms,Ms),At(Os,Cs,Ms,l.v0.point),t.length=0;for(const o of[Cs,Os]){W(Ms,o,l.v0.point);const h=L(Ms,l.normal);if(h>=0)continue;const c=T();r.fromFirstPoint(c,o);const u=T();k(u,c,a,h);const f=T();r.toSecondPoint(f,c);const p=T();r.toFirstPoint(p,u),t.push({collider0:d?s:e,collider1:d?e:s,shape0:i,shape1:n,point0:u,localPoint0:p,point1:c,localPoint1:f,normal:a,depth:-h})}return t},Ys=(t,e,i,s,n,r,o)=>{const a=T();q(a,o),N(ks,a),r.toFirstVector(ks,ks),D(ks,ks);const h=qs(i,ks);r.fromFirstPoint(Rs,h.v0.point),r.fromFirstPoint(Vs,h.v1.point),U(zs),r.fromSecondPoint(zs,zs);const c=T();vt(Js,Rs,Vs,zs),gt(c,Js,Rs,Vs);const l=T();C(l,c,o),N(ks,a),r.toSecondVector(ks,ks),n.support(l,ks),r.fromSecondPoint(l,l);const d=R(c,l),u=T();r.toFirstPoint(u,c);const f=T();return r.toSecondPoint(f,l),t.length=0,t.push({collider0:e,collider1:s,shape0:i,shape1:n,point0:c,localPoint0:u,point1:l,localPoint1:f,normal:a,depth:d}),t},Gs=(t,e,i,s,n,r,o)=>{const a=F(o);q(a,a),D(a,a),U(zs),r.fromFirstPoint(zs,zs),U(Ds),r.fromSecondPoint(Ds,Ds);const h=T();k(h,zs,a,i.radius);const c=T();k(c,Ds,a,-n.radius);const l=R(h,c),d=T();r.toFirstPoint(d,h);const u=T();return r.toSecondPoint(u,c),t.length=0,t.push({collider0:e,collider1:s,shape0:i,shape1:n,point0:h,localPoint0:d,point1:c,localPoint1:u,normal:a,depth:l}),t};var Us=self&&self.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},Ws=self&&self.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ks=self&&self.__param||function(t,e){return function(i,s){e(i,s,t)}};let Hs=class{constructor(t,e){this.settings=t,this.registry=e,this.mtv=T(),this.simplex=new Set,this.initialDir=T()}*detectContacts(t){const e=[];for(const[i,s]of t){const t=Vt(i.collider.id,s.collider.id),n=this.registry.getPairById(t);n.updateTransforms(),e.length=0,this.simplex.clear(),O(this.initialDir,i.collider.body.position,s.collider.body.position);if(je(this.simplex,i.shape,s.shape,n.spacesMapping,this.initialDir,-this.settings.narrowPhaseMargin,this.settings.gjkRelError,this.settings.gjkMaxIterations)<this.settings.epaEpsilon)this.simplex.clear(),je(this.simplex,i.shape,s.shape,n.spacesMapping,this.initialDir,0,this.settings.gjkRelError,this.settings.gjkMaxIterations),Ce(this.mtv,this.simplex,i.shape,s.shape,n.spacesMapping,0,this.settings.epaEpsilon,this.settings.epaMaxIterations),D(this.mtv,this.mtv);else{const t=T(),e=T();Ne(this.mtv,this.simplex),n.spacesMapping.toSecondVector(e,this.mtv),s.shape.support(e,e),n.spacesMapping.fromSecondPoint(e,e),D(this.mtv,this.mtv),n.spacesMapping.toFirstVector(t,this.mtv),i.shape.support(t,t),n.spacesMapping.fromFirstPoint(t,t),D(this.mtv,this.mtv);const r=L(this.mtv,e);if(L(this.mtv,t)>=r)continue}i.shape instanceof pe&&s.shape instanceof pe?yield*Ls(e,i.collider,i.shape,s.collider,s.shape,n.spacesMapping,this.mtv):i.shape instanceof pe&&s.shape instanceof ve?yield*Ys(e,i.collider,i.shape,s.collider,s.shape,n.spacesMapping,this.mtv):i.shape instanceof ve&&s.shape instanceof pe?yield*Ys(e,s.collider,s.shape,i.collider,i.shape,xt(n.spacesMapping),j(-this.mtv[0],-this.mtv[1])):i.shape instanceof ve&&s.shape instanceof ve&&(yield*Gs(e,s.collider,s.shape,i.collider,i.shape,n.spacesMapping,this.mtv))}}};Hs=Us([b(),Ks(0,v("SETTINGS")),Ks(1,v((()=>Gi))),Ws("design:paramtypes",[Object,Object])],Hs);class Xs{get id(){return this.body.id}get transform(){return this.body.transform}get aabb(){return this._aabb}constructor(t,e,i,s){this.body=t,this.shape=e,this.mask=i,this.virtual=s,this._aabb=[T(),T()]}updateAABB(){this.shape.aabb(this._aabb,this.body.transform)}}const $s={uid:"default",maxBodiesNumber:512,maxConstraintsNumber:4096,gravity:j(0,-9.8),totalReservedMemory:16e6,defaultPushFactor:.25,defaultFriction:.5,defaultRestitution:.5,defaultDamping:.005,defaultAngularDamping:.05,solverIterations:10,islandGenerator:"local",contactProximityThreshold:.005,contactConstraintSlop:.005,sleepingVelocityThreshold:.1,sleepingAngularVelocityThreshold:.1,fallAsleepTimer:.5,broadPhase:"naive",narrowPhase:"sat",narrowPhaseMargin:.01,toiEpsilon:.001,toiPenetrationDepth:.05,toiMaxIterations:8,toiSubsteps:8,gjkRelError:1e-6,gjkMaxIterations:24,epaEpsilon:1e-4,epaMaxIterations:24},Zs=(t={})=>((t={})=>{t=Object.assign(Object.assign({},$s),t);const e=f.of(t.uid);if(e.set({id:"SETTINGS",value:t}),e.set({id:"WORLD",type:Hi}),e.set({id:"MID_PHASE",type:ti}),e.set({id:"CONSTRAINTS_SOLVER",type:hs}),e.set({id:"LINEAR_EQUATIONS_SOLVER",type:jt}),"sat"===t.narrowPhase)e.set({id:"NARROW_PHASE",type:Es});else{if("gjk-epa"!==t.narrowPhase)throw new Error("Physics2D: Unknown narrow phase identifier, supported keys: \'sat\', \'gjk-epa\'");e.set({id:"NARROW_PHASE",type:Hs})}if("naive"===t.broadPhase)e.set({id:"BROAD_PHASE",type:Mt});else{if("sap"!==t.broadPhase)throw new Error("Physics2D: Unknown broad phase identifier, supported keys: \'naive\', \'sap\'");e.set({id:"BROAD_PHASE",type:le})}if("local"===t.islandGenerator)e.set({id:"ISLANDS_GENERATOR",type:ts});else{if("sole"!==t.islandGenerator)throw new Error("Physics2D: Unknown island generator identifier, supported keys: \'local\', \'sole\'");e.set({id:"ISLANDS_GENERATOR",type:ns})}return e})(t).get("WORLD");var Qs="undefined"!=typeof Float32Array?Float32Array:Array;function tn(){var t=new Qs(3);return Qs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function en(t,e,i){var s=new Qs(3);return s[0]=t,s[1]=e,s[2]=i,s}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function sn(){var t=new Qs(4);return Qs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}!function(){var t=tn()}(),function(){var t,e=(t=new Qs(4),Qs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var nn,rn;function on(){var t=new Qs(2);return Qs!=Float32Array&&(t[0]=0,t[1]=0),t}function an(t,e,i){return t[0]=e,t[1]=i,t}!function(){var t=tn(),e=en(1,0,0),i=en(0,1,0)}(),function(){var t=sn(),e=sn()}(),function(){var t,e=(t=new Qs(9),Qs!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t)}(),function(){var t=on()}();class hn{event;collection=new Set;listener=(...t)=>this.addToCollection(...t);world;get listening(){return Boolean(this.world)}constructor(t){this.event=t}listen(t){this.world||(this.world=t,t.on(this.event,this.listener))}stop(){this.world.off(this.event,this.listener),this.world=null}reset(){this.collection.clear()}*[Symbol.iterator](){yield*this.collection}}class cn extends hn{constructor(t){super(t)}addToCollection(t){this.collection.add(t.id)}}class ln extends hn{constructor(t){super(t)}addToCollection(t,e){this.collection.add([t.body.id,e.body.id])}}!function(t){t[t.CollisionStart=1]="CollisionStart",t[t.Collide=2]="Collide",t[t.CollisionEnd=4]="CollisionEnd",t[t.FallAsleep=8]="FallAsleep",t[t.Awake=16]="Awake",t[t.BodyCreated=32]="BodyCreated",t[t.BodyDestroyed=64]="BodyDestroyed",t[t.ColliderAdded=128]="ColliderAdded",t[t.ColliderRemoved=256]="ColliderRemoved",t[t.JointAdded=512]="JointAdded",t[t.JointRemoved=1024]="JointRemoved",t[t.PreStep=2048]="PreStep",t[t.IslandPreStep=4096]="IslandPreStep",t[t.IslandPostStep=8192]="IslandPostStep",t[t.PostStep=16384]="PostStep",t[t.Cursor=32768]="Cursor",t[t.Collision=7]="Collision",t[t.Body=120]="Body"}(nn||(nn={})),function(t){t[t.Island=1]="Island",t[t.Position=2]="Position",t[t.Angle=4]="Angle",t[t.Velocity=8]="Velocity",t[t.Omega=16]="Omega",t[t.Force=32]="Force",t[t.Torque=64]="Torque",t[t.Mass=128]="Mass",t[t.Inertia=256]="Inertia",t[t.Flag=512]="Flag",t[t.None=0]="None",t[t.All=1023]="All"}(rn||(rn={}));const dn=(t,e,i,s)=>{const n=e;if(t[e++]=s,t[e++]=i.id,s&rn.Island&&(t[e++]=i.islandId),s&rn.Position)for(const s of i.position)t[e++]=s;if(s&rn.Angle&&(t[e++]=i.angle),s&rn.Velocity)for(const s of i.velocity)t[e++]=s;if(s&rn.Omega&&(t[e++]=i.omega),s&rn.Force)for(const s of i.force)t[e++]=s;return s&rn.Torque&&(t[e++]=i.torque),s&rn.Mass&&(t[e++]=i.mass),s&rn.Inertia&&(t[e++]=i.inertia),s&rn.Flag&&(t[e++]=Number(i.isSleeping)),e-n},un=on(),fn=(t,e,i)=>{const s=i,n=e[i++];return i++,n&rn.Island&&(t.islandId=e[i++]),n&rn.Position&&(an(un,e[i++],e[i++]),t.position=un),n&rn.Angle&&(t.angle=e[i++]),n&rn.Velocity&&(an(un,e[i++],e[i++]),t.velocity=un),n&rn.Omega&&(t.omega=e[i++]),n&rn.Force&&(an(un,e[i++],e[i++]),t.force=un),n&rn.Torque&&(t.torque=e[i++]),n&rn.Mass&&(t.mass=e[i++]),n&rn.Inertia&&(t.inertia=e[i++]),n&rn.Flag&&(t.isSleeping=Boolean(e[i++])),i-s},pn=(t,e,i)=>{const s=e;if(i instanceof cn){t[e++]=nn[i.event],t[e++]=0;let n=0;for(const s of i)t[e++]=s,n++;t[s+1]=n}else if(i instanceof ln){t[e++]=nn[i.event],t[e++]=0;let n=0;for(const[s,r]of i)t[e++]=s,t[e++]=r,n++;t[s+1]=n}else t.fill(0);return e-s};var yn;!function(t){t.Circle="Circle",t.Ellipse="Ellipse",t.Box="Box",t.Capsule="Capsule",t.Polygon="Polygon",t.Mesh="Mesh"}(yn||(yn={}));const vn=t=>(t=>t.type===yn.Circle)(t)?new ve(t.radius):(t=>t.type===yn.Ellipse)(t)?new Ie(t.a,t.b,t.subdivisions):(t=>t.type===yn.Capsule)(t)?new we(t.radius,t.height,t.subdivisions):(t=>t.type===yn.Box)(t)?new ye(t.width,t.height):(t=>t.type===yn.Polygon)(t)?new pe(t.points,t.transformOrigin):(t=>t.type===yn.Mesh)(t)?new be(t.mesh,t.transformOrigin):void 0;var bn;!function(t){t.CreateWorld="CreateWorld",t.CreateBody="CreateBody",t.DestroyBody="DestroyBody",t.AddDistanceJoint="AddDistanceJoint",t.AddPrismaticJoint="AddPrismaticJoint",t.AddRevoluteJoint="AddRevoluteJoint",t.AddWeldJoint="AddWeldJoint",t.AddWheelJoint="AddWheelJoint",t.AddSpring="AddSpring",t.AddMouseJoint="AddMouseJoint",t.AddMotor="AddMotor",t.RemoveJoint="RemoveJoint",t.AddCollider="AddCollider",t.RemoveCollider="RemoveCollider",t.UpdateTransform="UpdateTransform",t.Clear="Clear",t.Return="Return",t.On="On",t.Off="Off"}(bn||(bn={}));class mn{bodiesBuffer;eventsBuffer;frame;time;dt;name="Step";constructor(t,e,i,s,n){this.bodiesBuffer=t,this.eventsBuffer=e,this.frame=i,this.time=s,this.dt=n}}const gn=(t,e="ok")=>({name:`${t.name}Result`,timestamp:Date.now(),task:t,result:e}),wn=(t,e)=>({name:`${t.name}Result`,timestamp:Date.now(),task:t,error:e});class _n{timer;interval;start(t,e){if(this.interval=e,"string"==typeof e){const e=()=>{t(.01667),self.requestAnimationFrame(e)};this.timer=self.requestAnimationFrame(e)}else this.timer=self.setInterval((()=>t(e)),1e3*e)}stop(){"string"==typeof this.interval?self.cancelAnimationFrame(this.timer):self.clearInterval(this.timer),this.timer=null}}class An{cursor=on();getCursorPosition(t){return function(t,e){return t[0]=e[0],t[1]=e[1],t}(t,this.cursor)}setCursor(t,e){an(this.cursor,t,e)}}const In=new class{bodiesBuffer;eventsBuffer;world;bodiesNumber=0;joints=new Map;idManager=new Rt;loop=new _n;cursor=new An;eventCollectors=new Map([[ei.Awake,new cn(ei.Awake)],[ei.FallAsleep,new cn(ei.FallAsleep)],[ei.CollisionStart,new ln(ei.CollisionStart)],[ei.Collide,new ln(ei.Collide)],[ei.CollisionEnd,new ln(ei.CollisionEnd)]]);processTask(t){switch(t.name){case bn.CreateWorld:return this.createWorld(t);case bn.CreateBody:return this.createBody(t);case bn.DestroyBody:return this.destroyBody(t);case bn.AddDistanceJoint:return this.addDistanceJoint(t);case bn.AddPrismaticJoint:return this.addPrismaticJoint(t);case bn.AddRevoluteJoint:return this.addRevoluteJoint(t);case bn.AddWeldJoint:return this.addWeldJoint(t);case bn.AddWheelJoint:return this.addWheelJoint(t);case bn.AddSpring:return this.addSpring(t);case bn.AddMouseJoint:return this.addMouseJoint(t);case bn.AddMotor:return this.addMotor(t);case bn.RemoveJoint:return this.removeJoint(t);case bn.AddCollider:return this.addCollider(t);case bn.RemoveCollider:return this.removeCollider(t);case bn.Clear:return this.clear(t);case bn.Return:return this.returnBuffer(t);case bn.On:return this.on(t);case bn.Off:return this.off(t);default:return wn(t,new Error("Unknown message"))}}createWorld(t){try{return this.world=Zs(t.settings),this.bodiesBuffer=new Float32Array(15*t.settings.maxBodiesNumber),this.eventsBuffer=new Float32Array(4),this.loop.start((t=>this.step(t)),t.settings.step),gn(t)}catch(e){return wn(t,e)}}createBody(t){const e=this.world.createBody(t.bodyDef);return this.bodiesNumber++,gn(t,e.id)}destroyBody(t){return this.world.destroyBody(this.world.getBody(t.body.id)),this.bodiesNumber--,gn(t)}addDistanceJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,distance:r}=t,o=this.world.addDistanceJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,distance:r}),a=this.idManager.getUniqueId();return this.joints.set(a,o),gn(t,a)}addPrismaticJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,localAxis:r,refAngle:o,minDistance:a,maxDistance:h}=t,c=this.world.addPrismaticJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,localAxis:r,refAngle:o,minDistance:a,maxDistance:h}),l=this.idManager.getUniqueId();return this.joints.set(l,c),gn(t,l)}addRevoluteJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,minAngle:r,maxAngle:o,stiffness:a,damping:h}=t,c=this.world.addRevoluteJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,minAngle:r,maxAngle:o,stiffness:a,damping:h}),l=this.idManager.getUniqueId();return this.joints.set(l,c),gn(t,l)}addWeldJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,refAngle:r}=t,o=this.world.addWeldJoint({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,refAngle:r}),a=this.idManager.getUniqueId();return this.joints.set(a,o),gn(t,a)}addWheelJoint(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,localAxis:r,minDistance:o,maxDistance:a}=t,h=this.world.addWheelJonit({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,localAxis:r,minDistance:o,maxDistance:a}),c=this.idManager.getUniqueId();return this.joints.set(c,h),gn(t,c)}addSpring(t){const{bodyA:e,pivotA:i,bodyB:s,pivotB:n,distance:r,stiffness:o,extinction:a}=t,h=this.world.addSpring({bodyA:this.world.getBody(e.id),pivotA:i,bodyB:this.world.getBody(s.id),pivotB:n,distance:r,stiffness:o,extinction:a}),c=this.idManager.getUniqueId();return this.joints.set(c,h),gn(t,c)}addMouseJoint(t){const{cursor:e,body:i,joint:s,maxForce:n,stiffness:r}=t;this.cursor.setCursor(e[0],e[1]);const o=this.world.addMouseJoint({control:this.cursor,body:this.world.getBody(i.id),joint:s,stiffness:r,maxForce:n}),a=this.idManager.getUniqueId();return this.joints.set(a,o),gn(t,a)}addMotor(t){const{body:e,speed:i,torque:s}=t,n=this.world.addMotor({body:this.world.getBody(e.id),speed:i,torque:s}),r=this.idManager.getUniqueId();return this.joints.set(r,n),gn(t,r)}removeJoint(t){if(this.joints.has(t.jointId)){const e=this.joints.get(t.jointId);return this.joints.delete(t.jointId),this.idManager.releaseId(t.jointId),e.bodyA&&e.bodyA.removeJoint(e),e.bodyB&&e.bodyB.removeJoint(e),gn(t)}return wn(t,`TaskWorker: Failed to remove joint, joint with id#${t.jointId} not found. `)}addCollider(t){const{body:e,shape:i,mask:s,isVirtual:n}=t;return this.world.addCollider({body:this.world.getBody(e.id),shape:vn(i),mask:s,isVirtual:n}),gn(t)}removeCollider(t){const e=this.world.getBody(t.collider.id);return this.world.removeCollider(e.collider),gn(t)}clear(t){return this.world.clear(),this.joints.clear(),this.idManager.reset(),this.bodiesNumber=0,gn(t)}returnBuffer(t){return this.bodiesBuffer=t.bodiesBuffer,this.eventsBuffer=t.eventsBuffer,this.deserializeBodies(t),this.deserializeEvents(t),null}on(t){const e=this.eventCollectors.get(t.event);return e&&!e.listening&&(e.listen(this.world),this.eventsBuffer=new Float32Array(this.getEventBufferSize())),gn(t)}off(t){const e=this.eventCollectors.get(t.event);return e&&e.listening&&(e.stop(),this.eventsBuffer=new Float32Array(this.getEventBufferSize())),gn(t)}step(t){this.resetEvents(),this.world.step(t),this.bodiesBuffer.byteLength>0&&this.eventsBuffer.byteLength>0&&this.bodiesNumber>0&&(this.serializeBodies(),this.serializeEvents(),self.postMessage(new mn(this.bodiesBuffer,this.eventsBuffer,this.world.clock.frame,this.world.clock.time,t),{transfer:[this.bodiesBuffer.buffer,this.eventsBuffer.buffer]}))}getEventBufferSize(){let t=1;for(const[e,i]of this.eventCollectors)i.listening&&(e===ei.Awake&&(t+=this.world.settings.maxBodiesNumber+2),e===ei.FallAsleep&&(t+=this.world.settings.maxBodiesNumber+2),e===ei.CollisionStart&&(t+=8*this.world.settings.maxBodiesNumber+2),e===ei.Collide&&(t+=8*this.world.settings.maxBodiesNumber+2),e===ei.CollisionEnd&&(t+=8*this.world.settings.maxBodiesNumber+2));return t}resetEvents(){for(const t of this.eventCollectors.values())t.reset()}serializeBodies(){let t=0;this.bodiesBuffer[t++]=this.bodiesNumber;for(const e of this.world)t+=dn(this.bodiesBuffer,t,e,rn.All)}serializeEvents(){let t=0;this.eventsBuffer[t++]=this.eventCollectors.size;for(const e of this.eventCollectors.values())t+=pn(this.eventsBuffer,t,e)}deserializeBodies(t){let e=0;const i=t.bodiesBuffer[e++];for(let s=0;s<i;s++){const i=this.world.getBody(t.bodiesBuffer[e+1]);i&&(e+=fn(i,t.bodiesBuffer,e),i.updateTransform())}}deserializeEvents(t){let e=0;const i=t.eventsBuffer[e++];for(let s=0;s<i;s++){t.eventsBuffer[e++]&nn.Cursor&&this.cursor.setCursor(t.eventsBuffer[e++],t.eventsBuffer[e++])}}};self.addEventListener("message",(t=>{const e=t.data;if((t=>t&&"taskId"in t)(e)){const t=In.processTask(e);t&&self.postMessage(t)}}));\n';
